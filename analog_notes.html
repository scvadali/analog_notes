* * * * * * * *                                                                             

<!DOCTYPE html> 
<html lang='en-US' xml:lang='en-US'> 
<head><title>Analog Notes for Prelims FA2025</title> 
<meta charset='utf-8' /> 
<meta content='TeX4ht (https://tug.org/tex4ht/)' name='generator' /> 
<meta content='width=device-width,initial-scale=1' name='viewport' /> 
<link href='analog_notes.css' rel='stylesheet' type='text/css' /> 
<meta content='analog_notes.tex' name='src' /> 
<script>window.MathJax = { tex: { tags: "ams", }, }; </script> 
 <script async='async' id='MathJax-script' src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js' type='text/javascript'></script>  
</head><body>
   <div class='maketitle'>
                                                                                               
                                                                                               
                                                                                               
                                                                                               

<h2 class='titleHead'>Analog Notes for Prelims FA2025</h2>
<div class='author'><span class='cmr-12'>Chandrahaas Vadali</span></div>
<br />
<div class='date'><span class='cmr-12'>December 29, 2025</span></div>
   </div>
   <h3 class='likesectionHead' id='contents'><a id='x1-1000'></a>Contents</h3>
   <div class='tableofcontents'>
   <span class='sectionToc'>1 <a href='#differential-amplifiers' id='QQ2-1-2'>Differential Amplifiers</a></span>
<br />   <span class='subsectionToc'>1.1 <a href='#singleended-vs-differential' id='QQ2-1-3'>Single-ended vs Differential</a></span>
<br />   <span class='subsectionToc'>1.2 <a href='#will-just-two-csas-work' id='QQ2-1-5'>Will just two CSAs work?</a></span>
<br />   <span class='subsectionToc'>1.3 <a href='#t-differential-pair' id='QQ2-1-7'>5T Differential Pair</a></span>
<br />   <span class='subsectionToc'>1.4 <a href='#halfckt-technique-for-small-signal-analysis' id='QQ2-1-12'>Half-ckt technique for small signal analysis</a></span>
<br />   <span class='subsectionToc'>1.5 <a href='#asymmetric-diff-pair' id='QQ2-1-14'>Asymmetric diff pair</a></span>
<br />   <span class='subsectionToc'>1.6 <a href='#commonmode-to-differential-conversion' id='QQ2-1-16'>Common-mode to differential conversion</a></span>
<br />   <span class='subsectionToc'>1.7 <a href='#gilbert-cell' id='QQ2-1-19'>Gilbert Cell</a></span>
<br />   <span class='sectionToc'>2 <a href='#feedback' id='QQ2-1-21'>Feedback</a></span>
<br />   <span class='subsectionToc'>2.1 <a href='#ideal-feedback-equation' id='QQ2-1-22'>Ideal Feedback Equation</a></span>
<br />   <span class='subsectionToc'>2.2 <a href='#feedback-configurations' id='QQ2-1-24'>Feedback Configurations</a></span>
<br />   <span class='subsubsectionToc'>2.2.1 <a href='#seriesshunt-or-voltagevoltage-feedback' id='QQ2-1-26'>Series-Shunt or Voltage-Voltage Feedback</a></span>
<br />   <span class='subsubsectionToc'>2.2.2 <a href='#shuntshunt-or-voltagecurrent-feedback' id='QQ2-1-30'>Shunt-Shunt or Voltage-Current Feedback</a></span>
<br />   <span class='subsubsectionToc'>2.2.3 <a href='#other-feedback-configurations-and-summary' id='QQ2-1-33'>Other Feedback Configurations and Summary</a></span>
<br />   <span class='subsectionToc'>2.3 <a href='#twoport-network-parameters' id='QQ2-1-35'>Two-port Network Parameters</a></span>
<br />   <span class='subsubsectionToc'>2.3.1 <a href='#zparameters' id='QQ2-1-37'>Z-Parameters</a></span>
<br />   <span class='subsubsectionToc'>2.3.2 <a href='#yparameters' id='QQ2-1-38'>Y-Parameters</a></span>
<br />   <span class='subsubsectionToc'>2.3.3 <a href='#hparameters' id='QQ2-1-39'>H-Parameters</a></span>
<br />   <span class='subsubsectionToc'>2.3.4 <a href='#gparameters' id='QQ2-1-40'>G-Parameters</a></span>
<br />   <span class='subsubsectionToc'>2.3.5 <a href='#twoport-summary' id='QQ2-1-41'>Two-port summary</a></span>
<br />   <span class='subsectionToc'>2.4 <a href='#how-to-identify-feedback-types' id='QQ2-1-43'>How to identify feedback types?</a></span>
<br />   <span class='subsectionToc'>2.5 <a href='#effect-of-loading-on-input-and-output-due-to-feedback' id='QQ2-1-48'>Effect of loading on input and output due to feedback</a></span>
<br />   <span class='subsectionToc'>2.6 <a href='#how-to-deal-with-active-components-in-feedback' id='QQ2-1-57'>How to deal with active components in feedback?</a></span>
                                                                                               
                                                                                               
<br />   <span class='subsectionToc'>2.7 <a href='#local-feedback' id='QQ2-1-59'>Local Feedback</a></span>
<br />   <span class='subsectionToc'>2.8 <a href='#return-ratio-method' id='QQ2-1-60'>Return Ratio method</a></span>
<br />   <span class='subsectionToc'>2.9 <a href='#effect-of-feedback-on-noise' id='QQ2-1-61'>Effect of feedback on noise</a></span>
<br />   <span class='subsectionToc'>2.10 <a href='#frequency-response' id='QQ2-1-64'>Frequency Response</a></span>
<br />   <span class='subsubsectionToc'>2.10.1 <a href='#gainbandwidth-product' id='QQ2-1-65'>Gain-Bandwidth product</a></span>
<br />   <span class='subsubsectionToc'>2.10.2 <a href='#root-locus' id='QQ2-1-66'>Root Locus</a></span>
<br />   <span class='subsectionToc'>2.11 <a href='#phase-margin' id='QQ2-1-67'>Phase margin</a></span>
<br />   <span class='subsectionToc'>2.12 <a href='#translating-closedloop-specs-to-openloop-opamp-specs' id='QQ2-1-68'>Translating closed-loop specs to open-loop op-amp specs</a></span>
<br />   <span class='subsubsectionToc'>2.12.1 <a href='#static-gain-error' id='QQ2-1-69'>Static Gain Error</a></span>
<br />   <span class='subsubsectionToc'>2.12.2 <a href='#settling-time' id='QQ2-1-70'>Settling Time</a></span>
<br />   <span class='subsectionToc'>2.13 <a href='#dc-offset-and-cancellation' id='QQ2-1-71'>DC offset and cancellation</a></span>
<br />   <span class='subsectionToc'>2.14 <a href='#commonmode-feedback' id='QQ2-1-72'>Common-mode Feedback</a></span>
<br />   <span class='subsubsectionToc'>2.14.1 <a href='#commonmode-sensing' id='QQ2-1-75'>Common-mode sensing</a></span>
<br />   <span class='subsubsectionToc'>2.14.2 <a href='#cmfb-techniques' id='QQ2-1-77'>CMFB techniques</a></span>
<br />   <span class='sectionToc'>3 <a href='#low-dropout-voltage-regulator' id='QQ2-1-82'>Low Dropout Voltage Regulator</a></span>
<br />   <span class='subsectionToc'>3.1 <a href='#basic-ldo-topology' id='QQ2-1-83'>Basic LDO topology</a></span>
<br />   <span class='subsectionToc'>3.2 <a href='#choice-of-pass-transistor' id='QQ2-1-85'>Choice of Pass transistor</a></span>
<br />   <span class='subsubsectionToc'>3.2.1 <a href='#current-source-as-pass-transistor' id='QQ2-1-86'>Current source as pass transistor</a></span>
<br />   <span class='sectionToc'>4 <a href='#cascode-amplifiers' id='QQ2-1-89'>Cascode Amplifiers</a></span>
<br />   <span class='subsectionToc'>4.1 <a href='#frequency-response1' id='QQ2-1-90'>Frequency Response</a></span>
<br />   <span class='subsubsectionToc'>4.1.1 <a href='#current-mirror-polezero-doublet' id='QQ2-1-94'>Current mirror pole-zero doublet</a></span>
<br />   <span class='subsectionToc'>4.2 <a href='#noise' id='QQ2-1-96'>Noise</a></span>
<br />   <span class='subsectionToc'>4.3 <a href='#output-swing' id='QQ2-1-97'>Output swing</a></span>
<br />   <span class='subsectionToc'>4.4 <a href='#compensation-techniques' id='QQ2-1-98'>Compensation techniques</a></span>
<br />   <span class='subsectionToc'>4.5 <a href='#slew-rate' id='QQ2-1-99'>Slew rate</a></span>
<br />   <span class='subsubsectionToc'>4.5.1 <a href='#class-ab-output-and-input-stages' id='QQ2-1-104'>Class AB output and input stages</a></span>
<br />   <span class='sectionToc'>5 <a href='#biasing-circuits' id='QQ2-1-107'>Biasing Circuits</a></span>
<br />   <span class='subsectionToc'>5.1 <a href='#current-mirrors' id='QQ2-1-108'>Current mirrors</a></span>
<br />   <span class='subsubsectionToc'>5.1.1 <a href='#replica-biasing' id='QQ2-1-111'>Replica Biasing</a></span>
<br />   <span class='subsectionToc'>5.2 <a href='#wilson-current-mirror' id='QQ2-1-116'>Wilson Current Mirror</a></span>
<br />   <span class='subsectionToc'>5.3 <a href='#widlar-current-source' id='QQ2-1-119'>Widlar Current Source</a></span>
<br />   <span class='subsectionToc'>5.4 <a href='#peaking-current-source' id='QQ2-1-121'>Peaking Current Source</a></span>
<br />   <span class='subsectionToc'>5.5 <a href='#generating-bias-voltages' id='QQ2-1-123'>Generating Bias Voltages</a></span>
<br />   <span class='subsubsectionToc'>5.5.1 <a href='#ctat' id='QQ2-1-124'>CTAT</a></span>
<br />   <span class='subsubsectionToc'>5.5.2 <a href='#ptat' id='QQ2-1-125'>PTAT</a></span>
<br />   <span class='subsectionToc'>5.6 <a href='#supplyindependent-biasing' id='QQ2-1-129'>Supply-independent biasing</a></span>
<br />   <span class='subsubsectionToc'>5.6.1 <a href='#loop-gain' id='QQ2-1-132'>Loop gain</a></span>
<br />   <span class='subsectionToc'>5.7 <a href='#temperatureindependent-voltages' id='QQ2-1-135'>Temperature-independent voltages</a></span>
                                                                                               
                                                                                               
<br />   <span class='subsectionToc'>5.8 <a href='#startup-ckt' id='QQ2-1-138'>Startup ckt</a></span>
<br />   <span class='sectionToc'>6 <a href='#oscillators' id='QQ2-1-140'>Oscillators</a></span>
<br />   <span class='subsectionToc'>6.1 <a href='#schmitt-triggerbased-oscillator' id='QQ2-1-141'>Schmitt Trigger-based oscillator</a></span>
<br />   <span class='subsectionToc'>6.2 <a href='#rc-oscillators' id='QQ2-1-144'>RC Oscillators</a></span>
<br />   <span class='subsubsectionToc'>6.2.1 <a href='#generic-phase-shift-network' id='QQ2-1-145'>Generic Phase shift network</a></span>
<br />   <span class='subsubsectionToc'>6.2.2 <a href='#wien-bridge-oscillator' id='QQ2-1-147'>Wien Bridge Oscillator</a></span>
<br />   <span class='subsectionToc'>6.3 <a href='#lc-oscillators' id='QQ2-1-150'>LC oscillators</a></span>
<br />   <span class='subsubsectionToc'>6.3.1 <a href='#rlc-network-basics' id='QQ2-1-151'>RLC network basics</a></span>
<br />   <span class='subsectionToc'>6.4 <a href='#tuned-gain-stage' id='QQ2-1-154'>Tuned gain stage</a></span>
<br />   <span class='subsubsectionToc'>6.4.1 <a href='#colpitts-oscillator' id='QQ2-1-157'>Colpitts Oscillator</a></span>
<br />   <span class='subsectionToc'>6.5 <a href='#negative-impedance' id='QQ2-1-160'>Negative impedance</a></span>
<br />   <span class='subsubsectionToc'>6.5.1 <a href='#source-follower-negative-input-impedance' id='QQ2-1-161'>Source follower - negative input impedance</a></span>
<br />   <span class='sectionToc'>7 <a href='#noise1' id='QQ2-1-163'>Noise</a></span>
<br />   <span class='subsectionToc'>7.1 <a href='#noise-psd' id='QQ2-1-164'>Noise PSD</a></span>
<br />   <span class='subsectionToc'>7.2 <a href='#noise-models' id='QQ2-1-165'>Noise Models</a></span>
<br />   <span class='subsectionToc'>7.3 <a href='#noise-calculations' id='QQ2-1-166'>Noise calculations</a></span>
<br />   <span class='subsectionToc'>7.4 <a href='#noise-in-differential-ckts' id='QQ2-1-167'>Noise in differential ckts</a></span>
<br />   <span class='subsubsectionToc'>7.4.1 <a href='#cascode-devices' id='QQ2-1-170'>Cascode devices</a></span>
<br />   <span class='subsubsectionToc'>7.4.2 <a href='#how-to-find-output-noise' id='QQ2-1-172'>How to find output noise</a></span>
<br />   <span class='subsectionToc'>7.5 <a href='#input-referred-noise-' id='QQ2-1-173'>Input Referred Noise </a></span>
<br />   <span class='subsubsectionToc'>7.5.1 <a href='#voltage-and-current-noise-sources-at-the-input' id='QQ2-1-174'>Voltage and Current Noise Sources at the input</a></span>
<br />   <span class='subsectionToc'>7.6 <a href='#reducing-noise-design-parameters' id='QQ2-1-175'>Reducing noise - design parameters</a></span>
<br />   <span class='sectionToc'>8 <a href='#transimpedance-amplifiers' id='QQ2-1-176'>Transimpedance Amplifiers</a></span>
<br />   <span class='subsectionToc'>8.1 <a href='#commongate-tias' id='QQ2-1-178'>Common-gate TIAs</a></span>
<br />   <span class='subsectionToc'>8.2 <a href='#feedback-tias' id='QQ2-1-179'>Feedback TIAs</a></span>
<br />   <span class='sectionToc'><a href='#references' id='QQ2-1-181'>References</a></span>
   </div>
<!-- l. 28 --><p class='indent'>
                                                                                               
                                                                                               
</p>
   <h3 class='sectionHead' id='differential-amplifiers'><span class='titlemark'>1   </span> <a id='x1-20001'></a>Differential Amplifiers</h3>
<!-- l. 35 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='singleended-vs-differential'><span class='titlemark'>1.1   </span> <a id='x1-30001.1'></a>Single-ended vs Differential</h4>
<!-- l. 37 --><p class='noindent'>A signle-ended signal is measured against a fixed reference potential such as gnd while a differential signal is measured
between two nodes where the signals variy <span class='cmbx-10'>equally </span>and in <span class='cmbx-10'>opposite </span>directions. The common potential around
which the two signals at each node vary is know as the common-mode potential [<a id='x1-3001'></a><a href='#cite.0_razavi_design_2017'>12</a>]. Note that any signal
between two nodes can be decomposed into a common-mode component and a differential component as shown
below.
</p><!-- l. 43 --><p class='indent'>   \[ V_{in,1} - V_{in,2} = \frac {V_{in,1} + V_{in,2}}{2} + \frac {V_{in,1} - V_{in,2}}{2} = V_{in,CM} + V_{in,DM} \]
</p>
   <figure class='figure' id='x1-30021'><span id='singleended-vs-differential-signals-note-that-the-impedance-presented-at-nodes-x-and-y-are-equal'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 47 --><p class='noindent'><img alt='PIC' height='250' src='images/single_vs_diff_signals.png' width='250' /> <img alt='PIC' height='250' src='images/half_ckt_voltage_conv.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 1: </span><span class='content'>Single-ended vs differential signals. Note that the impedance presented at nodes X and Y are equal.</span></figcaption><!-- tex4ht:label?: x1-30021  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 52 --><p class='indent'>   Basically, we can now bias a circuit at the common-mode input of \(V_{in,CM}\) and then apply \(\pm V_{in,DM}/2\) to the two nodes to achieve
differential signaling.
</p>
   <h4 class='subsectionHead' id='will-just-two-csas-work'><span class='titlemark'>1.2   </span> <a id='x1-40001.2'></a>Will just two CSAs work?</h4>
<!-- l. 56 --><p class='noindent'>From the above analysis, it is tempting to start off with two common source amplifiers whose inputs are \(\pm V_{in,DM}/2\)
and the output is measured in between the two drain nodes. Figure <a href='#a-basic-differential-pair-has-problems-in-dealing-with-commonmode-variations'>2<!-- tex4ht:ref: fig:basic_diff_pair  --></a> demonstrates the problem with this
approach. As the common-mode changes, it can throw the transistors into cut-off with smaller differential
swings. Note that when M1/M2 are off here - the outputs hit the rail (because there is no current in the
branch).
</p>
   <figure class='figure' id='x1-40012'><span id='a-basic-differential-pair-has-problems-in-dealing-with-commonmode-variations'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 63 --><p class='noindent'><img alt='PIC' height='250' src='images/basic_diff_pair.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 2: </span><span class='content'>A basic differential pair has problems in dealing with common-mode variations.</span></figcaption><!-- tex4ht:label?: x1-40012  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 68 --><p class='indent'>   We basically would like to have an amplifier which is insensitive to common-mode swings. This means, we need another
biasing element that can keep \(V_{GS}\) of the transistors at the same value irrespective of the input common-mode. One way to do
this is to make the source floating and to make sure a fixed current flows through both devices - this way if \(V_{in,CM}\) goes up or
down, the source node goes up or down too! The transistors won’t turn off since the bias current forces them to be on. This
is exactly what we do in a 5T-OTA.
</p>
   <h4 class='subsectionHead' id='t-differential-pair'><span class='titlemark'>1.3   </span> <a id='x1-50001.3'></a>5T Differential Pair</h4>
<!-- l. 74 --><p class='noindent'>We use a biasing tail current to achieve the common-mode “rejection” - the ability to remain insensitive to common-mode
swings. Let us study the 5T differential pair (from now on we’ll just call this the “diff-pair”) shown in figure <a href='#a-basic-differential-pair-has-problems-in-dealing-with-commonmode-variations1'>3<!-- tex4ht:ref: fig:5t_ota  --></a>. We follow
analysis from [<a id='x1-5001'></a><a href='#cite.0_razavi_design_2017'>12</a>].
</p>
   <figure class='figure' id='x1-50023'><span id='a-basic-differential-pair-has-problems-in-dealing-with-commonmode-variations1'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 79 --><p class='noindent'><img alt='PIC' height='150' src='images/5t_ota.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 3: </span><span class='content'>A basic differential pair has problems in dealing with common-mode variations.</span></figcaption><!-- tex4ht:label?: x1-50023  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 84 --><p class='indent'>   Tracking \(V_{in,1} - V_{in,2}\), we see that if \(V_{in,1}\) is much more negative than \(V_{in,2}\), M1 is turned off in figure <a href='#a-basic-differential-pair-has-problems-in-dealing-with-commonmode-variations1'>3<!-- tex4ht:ref: fig:5t_ota  --></a> and the entire bias current flows
through M2. The output \(V_{out,2}\) is simply \(V_{DD} -I_{SS}R_D\) and \(V_{out,1}\) is \(V_{DD}\). As \(V_{in,1}\) becomes more positive and gets closer to \(V_{in,2}\), M1 starts turning on and
steering some current away from M2. \(V_{out,1}\) falls from \(V_{DD}\) and \(V_{out,2}\) increases. At \(V_{in,1} = V_{in,2}\), both the branches share the bias current equally and
the output is at the common-mode \(V_{DD} -I_{SS}R_D/2\). AS \(V_{in,1}-V_{in,2}\) now becomes positive, due to symmetry M1 steals current from M2
til at certain point M2 is off. Figure <a href='#differential-large-signal-behavior-of-the-tota'>4<!-- tex4ht:ref: fig:large_sig_5t_ota  --></a> plots the differential output as a function of the differential input
voltage.
</p>
   <figure class='figure' id='x1-50034'><span id='differential-large-signal-behavior-of-the-tota'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 92 --><p class='noindent'><img alt='PIC' height='250' src='images/large_sig_5t_ota.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 4: </span><span class='content'>Differential large signal behavior of the 5T-OTA</span></figcaption><!-- tex4ht:label?: x1-50034  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 97 --><p class='indent'>   From figure <a href='#differential-large-signal-behavior-of-the-tota'>4<!-- tex4ht:ref: fig:large_sig_5t_ota  --></a>, we see that the maximum slope, and thus, maximum small signal gain of this circuit is when \(V_{in,1} = V_{in,2}\). The circuit
is also most linear in this case and becomes increasingly non-linear as the current is steered from the balanced condition
into one of the two branches when larger differential swings are applied.
</p><!-- l. 103 --><p class='indent'>   To study the common-mode behavior, we need to modify the tail current to add a realistic transistor. This ensure that
when both devices are off (when \(V_{in,CM} =0\) for example), there is indeed no current flowing through either branch. As we increase \(V_{in,CM}\)
beyond \(V_{th}\), the devices turn on but the tail transistors might still be in deep triode since the voltage at P is stil
rising from close to zero. Increasing \(V_{in,CM}\) further gets the tail transistor into saturation and now equal currents
flow through the two branches and the output settles at the output common-mode. This is illustrated in
figure <a href='#commonmode-large-signal-behavior-of-the-tota'>5<!-- tex4ht:ref: fig:large_sig_cm_5t_ota  --></a>. Notice that in figure <a href='#differential-large-signal-behavior-of-the-tota'>4<!-- tex4ht:ref: fig:large_sig_5t_ota  --></a>, the max and min values of the output voltages are independent of the input
common-mode. This means that as the input common-mode is increasing, there can be a condition where the tail node
(source of the input pair) is high enough to send the input transistors into triode. This sets the upper limit of
\(V_{in,CM}\).
</p>
   <figure class='figure' id='x1-50045'><span id='commonmode-large-signal-behavior-of-the-tota'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 111 --><p class='noindent'><img alt='PIC' height='250' src='images/large_sig_cm_5t_ota.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 5: </span><span class='content'>Common-mode large signal behavior of the 5T-OTA</span></figcaption><!-- tex4ht:label?: x1-50045  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 117 --><p class='indent'>   How does the small signal differential gain change with the input common-mode? Once the transistors M1 and M2 turn
on but M3 is still in deep triode, the diff pair acts like a common source amplifier with a large degeneration resistor in the
form of M3. Gain increases as the tail transistor comes out of triode and into saturation, where the gain is relatively
constant till M1 and M2 enter triode when \(V_{in,CM}\) is very high. Increasing \(V_{in,CM}\) decreases the gain as the input pair is no longer in
saturation. This is illustrated in figure <a href='#commonmode-large-signal-behavior-of-the-tota1'>6<!-- tex4ht:ref: fig:gain_vs_vincm  --></a>
</p>
   <figure class='figure' id='x1-50056'><span id='commonmode-large-signal-behavior-of-the-tota1'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 125 --><p class='noindent'><img alt='PIC' height='250' src='images/gain_vs_vincm.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 6: </span><span class='content'>Common-mode large signal behavior of the 5T-OTA</span></figcaption><!-- tex4ht:label?: x1-50056  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 132 --><p class='indent'>   We can perform the above analysis quantitatively. This lets us also calculate the output characteristics in case the load
on either side of the diff pair is not the same. For a symmetric diff pair, we can write the following equations assuming a
square law device with no channel length modulation
</p><!-- l. 138 --><p class='indent'>   \begin {equation}  \label {eqn:diff_out} V_{out,1} - V_{out,2} = R_D(I_{D,1}-I_{D,2})  \end {equation}<a id='x1-5006r1'></a>
</p><!-- l. 143 --><p class='indent'>   \begin {equation}  \label {eqn:diff_out2} I_{D,1}-I_{D,2} = \frac {1}{2} \mu _n C_{ox} \frac {W}{L} (V_{in,1}-V_{in,2})\sqrt {\frac {4I_{SS}}{\mu _n C_{ox}\frac {W}{L}} - (V_{in,1}-V_{in,1})^2}  \end {equation}<a id='x1-5007r2'></a>
</p><!-- l. 145 --><p class='indent'>   Note that in deriving eqns <a href='#x1-5006r1'>1<!-- tex4ht:ref: eqn:diff_out  --></a> and <a href='#x1-5007r2'>2<!-- tex4ht:ref: eqn:diff_out2  --></a>, we assumed that the transistors are always in saturation. Therefore, despite having 2
possible \(\Delta V_{in}\) for which \(\Delta I_D\) is zero, the higher value of \(\Delta V_{in}\) condition leads to one of the devices being turned off and the tail current
being completely steered into one branch.
</p><!-- l. 149 --><p class='indent'>   Before we examine eqn <a href='#x1-5007r2'>2<!-- tex4ht:ref: eqn:diff_out2  --></a> more closely, let us look at the differential transconductance (\(G_m\)).
</p><!-- l. 154 --><p class='indent'>   \begin {equation}  \label {eqn:gm_diff_pair} G_m = \frac {\partial \Delta I_D}{\partial \Delta V_{in}} = \frac {1}{2}\mu _n C_{ox} \frac {W}{L}\frac {\frac {4I_{SS}}{\mu _n C_{ox}W/L} - 2\Delta V_{in}^2}{\sqrt {\frac {4I_{SS}}{\mu _n C_{ox}W/L} - \Delta V_{in}^2}}  \end {equation}<a id='x1-5008r3'></a>
</p><!-- l. 157 --><p class='indent'>   From eqn <a href='#x1-5008r3'>3<!-- tex4ht:ref: eqn:gm_diff_pair  --></a>, we see that \(G_m\) is maximum for \(\Delta V_{in}=0\) - when the diff pair is balanced and the \(g_m\) of the individual transistors is equal.
Another key point is that \(G_m\) falls to zero at \(\Delta V_{in1} = \sqrt {2I_{SS}/(\mu _n C_{ox}W/L)}\). This is because the current is completely steered away from one branch and
other branch’s input device is turned off. At equilibrium (balanced diff pair), the current through each branch is \(I_{SS}/2\) and the
gate overdrive is
</p><!-- l. 164 --><p class='indent'>   \begin {equation}  (V_{GS}-V_{TH})_{1,2} = V^*_{1,2} = \sqrt {\frac {I_{SS}}{\mu _n C_{ox}\frac {W}{L}}} = \frac {\Delta V_{in}}{\sqrt {2}} \label {eqn:max_del_vin}  \end {equation}<a id='x1-5009r4'></a>
</p><!-- l. 168 --><p class='indent'>   Now, going back to eqn <a href='#x1-5007r2'>2<!-- tex4ht:ref: eqn:diff_out2  --></a>, we see that \(\Delta I_D\) is zero only for \(\Delta V_{in} = 0\) since at \(\Delta V_{in} = \Delta V_{in1}\), one of the transistors in the diff pair is not in
saturation anymore. From eqn <a href='#x1-5009r4'>4<!-- tex4ht:ref: eqn:max_del_vin  --></a>, we see that the diff pair can ”handle” a differential input of utmost \(\sqrt {2}V^*\) before the current is
completely steered away into a single branch.
</p>
   <div class='tcolorbox tcolorbox' id='tcolobox-1'>     
<div class='tcolorbox-title'>
   </div> 
<div class='tcolorbox-content'><!-- l. 174 --><p class='noindent'>\(\Delta V_{in,max} = \sqrt {2}V^*\) - this is the range in which the diff pair maintains linearity </p> 
</div> 
</div>
   <h4 class='subsectionHead' id='halfckt-technique-for-small-signal-analysis'><span class='titlemark'>1.4   </span> <a id='x1-60001.4'></a>Half-ckt technique for small signal analysis</h4>
<!-- l. 180 --><p class='noindent'>From a small signal perspective, due to equal and opposite swings at the input during differential operation, the tail node
doesn’t experience any AC swing. This means, we can treat it to be at AC/virtual GND. Note that this doesn’t change even
if the tail current source is non-ideal - the output resistance of the non-ideal tail current would source and sink the same
(but opposite direction) small signal currents to either branches leaving the tail node at virtual GND. This now means we
can essentially split the circuit right at the virtual GND node and analyse one half of it. This only works in case of
symmetric differential pairs.
</p><!-- l. 186 --><p class='indent'>   What about common-mode swings? In this case both M1 and M2 branches experience identical voltage/current swings.
If we break them into two halves, no current should flow across the axis of symmetry since the voltages are
same at corresponding points. This is demonstrated in figure <a href='#commonmode-small-signal-half-ckt-taken-from-fa-a-lecture-notes'>7<!-- tex4ht:ref: fig:com_mode_half_ckt  --></a>. No current essentially means the two ckts
are essentially open circuited in between. We can break them at the axis of symmetry and analyse one of
them.
</p>
   <figure class='figure' id='x1-60017'><span id='commonmode-small-signal-half-ckt-taken-from-fa-a-lecture-notes'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 192 --><p class='noindent'><img alt='PIC' height='250' src='images/com_mode_half_ckt.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 7: </span><span class='content'>Common-mode small signal half ckt - taken from FA2024 240A lecture notes</span></figcaption><!-- tex4ht:label?: x1-60017  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 197 --><p class='indent'>   Another method of half ckt common-mode analysis invloves breaking the ckt in half and folding it over. This creates two
parallel transistors (effective width is doubled and the load resistance is halved).
</p>
   <h4 class='subsectionHead' id='asymmetric-diff-pair'><span class='titlemark'>1.5   </span> <a id='x1-70001.5'></a>Asymmetric diff pair</h4>
<!-- l. 203 --><p class='noindent'>What happens in case M1 and M2 are asymmetric or the load resistances are asymmetric? We can begin with brute force
analysis. By superposition, we set one of the \(V_{in,1/2}\) to zero and find out the transfer function to either outputs. Figure <a href='#differential-small-signal-gain-for-an-asymmetric-diff-pair'>8<!-- tex4ht:ref: fig:asym_diff_pair  --></a> shows
the derivation using \(G_mR_{out}\) method.
</p>
   <figure class='figure' id='x1-70018'><span id='differential-small-signal-gain-for-an-asymmetric-diff-pair'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 209 --><p class='noindent'><img alt='PIC' height='250' src='images/diff_pair_1.png' width='250' /><img alt='PIC' height='225' src='images/diff_pair_2.png' width='225' />
</p>
<figcaption class='caption'><span class='id'>Figure 8: </span><span class='content'>Differential small signal gain for an asymmetric diff pair</span></figcaption><!-- tex4ht:label?: x1-70018  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 214 --><p class='indent'>   From figure <a href='#differential-small-signal-gain-for-an-asymmetric-diff-pair'>8<!-- tex4ht:ref: fig:asym_diff_pair  --></a>, we get that the differential gain is given By
</p>
   <div class='tcolorbox tcolorbox' id='tcolobox-2'>     
<div class='tcolorbox-title'>
   </div> 
<div class='tcolorbox-content'><!-- l. 220 --><p class='noindent'>\begin {equation}  \label {eqn:asym_diff_pair} A_v = \frac {V_x-V_Y}{V_{in,1}-V_{in,2}} = \frac {-g_{m1}g_{m2}}{g_{m1}+g_{m2}} (R_{D1}+R_{D2})  \end {equation}<a id='x1-7002r5'></a> </p> 
</div> 
</div>
<!-- l. 224 --><p class='indent'>   In [<a id='x1-7003'></a><a href='#cite.0_razavi_design_2017'>12</a>], example problem 4.6 deals with an asymmetric diff pair where the widths of the input pair is in 1:2 ratio and the
load resistances are equal. We can use the above analysis and set \(g_{m2} = 2g_{m1}\) and \(R_{D1} = R_{D2}=R_D\) to arrive at the same answer as in [<a href='#cite.0_razavi_design_2017'>12</a>], \(A_v = 4/3 g_{m1} R_D\). Note that,
for a given tail bias \(I_{SS}\), this value is lower than the symmetric case - only \(I_{SS}/3\) flows into M1, \(g_{m1}\) is \(\sqrt {3}\) lower than what it would’ve been
in the symmetric case.
</p><!-- l. 230 --><p class='indent'>   Example problem 4.8 in [<a href='#cite.0_razavi_design_2017'>12</a>] deals with asymmetry in the input swings. Take a symmetric diff pair, similar to the one in
figure <a href='#a-basic-differential-pair-has-problems-in-dealing-with-commonmode-variations1'>3<!-- tex4ht:ref: fig:5t_ota  --></a>. Now, if we apply inputs such that \(V_{in,1} \neq V_{in,2}\), how do we analyse the system? We can split the ckt into its
differential and common mode half ckts and apply a differential voltage of \((V_{in,1}-V_{in,2})/2\) and a common mode voltage of \((V_{in,1}+V_{in,2})/2\) at
each input (with the correct phase). The common mode ckt has infinite rejection ideally and rejects any
common mode inputs. Therefore, the ckt simply takes the difference in the applied inputs \(V_{in,1}-V_{in,2}\) and amplifies it by
\(g_mR_D\).
</p>
   <div class='tcolorbox tcolorbox' id='tcolobox-3'>     
<div class='tcolorbox-title'>
   </div> 
<div class='tcolorbox-content'><!-- l. 236 --><p class='noindent'>Within small signal regime, an ideal and symmetric differential pair rejects common mode swings fully and
only amplifies the difference between the two inputs.
</p>
 
</div> 
</div>
   <h4 class='subsectionHead' id='commonmode-to-differential-conversion'><span class='titlemark'>1.6   </span> <a id='x1-80001.6'></a>Common-mode to differential conversion</h4>
<!-- l. 251 --><p class='noindent'>Finally, we end the discussion of asymmetric/mismatched diff pairs to see the impact of common-mode swings on
differential outputs. If we do not have an ideal tail current source, we have some finite common-mode gain (note if the ckt is
fully symmetric this doesn’t affect the differential gain). This can affect the biasing for subsequent changes since the output
common mode is now not fixed and is swinging. [<a href='#cite.0_razavi_design_2017'>12</a>] notes that in sub-nm nodes, this is an issue for cascaded stages as
explained in figure <a href='#common-mode-gain-in-cascaded-diff-pair-stages'>9<!-- tex4ht:ref: fig:comm_mode_cascade_nm_notes  --></a>. Note that as \(V_{in,CM}\) of first stage increases, the output common mode of the first stage decreases due to
negative gain (more current is drawn by the input pair across the load resistance). The opposite happens in the second
stage.
</p>
   <figure class='figure' id='x1-80019'><span id='common-mode-gain-in-cascaded-diff-pair-stages'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 263 --><p class='noindent'><img alt='PIC' height='100' src='images/comm_mode_cascade_nm_notes.png' width='100' />
</p>
<figcaption class='caption'><span class='id'>Figure 9: </span><span class='content'>Common mode gain in cascaded diff pair stages.</span></figcaption><!-- tex4ht:label?: x1-80019  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 269 --><p class='indent'>   Common mode rejection can be increased in several ways at the cost output swing. Cascoded current sources,
source-degeneration of input pairs, etc. are some common techniques.
</p><!-- l. 272 --><p class='indent'>   But what happens to the differential output in case of a common mode swing? Ideally, nothing (when ckt
is fully symmetric). But when there are some mismatches, there is an interesting phenomena that takes
place.
</p>
   <figure class='figure' id='x1-800210'><span id='commom-mode-swings-can-convert-to-differential-output-under-mismatch-'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 276 --><p class='noindent'><img alt='PIC' height='250' src='images/diff_pair_mismatch.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 10: </span><span class='content'>Commom mode swings can convert to differential output under mismatch </span></figcaption><!-- tex4ht:label?: x1-800210  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 281 --><p class='indent'>   When \(V_{i,CM}\) goes up, the tail node \(V_P\) goes up by
</p><!-- l. 284 --><p class='indent'>   \[\Delta V_P = \frac {R_{SS}}{R_{SS}+\frac {1}{2g_m}} \Delta V_{in,CM} \]
</p><!-- l. 287 --><p class='indent'>   Note that in case of an ideal current source \(\Delta V_P\) is just \(\Delta V_{in,CM}\) and there is no change in current in either branches. In this case,
however, there is an equal change in drain current and is equal to
</p><!-- l. 290 --><p class='indent'>   \[\Delta I_{DS} = \frac {g_m}{1+2g_mR_{SS}}\Delta V_{in,CM}\]
</p><!-- l. 292 --><p class='indent'>   The mismatch in load resistance causes different drops in \(V_X\) and \(V_Y\).
</p><!-- l. 294 --><p class='indent'>   \[\Delta V_X = -\Delta V_{in,CM} \frac {g_m}{1+2g_m R_{SS}} R_D\] \[\Delta V_Y = \Delta V_{in,CM} \frac {g_m}{1+2g_m R_{SS}} (R_D+\Delta R_D)\]
</p><!-- l. 297 --><p class='indent'>   We see a differential output for an input common mode swing of
</p><!-- l. 302 --><p class='indent'>   \begin {equation}  \label {eqn:cm_rd_mismatch_dm} \frac {\Delta V_{out}}{\Delta V_{in,CM}} = \Delta V_X + \Delta V_Y = \frac {g_m \Delta R_D}{1+2g_mR_{SS}}  \end {equation}<a id='x1-8003r6'></a>
</p><!-- l. 305 --><p class='indent'>   Another interesting thing to observe is that, even if the output impedance of the tail current is high, the parasitic
capacitance can act as a shunt - especially at high frequencies.
</p><!-- l. 308 --><p class='indent'>   Similarly, if there is a \(g_m\) mismatch there is a common mode to differential conversion.
</p><!-- l. 313 --><p class='indent'>   \begin {equation}  \label {eqn:cm_gm_mismatch_dm} A_{CM-DM} = -\frac {\Delta g_m R_D}{(g_{m1}+g_{m2})R_{SS}+1}  \end {equation}<a id='x1-8004r7'></a>
</p><!-- l. 316 --><p class='indent'>   Yet another mismatch could be body-effect mismatch. If the input pair shows a mismatch \(g_{mb1} \neq g_{mb2}\), the difference in small signal
current on either side manifests as a change in differential output.
</p>
   <div class='tcolorbox tcolorbox' id='tcolobox-4'>     
<div class='tcolorbox-title'>
   </div> 
<div class='tcolorbox-content'><!-- l. 320 --><p class='noindent'>In summary, any mismatch in load resistance or the width, \(g_m\) or \(g_{mb}\), or change in input common mode on either
branches can convert common mode swings into differential outputs. </p> 
</div> 
</div>
   <h4 class='subsectionHead' id='gilbert-cell'><span class='titlemark'>1.7   </span> <a id='x1-90001.7'></a>Gilbert Cell</h4>
<!-- l. 327 --><p class='noindent'>Say we want to implement a variable gain fully differential amplifier that can span small signal gains from negative to
positive values, i.e, \(V_{out} = A_1 V_{in} + A_2 V_{in}\), where \(A_1\) and \(A_2\) are controlled by the tail currents of the two amplifiers. Figures in figure <a href='#gilbert-cell-vga'>11<!-- tex4ht:ref: fig:gilbert_cell  --></a> show the
implementation of this idea.
</p>
   <figure class='figure' id='x1-900111'><span id='gilbert-cell-vga'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 333 --><p class='noindent'><img alt='PIC' height='150' src='images/gilbert_cell_1.png' width='150' /><img alt='PIC' height='150' src='images/gilbert_cell_2.png' width='150' /><img alt='PIC' height='150' src='images/gilbert_cell_3.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 11: </span><span class='content'>Gilbert Cell VGA</span></figcaption><!-- tex4ht:label?: x1-900111  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 338 --><p class='indent'>   In figure <a href='#gilbert-cell-vga'>11<!-- tex4ht:ref: fig:gilbert_cell  --></a>, the differential input \(V_{cont}\) changes the current in the two diff pairs in opposite directions - which makes it
possible to steer the current completely from one branch into another - thereby achieving gains from negative to positive
values. Interestingly, exchanging the inputs to the control signal still gives us the same functionality. Another interesting
fact about a Gilbert Cell is that it can be used an analog voltage multiplier. Since \(V_{out} = V_{in}f(V_{cont})\), we can use Taylor series and linearize
the dependence of \(V_{out}\) on \(V_{cont}\) to write \(V_{out} \approx V_{in} . \alpha V_{cont}\). This property is true for any voltage-controlled VGA and is used in RF ckts as a
multiplier/mixer.
                                                                                               
                                                                                               
</p>
   <h3 class='sectionHead' id='feedback'><span class='titlemark'>2   </span> <a id='x1-100002'></a>Feedback</h3>
<!-- l. 350 --><p class='noindent'>We study negative feedback in this section. It can help control gain, input/output impedance to a reliably set value while
increasing BW and improving linearity.
</p><!-- l. 352 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='ideal-feedback-equation'><span class='titlemark'>2.1   </span> <a id='x1-110002.1'></a>Ideal Feedback Equation</h4>
<!-- l. 354 --><p class='noindent'>Figure <a href='#ideal-feedback-configuration-grayanalog'>12<!-- tex4ht:ref: fig:ideal_fb_eqn  --></a> shows a system in ideal feedback - a forward path through amplifiers only, a feedback network (mostly passive),
and a differencing node at the input. The differencing node takes the input and a fraction of the output fedback by the
feedback network and gives the error signal (difference) as input to the amplifier. The signal here could be current or
voltage.
</p>
   <figure class='figure' id='x1-1100112'><span id='ideal-feedback-configuration-grayanalog'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 360 --><p class='noindent'><img alt='PIC' height='250' src='images/ideal_fb_eqn.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 12: </span><span class='content'>Ideal Feedback Configuration [<a id='x1-11002'></a><a href='#cite.0_gray_analog_2009'>5</a>]</span></figcaption><!-- tex4ht:label?: x1-1100112  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 365 --><p class='indent'>   Say the amplifier has an open-loop gain of \(a\) and the transfer function of the feedback network is \(f\).Then, we have the
following eqns
</p><!-- l. 374 --><p class='indent'>   \begin {equation}  \label {eqn:ideal_fb_eqns} \begin {split} S_e &amp;= S_i - fS_o \\ S_0 &amp;= aS_e = a (S_i - fS_0)\\ \frac {S_o}{S_i} &amp;= A_{CL} = \frac {a}{1+af} \end {split}  \end {equation}<a id='x1-11003r8'></a>
</p><!-- l. 376 --><p class='indent'>   From eqn <a href='#x1-11003r8'>8<!-- tex4ht:ref: eqn:ideal_fb_eqns  --></a>, we see that the open-loop gain decreases by \(1+af\). We call \(T=af\) as the loop gain. Note that \(T\) is a dimension-less
quantity (\(a\) and \(f\) can have dimensions but their product is dimension-less). In the same eqn, we make a few more
observations. If \(T &gt;&gt; 1\), then \(A_{CL} \approx \frac {1}{f}\) - we have well controlled gain.
</p><!-- l. 385 --><p class='indent'>   \begin {equation}  \label {eqn:ideal_fb_eqns2} \begin {split} \frac {S_e}{S_i} &amp;= \frac {1}{1+T} \\ \frac {S_{fb}}{S_e} &amp;= T = af \end {split}  \end {equation}<a id='x1-11004r9'></a>
</p><!-- l. 387 --><p class='indent'>   Eqn <a href='#x1-11004r9'>9<!-- tex4ht:ref: eqn:ideal_fb_eqns2  --></a> shows that as the loop gain \(T \rightarrow \inf \), the error signal \(S_e \rightarrow 0\). The loop gain is simply the transfer function from the error signal
to the differencing node via the amplifier and the feedback network.
</p>
   <h4 class='subsectionHead' id='feedback-configurations'><span class='titlemark'>2.2   </span> <a id='x1-120002.2'></a>Feedback Configurations</h4>
<!-- l. 393 --><p class='noindent'>Depending on what kind of signal we’re sensing at the output - current or voltage - and what we’re feeding back to the
input, we have 4 combinations. Figure <a href='#types-of-amplifiers-a-voltage-amplifier-b-transimpedance-amplifier-c-transconductance-amplifier-and-d-current-amplifier'>13<!-- tex4ht:ref: fig:types_amps  --></a> shows the different basic amps we have - again depending on the input and output
signals the amplifier handles.
</p>
   <figure class='figure' id='x1-1200113'><span id='types-of-amplifiers-a-voltage-amplifier-b-transimpedance-amplifier-c-transconductance-amplifier-and-d-current-amplifier'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 398 --><p class='noindent'><img alt='PIC' height='250' src='images/types_amps.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 13: </span><span class='content'>Types of amplifiers - (a) Voltage amplifier, (b) Transimpedance amplifier, (c) Transconductance amplifier,
and (d) Current amplifier</span></figcaption><!-- tex4ht:label?: x1-1200113  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 403 --><p class='indent'>   To sense a voltage, we usually place a voltmeter in parallel. In case of feeback, any element that is used to sense a
voltage and is placed in parallel to the output makes a “shunt feedback” [<a id='x1-12002'></a><a href='#cite.0_razavi_design_2017'>12</a>]. Similarly, a current is sensed with an ammeter
in series. For a feedback system, any element that perform a similar function and is in series with the output makes a “series
feedback”. Note that here we’re only talking about the sensing mechanism at the output - we are not talking about the
quantity that is returned to the input.
</p>
   <h5 class='subsubsectionHead' id='seriesshunt-or-voltagevoltage-feedback'><span class='titlemark'>2.2.1   </span> <a id='x1-130002.2.1'></a>Series-Shunt or Voltage-Voltage Feedback</h5>
<!-- l. 410 --><p class='noindent'>Let us first consider the simplest case without loading the input or output. Figure <a href='#left-ideal-seriesshunt-voltagevoltage-feedback-right-adding-loading-at-the-input'>14<!-- tex4ht:ref: fig:series_shunt_fb  --></a> shows the topology of a series-shunt or
a voltage-voltage feedback. The feedback network shunts the output voltage and feeds it in series to the input
voltage.
</p>
   <figure class='figure' id='x1-1300114'><span id='left-ideal-seriesshunt-voltagevoltage-feedback-right-adding-loading-at-the-input'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 415 --><p class='noindent'><img alt='PIC' height='225' src='images/series-shunt.png' width='225' /><img alt='PIC' height='250' src='images/series-shunt-source_res.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 14: </span><span class='content'>(Left) Ideal series-shunt (voltage-voltage) feedback. (Right) Adding loading at the input</span></figcaption><!-- tex4ht:label?: x1-1300114  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 420 --><p class='indent'>   We can write the following equations
</p><!-- l. 430 --><p class='indent'>   \begin {equation}  \label {eqn:ideal_series-shunt_eqns} \begin {split} v_o &amp;= av_e \\ v_{fb} &amp;= fv_o \\ v_e &amp;= v_i - v_{fb} \\ \implies \frac {v_o}{v_i} &amp;= \frac {a}{1+af} \end {split}  \end {equation}<a id='x1-13002r10'></a>
</p><!-- l. 432 --><p class='indent'>   Equation <a href='#x1-13002r10'>10<!-- tex4ht:ref: eqn:ideal_series-shunt_eqns  --></a> show that we get the same voltage gain as in the ideal case. If there was a voltage source (\(v_s\)) with some
finite impedance (\(z_s\)), and the amplifier has a finite impedance as well (\(z_{i}\)), then we get a voltage divider at the
input
</p><!-- l. 435 --><p class='indent'>   \[v_i = \frac {z_i}{z_i + z_s}v_s\]
</p><!-- l. 437 --><p class='indent'>   This shows that an ideal input to this system is a voltage input (since it will ideally have zero source impedance) and
the entire input voltage shows up at the input of the amplifier.
</p><!-- l. 440 --><p class='indent'>   Let us now analyze how this kind of feeback affects the input and output impedance of the open-loop
amplifier.
</p>
   <figure class='figure' id='x1-1300315'><span id='left-calculating-input-impedance-right-calculating-output-impedance'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 444 --><p class='noindent'><img alt='PIC' height='225' src='images/series-shunt-impedance.png' width='225' /><img alt='PIC' height='225' src='images/series-shunt-output_impedance.png' width='225' />
</p>
<figcaption class='caption'><span class='id'>Figure 15: </span><span class='content'>(Left) Calculating input impedance. (Right) Calculating output impedance</span></figcaption><!-- tex4ht:label?: x1-1300315  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 449 --><p class='indent'>   For input impedance, we see that \(z_i\) has a series element \(fv_0\) that causes a change from its open-loop value. Can we make a
guess by looking at figure <a href='#left-calculating-input-impedance-right-calculating-output-impedance'>15<!-- tex4ht:ref: fig:series_shunt_impedances  --></a> if the input impedance will increase or decrease with feedback? We can intuit
that in open-loop entire \(v_i\) was dropped across \(z_i\) leading to a higher current draw from the source. In case of
feedback, we see that only the error voltage is dropped across \(z_i\) - therefore, drawing smaller current from the
source. In case of feeback, it is always better to calculate and then sharpen your intuition. We get that \(z_{i,CL} = z_{i} (1+T)\) where
\(T=af\).
</p><!-- l. 454 --><p class='indent'>   Similarly, for output impedance, we can guess that a shunt connection will probably decrease the impedance as
compared to its open-loop counterpart. This is indeed true and is verified by calculations. We get that \(z_{o,CL} = z_{o} /(1+T)\) where
\(T=af\).
</p>
   <figure class='figure' id='x1-1300416'><span id='left-equivalent-ckt-in-feedback-right-equivalent-ckt-when-t-'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 459 --><p class='noindent'><img alt='PIC' height='250' src='images/series-shunt-equivalent.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 16: </span><span class='content'>(Left) Equivalent ckt in feedback. (Right) Equivalent ckt when \(T \rightarrow \inf \)</span></figcaption><!-- tex4ht:label?: x1-1300416  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 464 --><p class='indent'>   With the above results, a series-shunt or a voltage-voltage feedback can be summarized using the equivalent ckts in
figure <a href='#left-equivalent-ckt-in-feedback-right-equivalent-ckt-when-t-'>16<!-- tex4ht:ref: fig:series_shunt_equivalent  --></a>.
</p>
   <h5 class='subsubsectionHead' id='shuntshunt-or-voltagecurrent-feedback'><span class='titlemark'>2.2.2   </span> <a id='x1-140002.2.2'></a>Shunt-Shunt or Voltage-Current Feedback</h5>
<!-- l. 468 --><p class='noindent'>In shunt-shunt feedback, we sense the output voltage in a shunt configuration similar to the previous case, but now, we
feeback current to the input in a shunt configuration as well. Hence, this topology is also called as voltage-current
feedback.
</p>
   <figure class='figure' id='x1-1400117'><span id='shuntshunt-feedback'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 473 --><p class='noindent'><img alt='PIC' height='150' src='images/shunt-shunt.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 17: </span><span class='content'>Shunt-shunt feedback</span></figcaption><!-- tex4ht:label?: x1-1400117  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 478 --><p class='indent'>   From figure <a href='#shuntshunt-feedback'>17<!-- tex4ht:ref: fig:shunt_shunt_fb  --></a>, we see that any source resistance shunts the input small signal current away from the input impedance \(z_i\)
of the open-loop amplifier, thus, killing any transimpedance gain. Therefore, we want the source to have an infinite input
impedance, i.e., we want a current source.
</p><!-- l. 481 --><p class='indent'>   For this configuration, we can derive the following results
</p><!-- l. 491 --><p class='indent'>   \begin {equation}  \label {eqn:shunt-shunt_eqns} \begin {split} \frac {v_o}{i_i} &amp;= \frac {a}{1+af} \\ z_{i,CL} &amp;= \frac {z_i}{1+T} \\ z_{0,CL} &amp;= \frac {z_o}{1+T} \end {split}  \end {equation}<a id='x1-14002r11'></a>
</p><!-- l. 493 --><p class='indent'>   From eqns <a href='#x1-14002r11'>11<!-- tex4ht:ref: eqn:shunt-shunt_eqns  --></a>, we note thatm the transimpedance follows the ideal feedback eqn, and that both the input
and output impedances are reduced by \(1+T\) where \(T=af\). Figure <a href='#shuntshunt-equivalent-ckt'>18<!-- tex4ht:ref: fig:shunt_shunt_impedances  --></a> shows the equivalent ckt with the results derived
above.
</p>
   <figure class='figure' id='x1-1400318'><span id='shuntshunt-equivalent-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 499 --><p class='noindent'><img alt='PIC' height='150' src='images/shunt-shunt_impedances.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 18: </span><span class='content'>Shunt-shunt equivalent ckt</span></figcaption><!-- tex4ht:label?: x1-1400318  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 504 --><p class='indent'>   This configuration makes a good transimpedance amplifier where there is a current input and a voltage
output.
</p>
   <h5 class='subsubsectionHead' id='other-feedback-configurations-and-summary'><span class='titlemark'>2.2.3   </span> <a id='x1-150002.2.3'></a>Other Feedback Configurations and Summary</h5>
<!-- l. 508 --><p class='noindent'>From the above two sections, we’ve seen that a shunt feedback (whether at input or output) decreases that particular
impedance by \(1+T\) and a series feedback increases it by \(1+T\). We can, therefore, summarize the remaining two kinds of feedback
using these results.
</p>
   <div class='table'>
                                                                                               
                                                                                               
<!-- l. 511 --><p class='indent' id='summary-of-different-kinds-of-feedback'>   <a id='x1-150011'></a></p><figure class='float'>
                                                                                               
                                                                                               
<figcaption class='caption'><span class='id'>Table 1: </span><span class='content'>Summary of different kinds of feedback</span></figcaption><!-- tex4ht:label?: x1-150011  -->
<div class='tabular'> <table class='tabular' id='TBL-2'><colgroup id='TBL-2-1g'><col id='TBL-2-1' /></colgroup><colgroup id='TBL-2-2g'><col id='TBL-2-2' /></colgroup><colgroup id='TBL-2-3g'><col id='TBL-2-3' /></colgroup><colgroup id='TBL-2-4g'><col id='TBL-2-4' /></colgroup><colgroup id='TBL-2-5g'><col id='TBL-2-5' /></colgroup><colgroup id='TBL-2-6g'><col id='TBL-2-6' /></colgroup><tr class='hline'><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-2-1-' style='vertical-align:baseline;'><td class='td11' id='TBL-2-1-1' style='white-space:nowrap; text-align:center;'>Configuration</td><td class='td11' id='TBL-2-1-2' style='white-space:nowrap; text-align:center;'> Output sensed </td><td class='td11' id='TBL-2-1-3' style='white-space:nowrap; text-align:center;'> Input fedback </td><td class='td11' id='TBL-2-1-4' style='white-space:nowrap; text-align:center;'> Ideal input source </td><td class='td11' id='TBL-2-1-5' style='white-space:nowrap; text-align:center;'>Input impedance</td><td class='td11' id='TBL-2-1-6' style='white-space:nowrap; text-align:center;'>Output impedance</td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-2-2-' style='vertical-align:baseline;'><td class='td11' id='TBL-2-2-1' style='white-space:nowrap; text-align:center;'> Series-shunt  </td><td class='td11' id='TBL-2-2-2' style='white-space:nowrap; text-align:center;'>Voltage (shunt)</td><td class='td11' id='TBL-2-2-3' style='white-space:nowrap; text-align:center;'>Voltage (series)</td><td class='td11' id='TBL-2-2-4' style='white-space:nowrap; text-align:center;'>Ideal voltage source</td><td class='td11' id='TBL-2-2-5' style='white-space:nowrap; text-align:center;'>       \(z_i(1+T)\)       </td><td class='td11' id='TBL-2-2-6' style='white-space:nowrap; text-align:center;'>        \(\frac {z_o}{1+T}\)        </td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-2-3-' style='vertical-align:baseline;'><td class='td11' id='TBL-2-3-1' style='white-space:nowrap; text-align:center;'> Shunt-shunt  </td><td class='td11' id='TBL-2-3-2' style='white-space:nowrap; text-align:center;'>Voltage (shunt)</td><td class='td11' id='TBL-2-3-3' style='white-space:nowrap; text-align:center;'>Current (shunt)</td><td class='td11' id='TBL-2-3-4' style='white-space:nowrap; text-align:center;'>Ideal current source</td><td class='td11' id='TBL-2-3-5' style='white-space:nowrap; text-align:center;'>       \(\frac {z_i}{1+T}\)       </td><td class='td11' id='TBL-2-3-6' style='white-space:nowrap; text-align:center;'>        \(\frac {z_o}{1+T}\)        </td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-2-4-' style='vertical-align:baseline;'><td class='td11' id='TBL-2-4-1' style='white-space:nowrap; text-align:center;'> Shunt-series  </td><td class='td11' id='TBL-2-4-2' style='white-space:nowrap; text-align:center;'>Current (series)</td><td class='td11' id='TBL-2-4-3' style='white-space:nowrap; text-align:center;'>Current (shunt)</td><td class='td11' id='TBL-2-4-4' style='white-space:nowrap; text-align:center;'>Ideal current source</td><td class='td11' id='TBL-2-4-5' style='white-space:nowrap; text-align:center;'>       \(\frac {z_i}{1+T}\)       </td><td class='td11' id='TBL-2-4-6' style='white-space:nowrap; text-align:center;'>        \(z_o(1+T)\)        </td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-2-5-' style='vertical-align:baseline;'><td class='td11' id='TBL-2-5-1' style='white-space:nowrap; text-align:center;'> Series-series  </td><td class='td11' id='TBL-2-5-2' style='white-space:nowrap; text-align:center;'>Current (series)</td><td class='td11' id='TBL-2-5-3' style='white-space:nowrap; text-align:center;'>Voltage (series)</td><td class='td11' id='TBL-2-5-4' style='white-space:nowrap; text-align:center;'>Ideal voltage source</td><td class='td11' id='TBL-2-5-5' style='white-space:nowrap; text-align:center;'>       \(z_i(1+T)\)       </td><td class='td11' id='TBL-2-5-6' style='white-space:nowrap; text-align:center;'>        \(z_o(1+T)\)        </td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td><td></td></tr></table>                                                                                   </div>
                                                                                               
                                                                                               
   </figure>
   </div>
<!-- l. 528 --><p class='indent'>   From table <a href='#summary-of-different-kinds-of-feedback'>1<!-- tex4ht:ref: tab:fb_summary  --></a>, we see that the configurations are usually named <span class='cmti-10'>Input connection type - Output connection type </span>(like say
series-shunt) or <span class='cmti-10'>Input fedback - Output sensed </span>(voltage-voltage correspondingly). Current at the output is always sensed in
series while voltage at output is sensed in parallel. This makes sense - a voltmeter is connected in parallel across a single
port, and an ammeter is connected in series across. On the other hand, a voltage input is fedback in series at the summing
node - voltages in series can add up, while current is fedback in parallel - since current summation takes place in parallel
ckts.
</p>
   <h4 class='subsectionHead' id='twoport-network-parameters'><span class='titlemark'>2.3   </span> <a id='x1-160002.3'></a>Two-port Network Parameters</h4>
<!-- l. 537 --><p class='noindent'>Let’s take a detour to explore two-port analysis. A generic three-terminal, two-port network is shown in figure
<a href='#a-generic-threeterminal-twoport-network'>19<!-- tex4ht:ref: fig:two-port  --></a>.
</p>
   <figure class='figure' id='x1-1600119'><span id='a-generic-threeterminal-twoport-network'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 542 --><p class='noindent'><img alt='PIC' height='150' src='images/two-port.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 19: </span><span class='content'>A generic three-terminal two-port network</span></figcaption><!-- tex4ht:label?: x1-1600119  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 547 --><p class='indent'>   Depending on what are the inputs and outputs of the network we can wirte a generic transfer function from input to
output
</p><!-- l. 564 --><p class='indent'>   \begin {equation}  \label {eqn:generic_two_port} \begin {bmatrix} S_{in,1} \\ S_{in,2} \end {bmatrix} = \begin {bmatrix} TF_{11} &amp; TF_{12} \\ TF_{21} &amp; TF_{22} \end {bmatrix} \begin {bmatrix} S_{out,1} \\ S_{out,2} \end {bmatrix}  \end {equation}<a id='x1-16002r12'></a>
</p><!-- l. 566 --><p class='indent'>   In eqn <a href='#x1-16002r12'>12<!-- tex4ht:ref: eqn:generic_two_port  --></a>, \(S_{in}\) and \(S_{out}\) can be currents or voltages and the transfer function can accordingly have unit-less, or resistance, or
conductance as units.
</p>
   <h5 class='subsubsectionHead' id='zparameters'><span class='titlemark'>2.3.1   </span> <a id='x1-170002.3.1'></a>Z-Parameters</h5>
<!-- l. 570 --><p class='noindent'>If in a two-port network, we wish to write the input and output voltages as a function of the currents in
and out of the network, we use Z-paramters of the two-port. Each element in the Z-matrix has the units of
resistance.
</p><!-- l. 587 --><p class='indent'>   \begin {equation}  \label {eqn:z-parameter} \begin {bmatrix} V_1 \\ V_2 \end {bmatrix} = \begin {bmatrix} Z_{11} &amp; Z_{12} \\ Z_{21} &amp; Z_{22} \end {bmatrix} \begin {bmatrix} I_1 \\ I_2 \end {bmatrix}  \end {equation}<a id='x1-17001r13'></a>
</p><!-- l. 589 --><p class='indent'>   To calculate each element of the Z-matrix, we set the complementary signal to 0.
</p><!-- l. 599 --><p class='indent'>   \begin {equation}  \label {eqn:z-matrix-elements} \begin {split} Z_{11} &amp;= \frac {V_1}{I_1} \hspace {1 mm}\vline _{I_2=0} \\ Z_{22} &amp;= \frac {V_2}{I_2} \hspace {1 mm}\vline _{I_1=0} \\ Z_{12} &amp;= \frac {V_1}{I_2} \hspace {1 mm}\vline _{I_2=0} \\ Z_{21} &amp;= \frac {V_2}{I_1} \hspace {1 mm}\vline _{I_1=0} \\ \end {split}  \end {equation}<a id='x1-17002r14'></a>
</p><!-- l. 601 --><p class='indent'>   In eqn <a href='#x1-17002r14'>14<!-- tex4ht:ref: eqn:z-matrix-elements  --></a>, whenever we need to set a current to zero, we basically leave that corresponding port open. In the list of
feedback configurations listed in table <a href='#summary-of-different-kinds-of-feedback'>1<!-- tex4ht:ref: tab:fb_summary  --></a>, to which one should we apply the Z-matrix for analysis? One test is to see what is
common to each port of the amplifier and the feedback network. For example, in a series-series feedback, current is sampled
at the output and a proportional voltage is added in series at the input. Since both the connections are in series, the
amplifier and the feedback network have the same current flowing through them at both the ports. This makes it easy for us
to use the Z-matrix.
</p><!-- l. 607 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='yparameters'><span class='titlemark'>2.3.2   </span> <a id='x1-180002.3.2'></a>Y-Parameters</h5>
<!-- l. 609 --><p class='noindent'>If in a two-port network, we wish to write the input and output currents as a function of the voltages at the input and
output of the network, we use Y-paramters of the two-port. Each element in the Y-matrix has the units of
conductance.
</p><!-- l. 626 --><p class='indent'>   \begin {equation}  \label {eqn:y-parameter} \begin {bmatrix} I_1 \\ I_2 \end {bmatrix} = \begin {bmatrix} Y_{11} &amp; Y_{12} \\ Y_{21} &amp; Y_{22} \end {bmatrix} \begin {bmatrix} V_1 \\ V_2 \end {bmatrix}  \end {equation}<a id='x1-18001r15'></a>
</p><!-- l. 628 --><p class='indent'>   To calculate each element of the Y-matrix, we set the complementary signal to 0.
</p><!-- l. 638 --><p class='indent'>   \begin {equation}  \label {eqn:y-matrix-elements} \begin {split} Y_{11} &amp;= \frac {I_1}{V_1} \hspace {1 mm}\vline _{V_2=0} \\ Y_{22} &amp;= \frac {I_2}{V_2} \hspace {1 mm}\vline _{V_1=0} \\ Y_{12} &amp;= \frac {I_1}{V_2} \hspace {1 mm}\vline _{V_2=0} \\ Y_{21} &amp;= \frac {I_2}{V_1} \hspace {1 mm}\vline _{V_1=0} \\ \end {split}  \end {equation}<a id='x1-18002r16'></a>
</p><!-- l. 640 --><p class='indent'>   In eqn <a href='#x1-18002r16'>16<!-- tex4ht:ref: eqn:y-matrix-elements  --></a>, whenever we need to set a voltage difference to zero, we basically short circuit that corresponding port. From
table <a href='#summary-of-different-kinds-of-feedback'>1<!-- tex4ht:ref: tab:fb_summary  --></a>, a shunt-shunt feedback can be analyzed using the Y-matrix since both the amplifier and the feedback network share
the same voltage across their ports.
</p><!-- l. 645 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='hparameters'><span class='titlemark'>2.3.3   </span> <a id='x1-190002.3.3'></a>H-Parameters</h5>
<!-- l. 647 --><p class='noindent'>If in a two-port network, we wish to write the input voltage and output current as a function of the input current and
output voltage of the network, we use H-paramters of the two-port. Diagonal elements in the H-matrix have the units of
resistance/conductance while off-diagonal elements are unitless.
                                                                                               
                                                                                               
</p><!-- l. 664 --><p class='indent'>   \begin {equation}  \label {eqn:h-parameter} \begin {bmatrix} V_1 \\ I_2 \end {bmatrix} = \begin {bmatrix} H_{11} &amp; H_{12} \\ H_{21} &amp; H_{22} \end {bmatrix} \begin {bmatrix} I_1 \\ V_2 \end {bmatrix}  \end {equation}<a id='x1-19001r17'></a>
</p><!-- l. 666 --><p class='indent'>   To calculate each element of the H-matrix, we set the corresponding signal to 0.
</p><!-- l. 676 --><p class='indent'>   \begin {equation}  \label {eqn:h-matrix-elements} \begin {split} H_{11} &amp;= \frac {V_1}{I_1} \hspace {1 mm}\vline _{V_2=0} \\ H_{22} &amp;= \frac {I_2}{V_2} \hspace {1 mm}\vline _{I_1=0} \\ H_{12} &amp;= \frac {V_1}{V_2} \hspace {1 mm}\vline _{I_1=0} \\ H_{21} &amp;= \frac {I_2}{I_1} \hspace {1 mm}\vline _{V_2=0} \\ \end {split}  \end {equation}<a id='x1-19002r18'></a>
</p><!-- l. 678 --><p class='indent'>   In eqn <a href='#x1-19002r18'>18<!-- tex4ht:ref: eqn:h-matrix-elements  --></a>, whenever we need to set a voltage difference to zero (or a current to zero), we basically short circuit that
corresponding port (or open it). From table <a href='#summary-of-different-kinds-of-feedback'>1<!-- tex4ht:ref: tab:fb_summary  --></a>, a series-shunt feedback can be analyzed using the H-matrix since both the
amplifier and the feedback network share the same current across their input ports and the same voltage across their output
ports.
</p><!-- l. 683 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='gparameters'><span class='titlemark'>2.3.4   </span> <a id='x1-200002.3.4'></a>G-Parameters</h5>
<!-- l. 685 --><p class='noindent'>If in a two-port network, we wish to write the input current and output voltage as a function of the input voltage and
output current of the network, we use G-paramters of the two-port. Diagonal elements in the G-matrix have the units of
conductance/resistance while off-diagonal elements are unitless.
</p><!-- l. 702 --><p class='indent'>   \begin {equation}  \label {eqn:g-parameter} \begin {bmatrix} I_1 \\ V_2 \end {bmatrix} = \begin {bmatrix} G_{11} &amp; G_{12} \\ G_{21} &amp; G_{22} \end {bmatrix} \begin {bmatrix} V_1 \\ I_2 \end {bmatrix}  \end {equation}<a id='x1-20001r19'></a>
</p><!-- l. 704 --><p class='indent'>   To calculate each element of the G-matrix, we set the corresponding signal to 0.
</p><!-- l. 714 --><p class='indent'>   \begin {equation}  \label {eqn:g-matrix-elements} \begin {split} G_{11} &amp;= \frac {I_1}{V_1} \hspace {1 mm}\vline _{I_2=0} \\ G_{22} &amp;= \frac {V_2}{I_2} \hspace {1 mm}\vline _{V_1=0} \\ G_{12} &amp;= \frac {I_1}{I_2} \hspace {1 mm}\vline _{V_1=0} \\ G_{21} &amp;= \frac {V_2}{V_1} \hspace {1 mm}\vline _{I_2=0} \\ \end {split}  \end {equation}<a id='x1-20002r20'></a>
</p><!-- l. 716 --><p class='indent'>   In eqn <a href='#x1-20002r20'>20<!-- tex4ht:ref: eqn:g-matrix-elements  --></a>, whenever we need to set a voltage difference to zero (or a current to zero), we basically short circuit that
corresponding port (or open it). From table <a href='#summary-of-different-kinds-of-feedback'>1<!-- tex4ht:ref: tab:fb_summary  --></a>, a shunt-series feedback can be analyzed using the G-matrix since both the
amplifier and the feedback network share the same voltage across their input ports and the same current across their output
ports.
</p><!-- l. 720 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='twoport-summary'><span class='titlemark'>2.3.5   </span> <a id='x1-210002.3.5'></a>Two-port summary</h5>
<!-- l. 722 --><p class='noindent'>Here is the summary of which parameters to use for feedback analysis.
</p>
   <div class='table'>
                                                                                               
                                                                                               
<!-- l. 725 --><p class='indent' id='summary-of-different-twoport-network-parameters'>   <a id='x1-210012'></a></p><figure class='float'>
                                                                                               
                                                                                               
<figcaption class='caption'><span class='id'>Table 2: </span><span class='content'>Summary of different two-port network parameters</span></figcaption><!-- tex4ht:label?: x1-210012  -->
<div class='tabular'> <table class='tabular' id='TBL-3'><colgroup id='TBL-3-1g'><col id='TBL-3-1' /></colgroup><colgroup id='TBL-3-2g'><col id='TBL-3-2' /></colgroup><colgroup id='TBL-3-3g'><col id='TBL-3-3' /></colgroup><colgroup id='TBL-3-4g'><col id='TBL-3-4' /></colgroup><colgroup id='TBL-3-5g'><col id='TBL-3-5' /></colgroup><tr class='hline'><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-3-1-' style='vertical-align:baseline;'><td class='td11' id='TBL-3-1-1' style='white-space:nowrap; text-align:center;'>Two-port parameter</td><td class='td11' id='TBL-3-1-2' style='white-space:nowrap; text-align:center;'>Feedback configuration</td><td class='td11' id='TBL-3-1-3' style='white-space:normal; text-align:left;'><!-- l. 732 --><p class='noindent'>Input vector         </p></td><td class='td11' id='TBL-3-1-4' style='white-space:normal; text-align:left;'><!-- l. 732 --><p class='noindent'>Output vector       </p></td><td class='td11' id='TBL-3-1-5' style='white-space:normal; text-align:left;'><!-- l. 732 --><p class='noindent'>Amplifier example  </p></td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-3-2-' style='vertical-align:baseline;'><td class='td11' id='TBL-3-2-1' style='white-space:nowrap; text-align:center;'>     Z-matrix        </td><td class='td11' id='TBL-3-2-2' style='white-space:nowrap; text-align:center;'>     Series-series       </td><td class='td11' id='TBL-3-2-3' style='white-space:normal; text-align:left;'><!-- l. 734 --><p class='noindent'>Input/Output
currents               </p></td><td class='td11' id='TBL-3-2-4' style='white-space:normal; text-align:left;'><!-- l. 734 --><p class='noindent'>Input/Output
voltages               </p></td><td class='td11' id='TBL-3-2-5' style='white-space:normal; text-align:left;'><!-- l. 734 --><p class='noindent'>Transconductance
amplifier              </p></td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-3-3-' style='vertical-align:baseline;'><td class='td11' id='TBL-3-3-1' style='white-space:nowrap; text-align:center;'>     Y-matrix        </td><td class='td11' id='TBL-3-3-2' style='white-space:nowrap; text-align:center;'>     Shunt-shunt       </td><td class='td11' id='TBL-3-3-3' style='white-space:normal; text-align:left;'><!-- l. 735 --><p class='noindent'>Input/Output
voltages               </p></td><td class='td11' id='TBL-3-3-4' style='white-space:normal; text-align:left;'><!-- l. 735 --><p class='noindent'>Input/Output
currents               </p></td><td class='td11' id='TBL-3-3-5' style='white-space:normal; text-align:left;'><!-- l. 735 --><p class='noindent'>Transimpedance
amplifier              </p></td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-3-4-' style='vertical-align:baseline;'><td class='td11' id='TBL-3-4-1' style='white-space:nowrap; text-align:center;'>     H-matrix        </td><td class='td11' id='TBL-3-4-2' style='white-space:nowrap; text-align:center;'>     Series-shunt       </td><td class='td11' id='TBL-3-4-3' style='white-space:normal; text-align:left;'><!-- l. 736 --><p class='noindent'>Input
current/Output
voltage                </p></td><td class='td11' id='TBL-3-4-4' style='white-space:normal; text-align:left;'><!-- l. 736 --><p class='noindent'>Input
voltage/Output
current                </p></td><td class='td11' id='TBL-3-4-5' style='white-space:normal; text-align:left;'><!-- l. 736 --><p class='noindent'>Voltage amplifier   </p></td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td></tr><tr id='TBL-3-5-' style='vertical-align:baseline;'><td class='td11' id='TBL-3-5-1' style='white-space:nowrap; text-align:center;'>     G-matrix        </td><td class='td11' id='TBL-3-5-2' style='white-space:nowrap; text-align:center;'>     Shunt-series       </td><td class='td11' id='TBL-3-5-3' style='white-space:normal; text-align:left;'><!-- l. 737 --><p class='noindent'>Input
voltage/Output
current                </p></td><td class='td11' id='TBL-3-5-4' style='white-space:normal; text-align:left;'><!-- l. 737 --><p class='noindent'>Input
current/Output
voltage                </p></td><td class='td11' id='TBL-3-5-5' style='white-space:normal; text-align:left;'><!-- l. 737 --><p class='noindent'>Current amplifier   </p></td>
</tr><tr class='hline'><td></td><td></td><td></td><td></td><td></td></tr></table>                                                                            </div>
                                                                                               
                                                                                               
   </figure>
   </div>
   <h4 class='subsectionHead' id='how-to-identify-feedback-types'><span class='titlemark'>2.4   </span> <a id='x1-220002.4'></a>How to identify feedback types?</h4>
<!-- l. 745 --><p class='noindent'>One trick is to see what are the input/output parameters we’re interested in. For example, in figure <a href='#example-of-a-shuntshunt-ckt'>20<!-- tex4ht:ref: fig:shunt_shunt_ex  --></a>, we see a voltage
being sensed by the feedback network - it definitely has to shunt it. The capacitor divider, which forms the feedback
network, is providing a voltage input to the gate of M1 - but it is providing a small signal current through M1 in feedback
to \(I_{in}\). Therefore, it is a shunt-shunt network (althoug it might look series-shunt due to the voltage fedback by the capacitor
divider).
</p>
   <figure class='figure' id='x1-2200120'><span id='example-of-a-shuntshunt-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 751 --><p class='noindent'><img alt='PIC' height='150' src='images/shunt-shunt_ex.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 20: </span><span class='content'>Example of a shunt-shunt ckt</span></figcaption><!-- tex4ht:label?: x1-2200120  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 756 --><p class='indent'>   Let us take a few more examples. In figure <a href='#another-example-of-a-shuntshunt-ckt'>21<!-- tex4ht:ref: fig:series_shunt_ex  --></a>, we’re shunting the voltage from the output but what is happening
with the input? At the input, we have a voltage input that is being converted into a current input by the
resistor R2. Therefore, at the negative input of the op-amp there is a summation of currents - meaning a shunt
feedback.
</p>
   <figure class='figure' id='x1-2200221'><span id='another-example-of-a-shuntshunt-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 768 --><p class='noindent'><img alt='PIC' height='150' src='images/series-shunt_ex.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 21: </span><span class='content'>Another example of a shunt-shunt ckt</span></figcaption><!-- tex4ht:label?: x1-2200221  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 773 --><p class='indent'>   In figure <a href='#another-example-of-a-seriesshunt-ckt'>22<!-- tex4ht:ref: fig:series_shunt_ex2  --></a>, the output is clearly shunted and feedback is applied to the gate of M2. Now, how do we identify the
summing node and the kind of feedback at the input? It seems like the case in figure <a href='#example-of-a-shuntshunt-ckt'>20<!-- tex4ht:ref: fig:shunt_shunt_ex  --></a>, where the gate
voltage applied to the feedback transistor is summed with the input current. However, in figure <a href='#another-example-of-a-seriesshunt-ckt'>22<!-- tex4ht:ref: fig:series_shunt_ex2  --></a>, there is no
current input and the summing node is the difference between votlages applied at M1 and M2 (since this is
a differential amplifier). Therefore, the voltages are added in series and this is a series-shunt feedback as
well.
</p>
   <figure class='figure' id='x1-2200322'><span id='another-example-of-a-seriesshunt-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 781 --><p class='noindent'><img alt='PIC' height='150' src='images/series-shunt_ex2.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 22: </span><span class='content'>Another example of a series-shunt ckt</span></figcaption><!-- tex4ht:label?: x1-2200322  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 787 --><p class='indent'>   Finally, let us look at the example in figure <a href='#example-of-a-shuntseries-ckt'>23<!-- tex4ht:ref: fig:shunt_series-ex  --></a>. Here, the output current is sensed in series using \(R_s\). If we did not have \(R_s\), we
wouldn’t have the series element which causes voltage drop due to the output current. Then, are we feeding back a voltage
through \(R_F\) or a current? It seems like the voltage at node Y responds to changes in \(i_{out}\) and this is fedback to the gate of M1.
While this might seem to be the case, note that the input is a current source and the summing node is actually Y and not
the gate of M1. The input current is shunted and sent to the summing node at Y. Hence, this is an example of a
shunt-series feedback.
</p>
   <div class='tcolorbox tcolorbox' id='tcolobox-5'>     
<div class='tcolorbox-title'>
   </div> 
<div class='tcolorbox-content'>       <ol class='enumerate1'>
<li class='enumerate' id='x1-22005x1'>First, identify output type - a voltage output is always shunted while a current output is always sensed
       in series.
       </li>
<li class='enumerate' id='x1-22007x2'>Second, identify the summing node - currents are summed in a shunt configuration while voltages
       are  summed  in  a  series  configuration.  The  summing  node  need  not  necessarily  be  at  the  source
       (voltage/current). It is usually a node where a part of the input and output signal are summed (in
       case of differential amplifiers, differenced).
       </li>
<li class='enumerate' id='x1-22009x3'>Next, identify how the input is being sensed and brought into the summing node. At the input, currents
       are sensed in a shunt manner and voltages are sensed in series. This is because we want to create an
       error signal that is the differnce of the input and the feedback signals.
       </li>
<li class='enumerate' id='x1-22011x4'>Finally, apply the required two-port metric from table <a href='#summary-of-different-twoport-network-parameters'>2<!-- tex4ht:ref: tab:two-port_summary  --></a> - it depends on what is common between the
       feedback network and the amplifier (input/output currents/voltages). Calculate the loop gain, and the
       corresponding input and output impedances using table <a href='#summary-of-different-kinds-of-feedback'>1<!-- tex4ht:ref: tab:fb_summary  --></a>.</li></ol>
 
</div> 
</div>
   <figure class='figure' id='x1-2201223'><span id='example-of-a-shuntseries-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 808 --><p class='noindent'><img alt='PIC' height='150' src='images/shunt-series-ex.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 23: </span><span class='content'>Example of a shunt-series ckt</span></figcaption><!-- tex4ht:label?: x1-2201223  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='effect-of-loading-on-input-and-output-due-to-feedback'><span class='titlemark'>2.5   </span> <a id='x1-230002.5'></a>Effect of loading on input and output due to feedback</h4>
<!-- l. 819 --><p class='noindent'>When discussing different feedback configurations, we assumed that the feedback network doesn’t load the input or output.
While this can be true in some cases, it is not universally true and mostly not the case in practice. We need to
study how the feedback network loads the input and output of the amplifier. We will study an example
with shunt-shunt feedback. Luckily, all the results from this study are readily extended to other feedback
configurations.
</p><!-- l. 822 --><p class='indent'>   From table <a href='#summary-of-different-twoport-network-parameters'>2<!-- tex4ht:ref: tab:two-port_summary  --></a>, we know that for a shunt-shunt feedback, we use Y-parameters (since both the feedback
network and the amplifier share the same voltage at input and output). We define Y-parameters for both
the amplifier and the feedback network. Figure <a href='#left-complete-picture-of-the-amplifier-and-feedback-network-using-twoport-analysis-right-simplified-representation-after-reasonable-assumptions'>24<!-- tex4ht:ref: fig:shunt_shunt-loading  --></a> on the left shows a complete picture using the two-port
model.
</p>
   <figure class='figure' id='x1-2300124'><span id='left-complete-picture-of-the-amplifier-and-feedback-network-using-twoport-analysis-right-simplified-representation-after-reasonable-assumptions'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 827 --><p class='noindent'><img alt='PIC' height='225' src='images/shunt-shunt-loading.png' width='225' /><img alt='PIC' height='250' src='images/shunt-shunt-loading2.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 24: </span><span class='content'>(Left) Complete picture of the amplifier and feedback network using two-port analysis. (Right) Simplified
representation after reasonable assumptions</span></figcaption><!-- tex4ht:label?: x1-2300124  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 832 --><p class='indent'>   If we first make no assumptions, and let \(y_i = y_s + y_{11a} + y_{11f}\) and \(y_o = y_L + y_{22a} + y_{22f}\), we get the following results
</p><!-- l. 841 --><p class='indent'>   \begin {equation}  \label {eqn:shunt-shunt-loading-eqns} \begin {split} a &amp;= -\frac {y_{21a}+y_{21f}}{y_iy_o} \\ f &amp;= y_{12a} + y_{12f} \\ \frac {v_o}{i_s} &amp;= \frac {a}{1+af} \end {split}  \end {equation}<a id='x1-23002r21'></a>
</p><!-- l. 843 --><p class='indent'>   Let us understand the expressions in eqn <a href='#x1-23002r21'>21<!-- tex4ht:ref: eqn:shunt-shunt-loading-eqns  --></a>. The amplifier forward gain (which is obtained by essentially removing the
feeding back parts of the feedback network) is the sum of the transconductance from \(v_i\) to \(v_o\) through the amplifier and the
feedback network, whole divided by the product of total loading seen at the input and output (when I say loading, I mean
cis-parameters not trans ones). Why does product come here in the denominator? - I have no intuitive explanation for this.
The feedback factor (\(f\)) is essentially the feedback from \(v_o\) back to \(v_i\) through the amplifier and the feedback
network.
</p><!-- l. 847 --><p class='indent'>   We can make two reasonable approximations here. We assume that the feedforward path is much greater
through the amplifier than it is through the feedback - \(y_{21a} &gt;&gt; y_{21f}\). Second, we also assume that the feedback from the
feedback network is much larger than the feedback of the amplifier - \(y_{12a} &lt;&lt; y_{12f}\). This reduces the expressions in eqn <a href='#x1-23002r21'>21<!-- tex4ht:ref: eqn:shunt-shunt-loading-eqns  --></a>
to
</p><!-- l. 856 --><p class='indent'>   \begin {equation}  \label {eqn:shunt-shunt-loading-eqns2} \begin {split} a &amp;= -\frac {y_{21a}}{y_iy_o} \\ f &amp;= y_{12f} \\ \end {split}  \end {equation}<a id='x1-23003r22'></a>
</p><!-- l. 858 --><p class='indent'>   We use eqns <a href='#x1-23003r22'>22<!-- tex4ht:ref: eqn:shunt-shunt-loading-eqns2  --></a> for further analysis. Since we know the transmission gain, \(T=af\), and we also know the kind of feedback
configuration, we can use table <a href='#summary-of-different-kinds-of-feedback'>1<!-- tex4ht:ref: tab:fb_summary  --></a> to calculate the closed-loop input and output impedances of this system. Note that since
transmission gain is a function of both the forward gain from the amplifier and the feedback network, we can change the
closed-loop impedances by turning either knobs.
</p><!-- l. 862 --><p class='indent'>   While we used the shunt-shunt configuration to study impact of loading, [<a id='x1-23004'></a><a href='#cite.0_gray_analog_2009'>5</a>] proves that the same analysis
holds for every other feedback configuration - we only need to substitute the correct two-port metrics in eqn
<a href='#x1-23003r22'>22<!-- tex4ht:ref: eqn:shunt-shunt-loading-eqns2  --></a>.
</p>
   <div class='table'>
                                                                                               
                                                                                               
<!-- l. 866 --><p class='indent' id='summary-of-calculating-openloop-gain-and-feedback-factor-for-different-feedback-configurations'>   <a id='x1-230053'></a></p><figure class='float'>
                                                                                               
                                                                                               
<figcaption class='caption'><span class='id'>Table 3: </span><span class='content'>Summary of calculating open-loop gain and feedback factor for different feedback configurations</span></figcaption><!-- tex4ht:label?: x1-230053  -->
<div class='tabular'> <table class='tabular' id='TBL-4'><colgroup id='TBL-4-1g'><col id='TBL-4-1' /></colgroup><colgroup id='TBL-4-2g'><col id='TBL-4-2' /></colgroup><colgroup id='TBL-4-3g'><col id='TBL-4-3' /></colgroup><tr class='hline'><td></td><td></td><td></td></tr><tr id='TBL-4-1-' style='vertical-align:baseline;'><td class='td11' id='TBL-4-1-1' style='white-space:nowrap; text-align:center;'>Feedback configuration</td><td class='td11' id='TBL-4-1-2' style='white-space:nowrap; text-align:center;'>Open-loop gain (\(a\))</td><td class='td11' id='TBL-4-1-3' style='white-space:nowrap; text-align:center;'>Feedback factor (\(f\))</td>
</tr><tr class='hline'><td></td><td></td><td></td></tr><tr id='TBL-4-2-' style='vertical-align:baseline;'><td class='td11' id='TBL-4-2-1' style='white-space:nowrap; text-align:center;'>     Series-series        </td><td class='td11' id='TBL-4-2-2' style='white-space:nowrap; text-align:center;'>       \(-\frac {z_{21a}}{z_iz_o}\)       </td><td class='td11' id='TBL-4-2-3' style='white-space:nowrap; text-align:center;'>        \(z_{12f}\)        </td></tr><tr class='hline'><td></td><td></td><td></td></tr><tr id='TBL-4-3-' style='vertical-align:baseline;'><td class='td11' id='TBL-4-3-1' style='white-space:nowrap; text-align:center;'> Shunt-shunt </td><td class='td11' id='TBL-4-3-2' style='white-space:nowrap; text-align:center;'>  \(-\frac {y_{21a}}{y_iy_o}\) </td><td class='td11' id='TBL-4-3-3' style='white-space:nowrap; text-align:center;'>  \(y_{12f}\)</td>
</tr><tr class='hline'><td></td><td></td><td></td></tr><tr id='TBL-4-4-' style='vertical-align:baseline;'><td class='td11' id='TBL-4-4-1' style='white-space:nowrap; text-align:center;'>     Series-shunt        </td><td class='td11' id='TBL-4-4-2' style='white-space:nowrap; text-align:center;'>       \(-\frac {h_{21a}}{h_ih_o}\)       </td><td class='td11' id='TBL-4-4-3' style='white-space:nowrap; text-align:center;'>        \(h_{12f}\)        </td>
</tr><tr class='hline'><td></td><td></td><td></td></tr><tr id='TBL-4-5-' style='vertical-align:baseline;'><td class='td11' id='TBL-4-5-1' style='white-space:nowrap; text-align:center;'>     Shunt-series        </td><td class='td11' id='TBL-4-5-2' style='white-space:nowrap; text-align:center;'>       \(-\frac {g_{21a}}{g_ig_o}\)       </td><td class='td11' id='TBL-4-5-3' style='white-space:nowrap; text-align:center;'>        \(g_{12f}\)        </td>
</tr><tr class='hline'><td></td><td></td><td></td></tr></table>                                                                          </div>
                                                                                               
                                                                                               
   </figure>
   </div>
<!-- l. 882 --><p class='indent'>   One advantage of this analysis is that it can be easily extended to multi-feedback systems and does not involve any
breaking of the loop. This is all good, but given a ckt, how do we calculate these individual two-port parameters for both
the amplifier and the feedback network? Let us start with some simple examples. Figure <a href='#analysis-a-tia-using-twoport-parameters'>25<!-- tex4ht:ref: fig:shunt_shunt-ex2  --></a> shows a TIA which employs a
shunt-shunt feedback.
</p>
   <figure class='figure' id='x1-2300625'><span id='analysis-a-tia-using-twoport-parameters'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 887 --><p class='noindent'><img alt='PIC' height='225' src='images/shunt-shunt_ex2.png' width='225' /><img alt='PIC' height='250' src='images/shunt-shunt_ex2_ss.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 25: </span><span class='content'>Analysis a TIA using two-port parameters</span></figcaption><!-- tex4ht:label?: x1-2300625  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 892 --><p class='indent'>   Without \(R_F\), it is straightforward to analyse the open-loop gain (\(a\)) of the TIA. How do we view \(R_F\) as a two port network that
is in shunt-shunt with the amplifier’s input and output?
</p>
   <figure class='figure' id='x1-2300726'><span id='extracting-two-port-parameters-for-the-feedback-resistor'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 896 --><p class='noindent'><img alt='PIC' height='150' src='images/rf_tia.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 26: </span><span class='content'>Extracting two port parameters for the feedback resistor</span></figcaption><!-- tex4ht:label?: x1-2300726  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 901 --><p class='indent'>   Since we can isolate the feedback network, we now do a two-port analysis on that part alone using the ckt shown in
figure <a href='#extracting-two-port-parameters-for-the-feedback-resistor'>26<!-- tex4ht:ref: fig:rf_tia  --></a>. For the feedback network,
</p><!-- l. 903 --><p class='indent'>   \[y_{11f} = \frac {i_1}{v_1} \hspace {1mm} \vline _{v_2 = 0} = \frac {1}{R_F}\] \[y_{22f} = \frac {i_2}{v_2} \hspace {1mm} \vline _{v_1 = 0} = \frac {1}{R_F}\] \[f = y_{12f} = \frac {i_1}{v_2} \hspace {1mm} \vline _{v_1 = 0} = -\frac {1}{R_F}\]
</p><!-- l. 908 --><p class='indent'>   We now have the effect of the loading from the feedback network. We can redraw the small-signal model in figure <a href='#analysis-a-tia-using-twoport-parameters'>25<!-- tex4ht:ref: fig:shunt_shunt-ex2  --></a> by
lumping the \(y_{11/22f}\) parts with the amplifier’s corresponding parameters.
</p>
   <figure class='figure' id='x1-2300827'><span id='the-amplifier-is-loaded-by-yf-and-yf-at-the-input-and-output-respectively-with-a-feedback-factor-of-yf'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 912 --><p class='noindent'><img alt='PIC' height='225' src='images/new_tia.png' width='225' />
</p>
<figcaption class='caption'><span class='id'>Figure 27: </span><span class='content'>The amplifier is loaded by \(y_{11f}\) and \(y_{22f}\) at the input and output respectively with a feedback factor of \(y_{12f}\).</span></figcaption><!-- tex4ht:label?: x1-2300827  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 917 --><p class='indent'>   With figure <a href='#the-amplifier-is-loaded-by-yf-and-yf-at-the-input-and-output-respectively-with-a-feedback-factor-of-yf'>27<!-- tex4ht:ref: fig:new_tia  --></a>, we can calculate \(a\) knowing that \(y_{21a} = -a_v/z_0\), and \(y_i = (1/R_F + 1/z_i)\) and \(y_o = (1/z_o + 1/R_F + 1/R_L)\). Note that I converted the Thevenin model of the op-amp to
a Norton equivalent and that admittances are added up - not resistances.
</p><!-- l. 919 --><p class='indent'>   \[a = \frac {y_{21a}}{y_iy_o} = -\frac {a_v(R_FR_L)(R_Fz_i)}{(R_F+z_i)(R_F+R_L+z_o)}\]
</p><!-- l. 921 --><p class='indent'>   We now know \(T=af\) and can calculate closed loop impedances at the input and output. For the open-loop impedance, remove \(i_{fb}\)
and we get
</p><!-- l. 923 --><p class='indent'>   \[z_{i,OL} = R_F || z_i\] \[z_{o,OL} = R_F || z_o || R_L\]
</p><!-- l. 926 --><p class='indent'>   Since the feedback is shunt at the input and output, the open-loop impedances are divided by \(1+T\) at both
places.
</p><!-- l. 929 --><p class='indent'>   Let’s do another example. Figure <a href='#inverting-opamp-as-a-seriesshunt-feedback-ckt'>28<!-- tex4ht:ref: fig:series-shunt_ex3  --></a> shows an inverting op-amp as a series-shunt feedback ckt. We can easily
identify the feedback network in this case. From table <a href='#summary-of-different-twoport-network-parameters'>2<!-- tex4ht:ref: tab:two-port_summary  --></a>, we know that H-parameters are appropriate for
analysis.
</p>
   <figure class='figure' id='x1-2300928'><span id='inverting-opamp-as-a-seriesshunt-feedback-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 935 --><p class='noindent'><img alt='PIC' height='175' src='images/series-shunt_ex3.png' width='175' />
</p>
<figcaption class='caption'><span class='id'>Figure 28: </span><span class='content'>Inverting op-amp as a series-shunt feedback ckt.</span></figcaption><!-- tex4ht:label?: x1-2300928  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 942 --><p class='indent'>   Similar to figure <a href='#extracting-two-port-parameters-for-the-feedback-resistor'>26<!-- tex4ht:ref: fig:rf_tia  --></a>, what should be the ckt to evaluate the H-parameters of the feedback network here? Remember that
we are trying to express \(V_1\) and \(I_2\) as a function of \(I_1\) and \(V_2\) when using H-matrix. Therefore, figure <a href='#calculating-hparameters-for-the-feedback-network'>29<!-- tex4ht:ref: fig:feedback_h  --></a> needs to be used to extract
the H-parameters for the feedback network.
</p>
   <figure class='figure' id='x1-2301029'><span id='calculating-hparameters-for-the-feedback-network'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 948 --><p class='noindent'><img alt='PIC' height='175' src='images/feedback_h.png' width='175' />
</p>
<figcaption class='caption'><span class='id'>Figure 29: </span><span class='content'>Calculating H-parameters for the feedback network</span></figcaption><!-- tex4ht:label?: x1-2301029  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 953 --><p class='indent'>   \[h_{11f} = \frac {v_1}{i_1} \hspace {1mm} \vline _{v_2 = 0} = R_E || R_F\] \[h_{22f} = \frac {i_2}{v_2} \hspace {1mm} \vline _{i_1 = 0} = \frac {1}{R_F+R_E}\] \[f = h_{12f} = \frac {v_1}{v_2} \hspace {1mm} \vline _{i_1 = 0} = \frac {R_E}{R_F+R_E}\]
</p><!-- l. 957 --><p class='indent'>   What about the H-parameters of the basic amplifier? This is a bit involved but makes our life easier when calculating
open-loop gain \(a\). Figure <a href='#calculating-hparameters-for-the-opamp'>30<!-- tex4ht:ref: fig:h_parameters_opamp  --></a> goes through converting the ckt into the required form.
</p>
   <figure class='figure' id='x1-2301130'><span id='calculating-hparameters-for-the-opamp'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 962 --><p class='noindent'><img alt='PIC' height='250' src='images/h-parameter_op-amp.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 30: </span><span class='content'>Calculating H-parameters for the op-amp</span></figcaption><!-- tex4ht:label?: x1-2301130  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 967 --><p class='indent'>   \[h_{11a} = z_i\] \[h_{22a} = \frac {1}{z_o} \] \[h_{21a} = -\frac {a_v z_i}{z_o} \]
</p><!-- l. 971 --><p class='indent'>   We now calculate \(h_i = h_{11a} + h_{11f}\), \(h_o = h_{22a} + h_{22f} + 1/R_L\), and \(a = -\frac {h_{21a}}{h_ih_o}\).
</p><!-- l. 973 --><p class='indent'>   \[h_i = z_i + \frac {R_ER_F}{R_E+R_F}\] \[h_o = \frac {1}{z_o} + \frac {1}{R_E + R_F} + \frac {1}{R_L}\] \[a = \frac {a_v z_i (R_E+R_F)R_L}{(R_E+R_F)R_L+z_o(R_E+R_F+R_L)}\]
</p><!-- l. 977 --><p class='indent'>   We can now calculate \(T=af\) and use it calculate the closed-loop impedances given the open-loop inmpedances
</p><!-- l. 979 --><p class='indent'>   \[z_{i,OL} = h_{11f} + h_{11a} = z_i + R_E || R_F\] \[\frac {1}{z_{o,OL}} = h_{22f} + h_{22a} + \frac {1}{R_L} = \frac {1}{R_F+R_E} + \frac {1}{z_o} + \frac {1}{R_L}\]
</p><!-- l. 982 --><p class='indent'>   I believe that 2-port analysis is most helpful in series-series or shunt-sunt feedback configurations when Z- and
Y-matrices can be used and are straightforward to calculate for both the feedback network and the amplifier. In other cases,
H- and G-matrices are invloved which needs an additional transformation on the amplifier itself and the units of different
elements in the matrix need to be taken care of.
</p>
   <h4 class='subsectionHead' id='how-to-deal-with-active-components-in-feedback'><span class='titlemark'>2.6   </span> <a id='x1-240002.6'></a>How to deal with active components in feedback?</h4>
<!-- l. 989 --><p class='noindent'>So far, most of the examples of feedback only included passive components such as resistors (or capacitors). What if there is
a transistor as a part of the feedback network? Let us consider the ckt in figure <a href='#example-of-a-shuntshunt-ckt'>20<!-- tex4ht:ref: fig:shunt_shunt_ex  --></a> where we have a shunt-shunt feedback -
let’s replace the capacitive feedback with a resistive feedback network. Figure <a href='#feedback-network-involves-transistor-m'>31<!-- tex4ht:ref: fig:active_fb  --></a> works through an example.
Interestingly, the open-loop gain does not depend on \(g_{m2}\) - could this be due to the loading of the feedback
resistors?
</p>
   <figure class='figure' id='x1-2400131'><span id='feedback-network-involves-transistor-m'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 995 --><p class='noindent'><img alt='PIC' height='150' src='images/active_fb_ex1.png' width='150' /><img alt='PIC' height='150' src='images/active_fb_ex2.png' width='150' /><img alt='PIC' height='150' src='images/active_fb_ex3.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 31: </span><span class='content'>Feedback network involves transistor M1</span></figcaption><!-- tex4ht:label?: x1-2400131  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1000 --><p class='indent'>   Note that since the summing node is the source of M2, M1 is a part of the feedback network and not the core
amplifier.
</p>
   <h4 class='subsectionHead' id='local-feedback'><span class='titlemark'>2.7   </span> <a id='x1-250002.7'></a>Local Feedback</h4>
<!-- l. 1007 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='return-ratio-method'><span class='titlemark'>2.8   </span> <a id='x1-260002.8'></a>Return Ratio method</h4>
<!-- l. 1010 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='effect-of-feedback-on-noise'><span class='titlemark'>2.9   </span> <a id='x1-270002.9'></a>Effect of feedback on noise</h4>
<!-- l. 1012 --><p class='noindent'>Feedback does not improve input-reffered noise [<a id='x1-27001'></a><a href='#cite.0_razavi_design_2017'>12</a>]. From figure <a href='#feedback-around-a-noisy-ckt'>32<!-- tex4ht:ref: fig:feedback_noise  --></a>, we see that when the input-reffered noise of an
open-loop amplifier \(V_n\) is applied at the input, \((V_{in}-\beta V_{out}+ V_n)A_1 = V_{out}\).
</p>
   <figure class='figure' id='x1-2700232'><span id='feedback-around-a-noisy-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1018 --><p class='noindent'><img alt='PIC' height='250' src='images/feedback_noise.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 32: </span><span class='content'>Feedback around a noisy ckt</span></figcaption><!-- tex4ht:label?: x1-2700232  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1023 --><p class='indent'>   \[V_{out} = (V_{in}+V_n)\frac {A_1}{1+\beta A_1}\]
</p><!-- l. 1025 --><p class='indent'>   It is as though both \(V_{in}\) and \(V_n\) are applied at the input individually. \(V_n\) is still the input reffered noise of the closed-loop system
(and has not changed its value from the open-loop system). In the above analysis, we ignored the noise from the feedback
network itself. Let’s go through an example where we model the input-reffered noise with uncorrelated input current and
noise sources, and consider the noise from the feedback resistors.
</p>
   <figure class='figure' id='x1-2700333'><span id='effect-of-noisy-resistors-from-feedback-network-on-inputreffered-noise'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1031 --><p class='noindent'><img alt='PIC' height='250' src='images/feedback_network_noise.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 33: </span><span class='content'>Effect of noisy resistors from feedback network on input-reffered noise</span></figcaption><!-- tex4ht:label?: x1-2700333  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1037 --><p class='indent'>   In figure <a href='#effect-of-noisy-resistors-from-feedback-network-on-inputreffered-noise'>33<!-- tex4ht:ref: fig:feedback_network_noise  --></a>, we can calculate the output noise contribution from each of the uncorrelated source.
</p><!-- l. 1039 --><p class='indent'>   From the op-amp’s voltage noise and current sources we have,
</p><!-- l. 1041 --><p class='indent'>   \[\overline {v^2_{on}} = \overline {v^2_{n}}(1+|A_v|)^2\] \[\overline {v^2_{on}} = \overline {i^2_{n}}R_2^2\]
</p><!-- l. 1044 --><p class='indent'>   For the noisy resistor \(R_2\), we remove all other noise sources - we see that \(\overline {v^2_{nR_2}}\) shows up completely at the output.
\[\overline {v^2_{on}} = \overline {v^2_{nR_2}} = 4kTR_2\]
</p><!-- l. 1048 --><p class='indent'>   For \(R_1\), the noise is divided by the resistors \(R_1\) and \(R_2\) before reaching the output.
</p><!-- l. 1050 --><p class='indent'>   \[\overline {v^2_{on}} = \overline {v^2_{nR_1}}\bigg ( \frac {R_2}{R_1} \bigg )^2 = 4kTR_1 \bigg ( \frac {R_2}{R_1} \bigg )^2\]
</p><!-- l. 1052 --><p class='indent'>   Total noise at the output is the sum of all the above noise sources. To refer it to the input, we divide this total by the
square of the closed-loop gain \(A_v = -R_2/R_1\).
</p>
   <div class='tcolorbox tcolorbox' id='tcolobox-6'>     
<div class='tcolorbox-title'>
   </div> 
<div class='tcolorbox-content'><!-- l. 1058 --><p class='noindent'>\begin {equation}  \label {eqn:total_noise_fb} \overline {v^2_{in}} = \frac {\overline {v^2_{in}}}{|A_v|^2} + \overline {v^2_{n}}\bigg (1+\frac {1}{|A_v|}\bigg )^2 + \overline {i^2_{n}}R_1^2 + \overline {v^2_{nR_1}} \bigg ( 1+ \frac {1}{A_v}\bigg )  \end {equation}<a id='x1-27004r23'></a>
</p><!-- l. 1060 --><p class='noindent'>Note that from eqn <a href='#x1-27004r23'>23<!-- tex4ht:ref: eqn:total_noise_fb  --></a>, it is wrong to assume \(R_2\) doesn’t impact the total IRN. For a fixed \(R_1\), increasing \(R_2\) increases the
closed-loop gain \(A_v\), and decreases the total IRN.
</p>
 
</div> 
</div>
   <h4 class='subsectionHead' id='frequency-response'><span class='titlemark'>2.10   </span> <a id='x1-280002.10'></a>Frequency Response</h4>
<!-- l. 1068 --><p class='noindent'>For a negative feedback system with a passive feedback network, we have its frequency Response
</p><!-- l. 1070 --><p class='indent'>   \[\frac {Y(s)}{X(s)} = \frac {H(s)}{1+\beta H(S)}\]
</p><!-- l. 1073 --><p class='indent'>   Barkhausen’s criteria state that, for the loop to be stable, both the following conditions should hold true - (1) the phase
shift around the loop at this frequency is so great that the feedback becomes positive and (2) the loop gain is still enough to
allow signal buildup [<a id='x1-28001'></a><a href='#cite.0_razavi_design_2017'>12</a>].
</p><!-- l. 1083 --><p class='indent'>   \begin {equation}  \label {eqn:Barkenhaus_criteria} \begin {split} |\beta H(j\omega _1) | &amp;= 1 \\ \angle H(j\omega _1) &amp;= -180^\circ \end {split}  \end {equation}<a id='x1-28002r24'></a>
</p><!-- l. 1085 --><p class='indent'>   In eqn <a href='#x1-28002r24'>24<!-- tex4ht:ref: eqn:Barkenhaus_criteria  --></a>, \(\omega _1\) is called the unity-gain frequency. We can derive gain-margin and phase-margin at unity-gain frequency by
designing the system such that there is gain \(&lt;1\) and phase \(&gt;-180^\circ \) at the unity-gain frequency.
</p><!-- l. 1087 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='gainbandwidth-product'><span class='titlemark'>2.10.1   </span> <a id='x1-290002.10.1'></a>Gain-Bandwidth product</h5>
<!-- l. 1089 --><p class='noindent'>Let us take a single-pole system to model \(H(s)\) and find the open-loop unity gain frequency \(w_u\).
</p><!-- l. 1091 --><p class='indent'>   \[H(s) = \frac {A_0}{1+\frac {s}{w_p}}\]
</p><!-- l. 1093 --><p class='indent'>   If we set \(H(\omega _u)=1\), we find that
</p><!-- l. 1098 --><p class='indent'>   \begin {equation}  \label {eqn:gbw-ol} \omega _u \approx A_0 w_p  \end {equation}<a id='x1-29001r25'></a>
</p><!-- l. 1100 --><p class='indent'>   If we now close the loop around this amplifier with a feedback factor of \(\beta \), we get the following closed-loop response
\begin {equation}  \label {eqn:cl-response} A_{CL} = \frac {A_0}{1+\beta A_0} = \frac {1}{1+\frac {1}{w_p}\frac {1}{1+\beta A_0}}  \end {equation}<a id='x1-29002r26'></a>
</p><!-- l. 1106 --><p class='indent'>   The DC gain of the closed-loop system dropped from \(A_0\) to \(A_0/1+T\) where \(T=\beta A_0\) and the 3db BW (dominant pole position) went up by
the same amount. This is true for any given \(T\). Therefore, for a closed-loop system we say that the gain-bandwidth product is
constant and is equal to the unity-gain frequency of the open-loop amplifier.
</p>
   <div class='tcolorbox tcolorbox' id='tcolobox-7'>     
<div class='tcolorbox-title'>
                                                                                               
                                                                                               
   </div> 
<div class='tcolorbox-content'><!-- l. 1114 --><p class='noindent'>\begin {equation}  \label {eqn:gbw-cl} A_{0,CL}w_{p,CL} = constant = \omega _{u,OL} \approx A_0 w_p  \end {equation}<a id='x1-29003r27'></a> </p> 
</div> 
</div>
<!-- l. 1118 --><p class='indent'>   For \(H(s)\) being a two-pole system, we make the approximation that one of the poles is a “dominant” pole and occurs several
orders of magnitude before the other pole in terms of frequency.
</p><!-- l. 1121 --><p class='indent'>   In this analysis, we’ve used a voltage or a current amplifier and therefore, \(A_0\) is unitless. The same analysis is true for a
transconductance or a transimpedance amplifier as well. What is the value of the constant (which was \(\omega _u\) in the previous case)
the gain-bandwidth product is equal to in these cases?
</p><!-- l. 1124 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='root-locus'><span class='titlemark'>2.10.2   </span> <a id='x1-300002.10.2'></a>Root Locus</h5>
<!-- l. 1126 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='phase-margin'><span class='titlemark'>2.11   </span> <a id='x1-310002.11'></a>Phase margin</h4>
<!-- l. 1131 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='translating-closedloop-specs-to-openloop-opamp-specs'><span class='titlemark'>2.12   </span> <a id='x1-320002.12'></a>Translating closed-loop specs to open-loop op-amp specs</h4>
<!-- l. 1133 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='static-gain-error'><span class='titlemark'>2.12.1   </span> <a id='x1-330002.12.1'></a>Static Gain Error</h5>
<!-- l. 1135 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='settling-time'><span class='titlemark'>2.12.2   </span> <a id='x1-340002.12.2'></a>Settling Time</h5>
<!-- l. 1137 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='dc-offset-and-cancellation'><span class='titlemark'>2.13   </span> <a id='x1-350002.13'></a>DC offset and cancellation</h4>
<!-- l. 1140 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='commonmode-feedback'><span class='titlemark'>2.14   </span> <a id='x1-360002.14'></a>Common-mode Feedback</h4>
<!-- l. 1142 --><p class='noindent'>In a single-ended output diff pair, what sets the output common mode? If both the branches are fully matched,
                                                                                               
                                                                                               
then the current through each of them has to match (M3 mirrors the current tho M4 in figure <a href='#large-signal-behavior-of-a-singleended-diff-pair'>34<!-- tex4ht:ref: fig:single_ended_diff_pair  --></a>). We can
prove by contradiction that \(V_F\) has to be equal to \(V_{out}\) [<a id='x1-36001'></a><a href='#cite.0_razavi_design_2017'>12</a>]. If \(V_F &gt; V_{out}\), then due to channel length modulation on M1, a
current greater than \(I_{ss}/2\) has to flow through that branch. But M3 mirrors that current over to M4, meaning
there has to current greater than \(I_{ss}/2\) in the other branch too. This is not possible since the sum of the two
branch currents now exceeds \(I_{ss}\). Therefore, \(V_F = V_{out}\). This is what sets the output common-mode of the single-ended diff
pair.
</p>
   <figure class='figure' id='x1-3600234'><span id='large-signal-behavior-of-a-singleended-diff-pair'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1150 --><p class='noindent'><img alt='PIC' height='250' src='images/single_ended_diff_pair.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 34: </span><span class='content'>Large signal behavior of a single-ended diff pair</span></figcaption><!-- tex4ht:label?: x1-3600234  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1155 --><p class='indent'>   Note that if there is a mismatch in the branch, say threshold voltages of the input pair have a mismatch, then this
symmetry argument will not work - and the output common mode can swing wildly between either rails
[<a id='x1-36003'></a><a href='#cite.0_razavi_design_2017'>12</a>].
</p><!-- l. 1158 --><p class='indent'>   In a fully differential ckt, even tiny changes during the differential operation, or mismatch in either branches, can cause
huge swings in the output common-mode. The fundamental issue is illustrated in figure <a href='#need-for-common-mode-feedback-arised-due-to-the-fact-that-the-output-is-a-high-impedance-node'>35<!-- tex4ht:ref: fig:cm_fb_need  --></a>. Tiny changes in drain current
can move the drain voltage around by large amounts due to the high impedance seen at this node. A differential feedback
network cannot curtail this as this is a common-mode issue. Thus, a common-mode feedback (CMFB) ckt is needed to set
the output common-mode to a desired value.
</p>
   <figure class='figure' id='x1-3600435'><span id='need-for-common-mode-feedback-arised-due-to-the-fact-that-the-output-is-a-high-impedance-node'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1164 --><p class='noindent'><img alt='PIC' height='250' src='images/cm_fb_need.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 35: </span><span class='content'>Need for common mode feedback arised due to the fact that the output is a high impedance node</span></figcaption><!-- tex4ht:label?: x1-3600435  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1169 --><p class='indent'>   The CMFB ckt should not respond to differential inputs and should be stable. We can use a slower loop since there is no
high-frequency common-mode input usually.
</p>
   <h5 class='subsubsectionHead' id='commonmode-sensing'><span class='titlemark'>2.14.1   </span> <a id='x1-370002.14.1'></a>Common-mode sensing</h5>
<!-- l. 1173 --><p class='noindent'>The simplest sensing scheme is using a resistor divider (or a capacitor divider) as shown in figure <a href='#left-resistive-sensing-scheme-right-sensing-using-source-followers-plus-a-resistor-feedback'>36<!-- tex4ht:ref: fig:cmfb_sensing  --></a>. In a differential
setting, the outputs of the two branches move in opposite direction and the small signal current moves from
one branch to another through these resistors, i.e., the outputs are now loaded by these resistors and can
reduce the small signal gain differentially. To a common-mode variation, both the outputs move together, and
there is no current through the resistor divider. Even when there is mismatch - there is a common-mode to
differential conversion (see figure <a href='#x1-8003r6'>6<!-- tex4ht:ref: eqn:cm_rd_mismatch_dm  --></a>) - but the common-mode aspect is still sensed by the resistor divider. To
prevent loading, we might use a capacitor divider at the output but this can affect the bandwidth of the
ckt.
</p>
   <figure class='figure' id='x1-3700136'><span id='left-resistive-sensing-scheme-right-sensing-using-source-followers-plus-a-resistor-feedback'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1182 --><p class='noindent'><img alt='PIC' height='150' src='images/cmfb_res_sensing.png' width='150' /><img alt='PIC' height='150' src='images/cmfb_sf_sensing.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 36: </span><span class='content'>(Left) Resistive sensing scheme (Right) Sensing using source followers plus a resistor feedback</span></figcaption><!-- tex4ht:label?: x1-3700136  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1187 --><p class='indent'>   To eliminate resistive loading and bandwidth reduction, we can use source followers to isolate the resistor divider
network and the output branches, as shown on the right in figure <a href='#left-resistive-sensing-scheme-right-sensing-using-source-followers-plus-a-resistor-feedback'>36<!-- tex4ht:ref: fig:cmfb_sensing  --></a>. Note that R1 and R2 or I1 and I2 must still be large
enough to make sure that the source followers M7 and M8 are not “starved” when a large differential swing appears [<a id='x1-37002'></a><a href='#cite.0_razavi_design_2017'>12</a>].
Say \(V_{out2} &gt;&gt; V_{out1}\), the M7 has to sink the current \((V_{out2}-V_{out1} )/(R_1+R_2)\) (assuming M8 follows its input correctly) and its own bias current. Therefore, if \((R_1+R_2)\) or \(I_1\) is
not large enough, M7 shuts off (it cannot provide enough \(V_{GS}\) to sustain this large current) and the \(V_{out,CM}\) sensed is incorrect
[<a href='#cite.0_razavi_design_2017'>12</a>].
</p><!-- l. 1192 --><p class='indent'>   There is another issue with the source follower sensing, even if we make the sensing resistors or the bias currents for the
source followers large enough. The output without CMFB can we as low as \(2V^*\) in figure <a href='#left-resistive-sensing-scheme-right-sensing-using-source-followers-plus-a-resistor-feedback'>36<!-- tex4ht:ref: fig:cmfb_sensing  --></a> but with the CMFB ckt, we need it
to be at least high enough to support the \(V^*\) of the current source and the \(V_{GS}\) of the source follower. This translates to an
additional \(V_{th}\) increase in the minimum the output can swing to. We sacrifice output swing with this sensing
mechanism.
</p>
   <h5 class='subsubsectionHead' id='cmfb-techniques'><span class='titlemark'>2.14.2   </span> <a id='x1-380002.14.2'></a>CMFB techniques</h5>
<!-- l. 1198 --><p class='noindent'>We can use a simple op-amp to sense the output common-mode and either change the load or the tail current as shown in
figure <a href='#left-control-the-load-current-source-right-control-the-tail-current-source'>37<!-- tex4ht:ref: fig:cmfb_fb  --></a>. The op-amp can be a single-ended diff-pair as shown in figure <a href='#large-signal-behavior-of-a-singleended-diff-pair'>34<!-- tex4ht:ref: fig:single_ended_diff_pair  --></a>. Note the polarity on the op-amp in
feedback. As \(V_{out1/2}\) rises, do we need to increase or decrease the bias current? Let us think about this in a simpler ckt
- say a resistive loaded common-source. If the output CM voltage is increasing, this happens because of
the decrease in bias current through the “pull-up” resistor (load). Therefore, we need to increase the bias
current. Hence, the output is connected to the positive terminal and the reference voltage to the negative
terminal.
</p>
   <figure class='figure' id='x1-3800137'><span id='left-control-the-load-current-source-right-control-the-tail-current-source'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1206 --><p class='noindent'><img alt='PIC' height='250' src='images/cmfb_load.png' width='250' /><img alt='PIC' height='250' src='images/cmfb_tail.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 37: </span><span class='content'>(Left) Control the load current source (Right) Control the tail current source</span></figcaption><!-- tex4ht:label?: x1-3800137  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1211 --><p class='indent'>   Instead of loading the output with a resistor and then using a single op-amp, we can use a pair of diff-pairs to compare
the output voltages directly to a reference voltage as shown in figure <a href='#cmfb-using-a-differential-differencing-amplifier-dda'>38<!-- tex4ht:ref: fig:cmfb_dda  --></a>. Say the signal swing on the inputs M21 and
M24 are small enough compared to \(V_{CM}\) that small signal analysis can be applied. From eqn <a href='#x1-38002r28'>28<!-- tex4ht:ref: eqn:cmfb_dda  --></a>, we see that
we generate a signal proportional to \((V_{oc}-V_{CM})\) and this is mirrored back to the tail current source in the differential
op-amp.
</p><!-- l. 1222 --><p class='indent'>   \begin {equation}  \label {eqn:cmfb_dda} \begin {split} I_{d22} &amp;= \frac {I_{20}}{2}-g_{m22}\frac {(V_{o2}-V_{CM})}{2} \\ I_{d23} &amp;= \frac {I_{20}}{2}-g_{m23}\frac {(V_{o1}-V_{CM})}{2} \\ I_{d25} &amp;= -I_{d22} - I_{d23} = I_{20} + g_{m22}(V_{oc}-V_{CM})\\ \end {split}  \end {equation}<a id='x1-38002r28'></a>
</p><!-- l. 1224 --><p class='indent'>   For M21-M24 to not drop into triode for a large range of \(V_{o1}\) and \(V_{o2}\), we require large overdrive voltages for these devices [<a id='x1-38003'></a><a href='#cite.0_gray_analog_2009'>5</a>].
One drawback here is that we’re sesing both CM and DM signals since we’re directly connecting the outputs to the gates of
M21 and M24. Under large differential swing (not just common mode swing), if \(V_{oc} \neq V_{CM}\), and \(V_{od}\) (differential output) is comparable to \(4V_{ov23}\)
(overdrive of M23/24), we get that the current through M25 can have a \(V_{od}\) and even a \(V^2_{od}\) term [<a href='#cite.0_gray_analog_2009'>5</a>]. Therefore, a large differential
swing can induce an AC component to the output common mode voltage, even if all the devices in the DDA are
matched.
</p>
   <figure class='figure' id='x1-3800438'><span id='cmfb-using-a-differential-differencing-amplifier-dda'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1236 --><p class='noindent'><img alt='PIC' height='250' src='images/cmfb_dda.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 38: </span><span class='content'>CMFB using a Differential Differencing Amplifier (DDA)</span></figcaption><!-- tex4ht:label?: x1-3800438  -->
                                                                                               
                                                                                               
   </figure>
   <figure class='figure' id='x1-3800539'><span id='a-few-different-examples-of-dda-implementation'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1243 --><p class='noindent'><img alt='PIC' height='250' src='images/cmfb_dda_examples.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 39: </span><span class='content'>A few different examples of DDA implementation</span></figcaption><!-- tex4ht:label?: x1-3800539  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1248 --><p class='indent'>   Figure <a href='#a-few-different-examples-of-dda-implementation'>39<!-- tex4ht:ref: fig:cmfb_dda_examples  --></a> shows a few other common ways to build the DDA for CMFB ckts [<a id='x1-38006'></a><a href='#cite.0_garde_lcmfb_2017'>4</a>].
</p><!-- l. 1251 --><p class='indent'>   Another type of sensing is utilizing xtors in deep triode. As seen in figure <a href='#implementing-cmfb-with-triode-xtors-sensing'>40<!-- tex4ht:ref: fig:cmfb_triode  --></a>, the devices M7 and M8 are wide enough to
be in triode, then between P and GND, they offer a total resistance \(R_{tot} = R_{on7} || R_{on8}\). Since the devices are in triode we can approximate
this total resistance as [<a id='x1-38007'></a><a href='#cite.0_razavi_design_2017'>12</a>]
</p>
   <figure class='figure' id='x1-3800840'><span id='implementing-cmfb-with-triode-xtors-sensing'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1258 --><p class='noindent'><img alt='PIC' height='250' src='images/cm_triode.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 40: </span><span class='content'>Implementing CMFB with triode xtors sensing</span></figcaption><!-- tex4ht:label?: x1-3800840  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1268 --><p class='indent'>   \begin {equation}  \label {eqn:cmfb_triode} R_{tot} = \frac {1}{\mu _n C_{ox}\frac {W}{L}(V_{out2}+V_{out1}-2V_{th})}  \end {equation}<a id='x1-38009r29'></a>
</p><!-- l. 1270 --><p class='indent'>   From eqn <a href='#x1-38009r29'>29<!-- tex4ht:ref: eqn:cmfb_triode  --></a>, we see that the sensed voltage (through \(R_{tot}\)) depends only on the output CM and not the differential swings
as long as the devices M7 and M8 are in deep triode. This might not hold for larger differential swings where one side can
fall out of deep triode (still do not exactly understand this).
                                                                                               
                                                                                               
</p>
   <h3 class='sectionHead' id='low-dropout-voltage-regulator'><span class='titlemark'>3   </span> <a id='x1-390003'></a>Low Dropout Voltage Regulator</h3>
<!-- l. 1287 --><p class='noindent'>We will follow analysis from [<a id='x1-39001'></a><a href='#cite.0_9805648'>13</a>] to study basics of LDOs. The word drop out refers to the fact that we want to keep the
unregulated, noisy input close to the output, or a low drop in voltage (\(&lt;\) 100 mV).
</p><!-- l. 1290 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='basic-ldo-topology'><span class='titlemark'>3.1   </span> <a id='x1-400003.1'></a>Basic LDO topology</h4>
<!-- l. 1292 --><p class='noindent'>Figure <a href='#basic-ldo-topology1'>41<!-- tex4ht:ref: fig:basic_ldo  --></a> shows a generic LDO topology. We define the following metrics for an LDO
</p><!-- l. 1294 --><p class='indent'>
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-40002x1'>PSSR - \(\frac {\partial V_{out}}{\partial V_{in}}\) - how well does the LDO reject supply noise?
     </li>
<li class='enumerate' id='x1-40004x2'>Output noise \(V_{n,out}\) - how much noise the LDO itself produce?
     </li>
<li class='enumerate' id='x1-40006x3'>Load regulation - \(\frac {\partial V_{out}}{\partial I_{L}}\) - how does the output voltage change when the load draws large (sometimes transient)
     currents?
     </li>
<li class='enumerate' id='x1-40008x4'>Area and power consumption</li></ol>
   <figure class='figure' id='x1-4000941'><span id='basic-ldo-topology1'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1304 --><p class='noindent'><img alt='PIC' height='250' src='images/basic_ldo.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 41: </span><span class='content'>Basic LDO topology</span></figcaption><!-- tex4ht:label?: x1-4000941  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='choice-of-pass-transistor'><span class='titlemark'>3.2   </span> <a id='x1-410003.2'></a>Choice of Pass transistor</h4>
<!-- l. 1312 --><p class='noindent'>For the pass transistor in figure <a href='#basic-ldo-topology1'>41<!-- tex4ht:ref: fig:basic_ldo  --></a>, we can either choose a VCCS, or a source follower, or a variable resistor
(voltage/current controlled). The last option is generally inferior [<a id='x1-41001'></a><a href='#cite.0_9805648'>13</a>].
</p><!-- l. 1314 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='current-source-as-pass-transistor'><span class='titlemark'>3.2.1   </span> <a id='x1-420003.2.1'></a>Current source as pass transistor</h5>
<!-- l. 1316 --><p class='noindent'>In figure <a href='#pmos-ldo'>42<!-- tex4ht:ref: fig:pmos_ldo  --></a>, we use PMOS as VCCS for the pass transistor. The low dropout is achieved by decreasing the \(V^*\) of
the PMOS and making the device wide. Let us add a load \(R_L\) at the output and try to calculate the above
parameters.
</p>
   <figure class='figure' id='x1-4200142'><span id='pmos-ldo'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1322 --><p class='noindent'><img alt='PIC' height='350' src='images/pmos_ldo.png' width='350' />
</p>
<figcaption class='caption'><span class='id'>Figure 42: </span><span class='content'>PMOS LDO</span></figcaption><!-- tex4ht:label?: x1-4200142  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1327 --><p class='indent'>   We can break the loop at X and calculate the loop gain (assuming \(r_o\) of the PMOS is infinite) as
</p><!-- l. 1329 --><p class='indent'>   \[A_{LG} = A_1g_m [R_L|| (R_1 + R_2)\frac {R_2}{(R_1 + R_2)}]\]
</p><!-- l. 1331 --><p class='indent'>   In open-loop, this acts as a common gate stage with a gain of \(g_m [R_L|| (R_1 + R_2)\frac {R_2}{(R_1 + R_2)}]\). Therfore, the closed loop gain is
</p><!-- l. 1334 --><p class='indent'>   \[\frac {V_{out}}{V_{in}} = \frac {g_m[R_L|| (R_1 + R_2)\frac {R_2}{(R_1 + R_2)}]}{(1+A_{LG})} \]
</p><!-- l. 1336 --><p class='indent'>   If we design the feedback loop to have high enough loop gain, we can approximate the above expression
to
</p><!-- l. 1341 --><p class='indent'>   \begin {equation}  \label {eqn:pmos_ldo_psrr} A_{CL} = \frac {V_{out}}{V_{in}} \approx \bigg (1+\frac {R_1}{R_2}\bigg ) \frac {1}{A_1}  \end {equation}<a id='x1-42002r30'></a>
</p><!-- l. 1343 --><p class='indent'>   Eqn <a href='#x1-42002r30'>30<!-- tex4ht:ref: eqn:pmos_ldo_psrr  --></a> suggests that the PSRR can be improved by maximizing the op-amp’s open-loop gain \(A_1\). For load regulation, we
can calculate the \(R_{out}\), we note that the PMOS looks like a diode connected device with a gain boosting of \(A_1R_2/(R_1+R_2)\)
[<a id='x1-42003'></a><a href='#cite.0_9805648'>13</a>].
</p><!-- l. 1353 --><p class='indent'>   \begin {equation}  \label {eqn:pmos_ldo_rout} \begin {split} R_{out} &amp;= \frac {1}{g_mA_1\frac {R_2}{(R_1+R_2)}} || (R_1+R_2) \\ R_{out} &amp;\approx \bigg (1+\frac {R_1}{R_2}\bigg ) \frac {1}{g_mA_1} = A_{CL}/g_m \end {split}  \end {equation}<a id='x1-42004r31'></a>
</p><!-- l. 1355 --><p class='indent'>   Let us look at the noise performance. The noise current from M1 sees a low \(R_out\) as derived in eqn <a href='#x1-42004r31'>31<!-- tex4ht:ref: eqn:pmos_ldo_rout  --></a>. If we model the noise
of the op-amp with a voltage soure at its \(V_ref\) node, we see a total output noise of
</p><!-- l. 1361 --><p class='indent'>   \begin {equation}  \label {eqn:pmos_ldo_noise} \overline {V^2_{n,out}} = \bigg (1+\frac {R_1}{R_2}\bigg )^2 \bigg (\overline {V^2_{nA}} + \frac {\overline {V^2_{nM}}}{A^2_1}\bigg )  \end {equation}<a id='x1-42005r32'></a>
</p><!-- l. 1363 --><p class='indent'>   Note that the contribution from resistors R1 and R2 (modelled as \(4kT R_1 || R_2\)) is lumped in with the input noise source at the
op-amp’s IRN source [<a href='#cite.0_9805648'>13</a>].
</p>
   <figure class='figure' id='x1-4200643'><span id='pmos-ldo-left-noise-model-right-frequency-response-of-closed-loop-gain-and-rout'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1368 --><p class='noindent'><img alt='PIC' height='250' src='images/pmos_ldo_noise.png' width='250' /><img alt='PIC' height='250' src='images/pmos_ldo_freq_resp.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 43: </span><span class='content'>PMOS LDO (left) noise model (right) frequency response of closed loop gain and \(R_{out}\)</span></figcaption><!-- tex4ht:label?: x1-4200643  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1373 --><p class='indent'>   Let us now look at the frequency response of our PMOS LDO. As seen in figure <a href='#pmos-ldo-left-noise-model-right-frequency-response-of-closed-loop-gain-and-rout'>43<!-- tex4ht:ref: fig:pmos_ldo_noise_freq  --></a>,
                                                                                               
                                                                                               
</p>
   <h3 class='sectionHead' id='cascode-amplifiers'><span class='titlemark'>4   </span> <a id='x1-430004'></a>Cascode Amplifiers</h3>
<!-- l. 1384 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='frequency-response1'><span class='titlemark'>4.1   </span> <a id='x1-440004.1'></a>Frequency Response</h4>
<!-- l. 1386 --><p class='noindent'>In addition to providing a large output impedance that can move the dominant pole to a lower frequency, a cascode device
can add a parasitc pole. For a single-ended output, we can now have zeros as well. To see this, let’s start with analysis of
\(R_{out}\).
</p>
   <figure class='figure' id='x1-4400144'><span id='parasitics-in-a-cascode-cause-additional-poles-and-zeros'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1391 --><p class='noindent'><img alt='PIC' height='200' src='images/cascode_device_par1.png' width='200' /><img alt='PIC' height='200' src='images/cascode_device_par2.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 44: </span><span class='content'>Parasitics in a cascode cause additional poles and zeros</span></figcaption><!-- tex4ht:label?: x1-4400144  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1396 --><p class='indent'>   In figure <a href='#parasitics-in-a-cascode-cause-additional-poles-and-zeros'>44<!-- tex4ht:ref: fig:cascode_device_par  --></a>, we see that at low frequencies, \(R_{out}\) is given by the source degeneration of M2 and M1. However, at high
frequencies when \(C_{par}\) is shorted, the boost in output impedance from the source degeneration is missing. But we
still have an \(R_{out}\) of \(r_{o2}\) from M2. Therefore, \(R_{out}\) is non-zero at high frequencies. What about \(G_m\)? At low frequencies,
\(G_m\) is just \(g_{m1}\) as all of the small signal current is shunted by the output. From figure <a href='#leftincluding-the-load-cap-might-end-up-in-a-situation-with-polezero-or-a-zeropole-doublet-right-gm-drops-to-zero-much-later-than-rout'>45<!-- tex4ht:ref: fig:cascode_device_par3  --></a> (thanks to Joosung),
we see that the pole from the \(G_m\) calculations ends up being at a much larger frequency than the pole from \(R_{out}\).
Therefore, we do have a non-zero gain at the pole of \(R_{out}\) and in fact, it the product \(G_m R_{out}\) is constant till it hits any other
parasitc poles or the \(G_m\) pole. This implies at least one zero from this parasitic capacitor. This is true for both
single-ended and differential cascode amplifiers. This is covered in more detail in [<a id='x1-44002'></a><a href='#cite.0_iitmadras_poles_zeros_2024'>2</a>]. When the pole at the load cap
is taken into account, we could potentially form a pole-zero doublet (or zero-pole too) as shown in figure
<a href='#leftincluding-the-load-cap-might-end-up-in-a-situation-with-polezero-or-a-zeropole-doublet-right-gm-drops-to-zero-much-later-than-rout'>45<!-- tex4ht:ref: fig:cascode_device_par3  --></a>.
</p>
   <figure class='figure' id='x1-4400345'><span id='leftincluding-the-load-cap-might-end-up-in-a-situation-with-polezero-or-a-zeropole-doublet-right-gm-drops-to-zero-much-later-than-rout'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1415 --><p class='noindent'><img alt='PIC' height='200' src='images/cascode_device_par3.png' width='200' /><img alt='PIC' height='100' src='images/gm_cascode_hf.jpg' width='100' />
</p>
<figcaption class='caption'><span class='id'>Figure 45: </span><span class='content'>(Left)Including the load cap might end up in a situation with pole-zero or a zero-pole doublet (Right) \(G_m\)
drops to zero much later than \(R_{out}\)</span></figcaption><!-- tex4ht:label?: x1-4400345  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1421 --><p class='indent'>   The above analysis can be extended to a gain-boosted cascode as shown in figure <a href='#polezero-doublets-for-a-gainboosted-cascode-amplifier'>46<!-- tex4ht:ref: fig:cascode_device_par4  --></a>.
</p>
   <figure class='figure' id='x1-4400446'><span id='polezero-doublets-for-a-gainboosted-cascode-amplifier'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1425 --><p class='noindent'><img alt='PIC' height='200' src='images/cascode_device_par4.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 46: </span><span class='content'>Pole-zero doublets for a gain-boosted cascode amplifier</span></figcaption><!-- tex4ht:label?: x1-4400446  -->
                                                                                               
                                                                                               
   </figure>
   <h5 class='subsubsectionHead' id='current-mirror-polezero-doublet'><span class='titlemark'>4.1.1   </span> <a id='x1-450004.1.1'></a>Current mirror pole-zero doublet</h5>
<!-- l. 1432 --><p class='noindent'>Since we’re discussing about parasitc capacitors and their impact on high-frequency response, let’s take a brief detour to
explore a single-ended diff pair more closely. In figure <a href='#origin-of-polezero-doublet-in-a-current-mirror'>47<!-- tex4ht:ref: fig:cm_pole_zero  --></a>, we see that \(R_{out}\) doesn’t change appreciably at high frequencies.
However, the parasitc cap at the diode connected M3 is large enough that it can short at high frequencies. We lose \(g_m/2\) from \(G_m\)
because the small signal current from M1 is shunted to GND by this parastic capacitor. However, it stays constant till we
encounter another parasitc pole. Once again, this means that the product \(G_mR_{out}\) is flat for a while - indicating a presence of a
zero. In fact, from figure <a href='#origin-of-polezero-doublet-in-a-current-mirror'>47<!-- tex4ht:ref: fig:cm_pole_zero  --></a>, we see that there is a pole-zero doublet from the current mirror. This is true even in a cascode
single-ended amplifier.
</p>
   <figure class='figure' id='x1-4500147'><span id='origin-of-polezero-doublet-in-a-current-mirror'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1440 --><p class='noindent'><img alt='PIC' height='200' src='images/cm_pole_zero.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 47: </span><span class='content'>Origin of pole-zero doublet in a current mirror</span></figcaption><!-- tex4ht:label?: x1-4500147  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='noise'><span class='titlemark'>4.2   </span> <a id='x1-460004.2'></a>Noise</h4>
<!-- l. 1451 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='output-swing'><span class='titlemark'>4.3   </span> <a id='x1-470004.3'></a>Output swing</h4>
<!-- l. 1453 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='compensation-techniques'><span class='titlemark'>4.4   </span> <a id='x1-480004.4'></a>Compensation techniques</h4>
<!-- l. 1455 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='slew-rate'><span class='titlemark'>4.5   </span> <a id='x1-490004.5'></a>Slew rate</h4>
<!-- l. 1457 --><p class='noindent'>So far we’ve dealt with inputs that are small enough that they can be predicted by the small-signal response with decent
accuracy. What if we apply a large signal, such as a step function, at the input of an op-amp?
</p>
   <figure class='figure' id='x1-4900148'><span id='example-of-slew-rate-issue'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1461 --><p class='noindent'><img alt='PIC' height='200' src='images/slew_ex1.png' width='200' /><img alt='PIC' height='150' src='images/slew_ex2.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 48: </span><span class='content'>Example of slew rate issue</span></figcaption><!-- tex4ht:label?: x1-4900148  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1467 --><p class='indent'>   In figure <a href='#example-of-slew-rate-issue'>48<!-- tex4ht:ref: fig:slew_ex  --></a>, the expected step response is a decaying exponential but the actual response we get is a ramp. The slope of
this ramp is called the slew rate of the amplifier [<a id='x1-49002'></a><a href='#cite.0_gray_analog_2009'>5</a>].
</p><!-- l. 1469 --><p class='indent'>   We already know at \(V_{id} \geq \sqrt {2}V^*\), one branch of the diff-pair shuts down and all of the current flows through a single branch. In a
2-stage op-amp with a compensation capacitor \(C_c\), this means that the devices M2, M3, and M4 are turned off and \(C_c\) is
discharged through M1 and \(I_{SS}\) as shown in figure <a href='#positive-and-negative-slew-rate-examples'>49<!-- tex4ht:ref: fig:slew_2stage_1  --></a>. During this, transistor M5 has to sustain a current of \(I_{SS}+I_1\). If M5 is not wide
enough, this current will be sustained by dropping the voltage at node X (scaling makes this problem worse) and pushes M1
into triode.
</p>
   <figure class='figure' id='x1-4900349'><span id='positive-and-negative-slew-rate-examples'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1475 --><p class='noindent'><img alt='PIC' height='200' src='images/slew_2stage_1.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 49: </span><span class='content'>Positive and negative slew rate examples</span></figcaption><!-- tex4ht:label?: x1-4900349  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1481 --><p class='indent'>   Therefore, the positve slew is limited by \(I_{SS}/C_c\). Similarly, for a negative input, M1 is off, M2 steals the bias current completely
and it reaches output through the current mirror M4 and M3. M3 now charges the \(C_c\) with \(I_{ss}\). The negative slew rate from the
first stage is \(-I_{SS}/C_c\).
</p><!-- l. 1484 --><p class='indent'>   If we now had a second capacitor at the load, the output stage would have to charge/discharge that load
cap.
</p>
   <figure class='figure' id='x1-4900450'><span id='positive-and-negative-slew-rate-examples-for-output-stage'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1488 --><p class='noindent'><img alt='PIC' height='200' src='images/slew_2stage_2.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 50: </span><span class='content'>Positive and negative slew rate examples for output stage</span></figcaption><!-- tex4ht:label?: x1-4900450  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1493 --><p class='indent'>   If the input to the first stage is large and positive, the input to M6 in figure <a href='#positive-and-negative-slew-rate-examples-for-output-stage'>50<!-- tex4ht:ref: fig:slew_2stage_2  --></a> is low and can turn off M6. \(C_L\) is now
charged by \(I_{bias,2}\). On the other hand, during discharge of \(C_L\), M6 can support large enough current before turning the first stage’s
devices into triode as explained previously. The positive slew rate has an arbitrarily large (depends on sizing of M6) value
while the negative slew rate is limited to \(I_{bias,2}/C_L\).
</p><!-- l. 1497 --><p class='indent'>   What about slew rate in cascode devices? For a single stage cascode, the same analysis is applied as was to the diff
pair.
</p>
   <figure class='figure' id='x1-4900551'><span id='positive-and-negative-slew-rate-examples-for-a-cascode-stage'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1501 --><p class='noindent'><img alt='PIC' height='200' src='images/slew_cascode.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 51: </span><span class='content'>Positive and negative slew rate examples for a cascode stage</span></figcaption><!-- tex4ht:label?: x1-4900551  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1506 --><p class='indent'>   When there is a large positive swing on M1 in figure <a href='#positive-and-negative-slew-rate-examples-for-a-cascode-stage'>51<!-- tex4ht:ref: fig:slew_cascode  --></a>, M2 turns off and there is no current through M2 and M2A. \(I_{tail}\) is
sunk by the left branch and is mirrored to the right branch using the current mirrot M3-M4. This sets the positive skew
rate of \(I_{tail}/C_L\) for the cascode amplifier, similar to the diff pair. Similarly, when there is a large negative swing, M1 and the left
branch are turned off, and so is M4 and M4A. M2 and M2A sink in the tail current and discharge \(C_L\), giving us a negative slew
rate of \(-I_{tail}/C_L\).
</p>
   <h5 class='subsubsectionHead' id='class-ab-output-and-input-stages'><span class='titlemark'>4.5.1   </span> <a id='x1-500004.5.1'></a>Class AB output and input stages</h5>
<!-- l. 1514 --><p class='noindent'>Let us first look at a class AB output stage. In figure <a href='#positive-and-negative-slew-rate-examples-for-a-class-ab-output-stage'>52<!-- tex4ht:ref: fig:slew_classab_out  --></a>, the charging and discharging of the load cap is not set by any bias
current - instead set by the max swing the output transistors can take without pushing the first stage’s current sources into
triode (this is true only if there is a compensation capacitor). Therefore, there’s an arbitrarily high value of positive and
negative slew rate for a class-AB output stage.
</p>
   <figure class='figure' id='x1-5000152'><span id='positive-and-negative-slew-rate-examples-for-a-class-ab-output-stage'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1520 --><p class='noindent'><img alt='PIC' height='200' src='images/slew_classab_out.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 52: </span><span class='content'>Positive and negative slew rate examples for a class AB output stage</span></figcaption><!-- tex4ht:label?: x1-5000152  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1525 --><p class='indent'>   Let us now analyze a class AB differential amplifier with a class AB input stage. Figure <a href='#class-ab-differential-amplifier'>53<!-- tex4ht:ref: fig:slew_classab_diff  --></a> shows an amplifier with a
class AB input stage. M1 and M5 (M4 and M8) form a unity-gain source follower to feed the input of M6 and M7. M3 and
M7 deliver current to the cascode current mirrots M9, M10, and M11, M12, which are mirrored into the cascode output
stage.
</p>
   <figure class='figure' id='x1-5000253'><span id='class-ab-differential-amplifier'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1531 --><p class='noindent'><img alt='PIC' height='200' src='images/slew_classab_input.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 53: </span><span class='content'>Class AB differential amplifier</span></figcaption><!-- tex4ht:label?: x1-5000253  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1537 --><p class='indent'>   From a small signal perspective, \(R_{out} = (g_{m15}r_{o15}r_{o16} || g_{m14}r_{o14}r_{o13})\). For \(G_m\), grounding the output node, we see that, currents \(i_{d3}\) and \(i_{d7}\) are mirrors to the output,
yielding \(i_{sc} = i_{d3} + i_{d7}\). If M2 and M3 are sized equal, and so are M6 and M7, we get that \[i_{d3} = \frac {g_{m3}v_i}{1+\frac {g_m3}{g_{m6}}}\] \[i_{d7} = \frac {g_{m2}v_i}{1+\frac {g_m2}{g_{m7}}}\]
</p><!-- l. 1542 --><p class='indent'>   Therefore, \(G_m\) is given by,
</p><!-- l. 1544 --><p class='indent'>   \[G_m = \frac {2g_{m3}}{1+\frac {g_m3}{g_{m6}}}\]
</p><!-- l. 1546 --><p class='indent'>   If we make all the 4 input transistors (M2,M3, and M6, M7) equal, then \(G_m = g_{m3}\) [<a id='x1-50003'></a><a href='#cite.0_gray_analog_2009'>5</a>].
</p><!-- l. 1548 --><p class='indent'>   Let us now see what happens to the slew rate in this case. If a large input swing is applied, say M2 and M7 are cut off,
M3 and M6 will have a large overdrive voltage on them, therefore, sinking a large current. These currents are mirrored to
the output (assuming everything is sized to accommodate such large currents without throwing neighbours into triode), the
slew rate can be arbitrarily high.
                                                                                               
                                                                                               
</p>
   <h3 class='sectionHead' id='biasing-circuits'><span class='titlemark'>5   </span> <a id='x1-510005'></a>Biasing Circuits</h3>
<!-- l. 1557 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='current-mirrors'><span class='titlemark'>5.1   </span> <a id='x1-520005.1'></a>Current mirrors</h4>
<!-- l. 1558 --><p class='noindent'>We use current mirrors to copy the reference current and bias our ckts. A standard current mirror might lead to
mismatched copying due to channel length modulation, particularly in shorter channel length devices. We need to somehow
make the \(V_{DS}\) drops across the both devices same. A cascode device increases the output impedance when looking into the drain
node. This essentially means that large changes in voltage are minimized to minimum changes in currents - thereby leading
to a stable current source.
</p>
   <figure class='figure' id='x1-5200154'><span id='cascode-current-mirror-to-improve-current-matching-'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1564 --><p class='noindent'><img alt='PIC' height='150' src='images/cascode_cm1.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 54: </span><span class='content'>Cascode current mirror to improve current matching </span></figcaption><!-- tex4ht:label?: x1-5200154  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1569 --><p class='indent'>   In figure <a href='#cascode-current-mirror-to-improve-current-matching-'>54<!-- tex4ht:ref: fig:cascode_cm1  --></a>, we see M3 acting as the cascode device and being biased by M0. One drawback is that we’ve reduced our
output swing by an extra \(V_{th}\) (\(2V^* + 2V_{th}\) drop in figure <a href='#cascode-current-mirror-to-improve-current-matching-'>54<!-- tex4ht:ref: fig:cascode_cm1  --></a>). This comes from the M0 device biasing M3. We want to keep M3 but figure
out how to equalized \(V_{DS1}\) to \(V_{DS2}\) without M0 and also find a way to bias M3.
</p>
   <figure class='figure' id='x1-5200255'><span id='left-wide-swing-cascode-current-mirror-right-generating-vb-for-this-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1575 --><p class='noindent'><img alt='PIC' height='150' src='images/cascode_cm2.png' width='150' /><img alt='PIC' height='150' src='images/cascode_cm2_vb.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 55: </span><span class='content'>(Left) Wide swing cascode current mirror (Right) Generating \(V_b\) for this ckt</span></figcaption><!-- tex4ht:label?: x1-5200255  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1581 --><p class='indent'>   In figure <a href='#left-wide-swing-cascode-current-mirror-right-generating-vb-for-this-ckt'>55<!-- tex4ht:ref: fig:cascode_cm2  --></a>, we see a way to get around the above output swing issue. However, we still need to find a way to bias \(V_b = V_{th}+2\Delta V\). On
the right, we see a stack of 4 \(W/L\) transistors, or simply one \(W/4L\) transistor, generating \(V_b\).
</p>
   <h5 class='subsubsectionHead' id='replica-biasing'><span class='titlemark'>5.1.1   </span> <a id='x1-530005.1.1'></a>Replica Biasing</h5>
<!-- l. 1586 --><p class='noindent'>There is still an issue with headroom in figure <a href='#left-wide-swing-cascode-current-mirror-right-generating-vb-for-this-ckt'>55<!-- tex4ht:ref: fig:cascode_cm2  --></a>. We might not be able to afford \(2V^*\) at the tail of a diff pair. Moreover, we
need to track the input common mode changes at the tail node.
</p>
   <figure class='figure' id='x1-5300156'><span id='left-replica-bias-razavidesign-right-replica-bias-with-a-single-transistor-krishnapurareplicabiasing'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1592 --><p class='noindent'><img alt='PIC' height='200' src='images/replica_bias.png' width='200' /><img alt='PIC' height='150' src='images/replica_bias2.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 56: </span><span class='content'>(Left) Replica bias [<a id='x1-53002'></a><a href='#cite.0_razavi_design_2017'>12</a>] (Right) Replica bias with a single transistor [<a id='x1-53003'></a><a href='#cite.0_krishnapura_replica_biasing_2024'>8</a>]</span></figcaption><!-- tex4ht:label?: x1-5300156  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1597 --><p class='indent'>   In figure <a href='#left-replica-bias-razavidesign-right-replica-bias-with-a-single-transistor-krishnapurareplicabiasing'>56<!-- tex4ht:ref: fig:replica_bias  --></a>, we make the node P have the same drop as the input pair, by <span class='cmti-10'>replicating </span>it on the bias
generating side. This is called a replica bias. \(V_P\) now tracks \(V_{DS1}\) to ensure proper current matching. We don’t even
need two devices at the bias side - a single device to replicate the input is enough [<a id='x1-53004'></a><a href='#cite.0_krishnapura_replica_biasing_2024'>8</a>]. The general idea is
to match the device \(V_{DS}\) drops by mimicing what is at the top and bottom of the device that is copying the
current. One observation in such ckts where there is no diode connection is that we’re using some kind of
feedback mechanism to generate the required \(V_{GS}\) from the reference current. Let us come back to this in a
bit.
</p><!-- l. 1602 --><p class='indent'>   One issue with replica biasing is that if input common mode level rises too high, the replica bias transistor can fall into
triode. One way to avoid this is prevent the direct connection between the drain of the replica devices and the gate of the
biasing device, and instead pass it through a source follower [<a href='#cite.0_krishnapura_replica_biasing_2024'>8</a>]. This way, the replica device acts as current buffer
(common gate stage) and raises its drain voltage to ensure the current on its drain and source nodes are
matched. We basically need any ckt that can mimic the diode connection - as the drain voltage goes up,
so should the gate voltage. Without this feedback, we can’t generate voltage from current in a transistor
[<a href='#cite.0_krishnapura_replica_biasing_2024'>8</a>].
</p>
   <figure class='figure' id='x1-5300557'><span id='improved-replica-bias-left-noninverting-feedback-with-a-sf-righ-noninverting-feedback-with-a-diff-pair-with-an-active-current-mirror-load'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1609 --><p class='noindent'><img alt='PIC' height='200' src='images/improved_replica_bias.png' width='200' /><img alt='PIC' height='150' src='images/improved_replica_bias2.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 57: </span><span class='content'>Improved replica bias - (Left) non-inverting feedback with a SF (Righ) non-inverting feedback with a
diff pair with an active current mirror load</span></figcaption><!-- tex4ht:label?: x1-5300557  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1614 --><p class='indent'>   In figure <a href='#improved-replica-bias-left-noninverting-feedback-with-a-sf-righ-noninverting-feedback-with-a-diff-pair-with-an-active-current-mirror-load'>57<!-- tex4ht:ref: fig:improved_replica_bias  --></a>, we see two ways to do this. A source follower can be added to provide the non-inverting gain or a single
ended diff pair. How do we generate \(V_{ref}\) in the case of the diff pair? We want it to be equal to the \(V_{DS}\) drop of the tail source.
Figure <a href='#generating-vref-for-the-improved-replica-bias'>58<!-- tex4ht:ref: fig:improved_replica_bias_vref  --></a> shows a way to generate the \(V_{ref}\).
</p>
   <figure class='figure' id='x1-5300658'><span id='generating-vref-for-the-improved-replica-bias'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1621 --><p class='noindent'><img alt='PIC' height='200' src='images/improved_replica_bias2_vref.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 58: </span><span class='content'>Generating \(V_{ref}\) for the improved replica bias</span></figcaption><!-- tex4ht:label?: x1-5300658  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1626 --><p class='indent'>   Note that the \(V_{ref}\) we generated here can actually be used to set the common mode of the output of the 5T OTA if the
resistors were all replaced with current sources. In figure <a href='#setting-vocm-using-improved-replica-bias'>59<!-- tex4ht:ref: fig:setting_vocm_replica_bias  --></a>, while the loop in red sets accurate tail current, the loop in
green (ignore the load resistors - not needed for analog ckts, only high speed ckts) sets the replica bias for the load, and
hence, sets the output common mode [<a id='x1-53007'></a><a href='#cite.0_krishnapura_replica_biasing_lecture24_2012'>9</a>].
</p>
   <figure class='figure' id='x1-5300859'><span id='setting-vocm-using-improved-replica-bias'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1632 --><p class='noindent'><img alt='PIC' height='200' src='images/setting_vocm_replica_bias.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 59: </span><span class='content'>Setting \(V_{ocm}\) using improved replica bias</span></figcaption><!-- tex4ht:label?: x1-5300859  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='wilson-current-mirror'><span class='titlemark'>5.2   </span> <a id='x1-540005.2'></a>Wilson Current Mirror</h4>
<!-- l. 1639 --><p class='noindent'>If we want to current mirrors that copy the reference current with little static error, one such architecture is shown in figure
<a href='#wilson-current-mirror1'>60<!-- tex4ht:ref: fig:wilson_cm  --></a>. </p><figure class='figure' id='x1-5400160'><span id='wilson-current-mirror1'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1643 --><p class='noindent'><img alt='PIC' height='150' src='images/wilson_cm.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 60: </span><span class='content'>Wilson Current Mirror</span></figcaption><!-- tex4ht:label?: x1-5400160  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1648 --><p class='indent'>   \(I_{ref}\) flows through a cascoded current mirror pair and the feedback from M2-M3-M4 to source of M1 makes sure the \(V_{DS}\) of M3
and M2 match. It it this negative feedback that makes the current matching even more accurate. If the gate/drain of M1
increases, this increases the voltage on gate of M3. But that branch cannot sustain more current than \(I_{ref}\) - that means \(V_{DS}\) has to
go down for M3 to keep the current same. This drop means that the source of M4 drops, which leads to a drop in gate of
M4, which in turn leads to a drop in gate of M2 - thereby equalizing the \(V_{DS}\) across M1 and M3. Alternatively, M3
can be viewed as a common-source amplifier and hence, an increase in gate current drops the drain voltage
[<a id='x1-54002'></a><a href='#cite.0_ketkar_wilson_output_2024'>7</a>].
</p><!-- l. 1654 --><p class='indent'>   For the output impedance of the Wilson Current Mirror, we can view M2 as being degenrated by some \(R_s\) and being
gain-boosted by the negative feedback.
</p>
   <figure class='figure' id='x1-5400361'><span id='wilson-current-mirror2'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1658 --><p class='noindent'><img alt='PIC' height='150' src='images/wilson_cm_rout.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 61: </span><span class='content'>Wilson Current Mirror</span></figcaption><!-- tex4ht:label?: x1-5400361  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1664 --><p class='indent'>   From figure <a href='#wilson-current-mirror2'>61<!-- tex4ht:ref: fig:wilson_cm_rout  --></a>, we see that the loop gain depends on M3 and the overall \(R_{out}\) depends on the \(g_{ds}\) of M2 and M3. The output
impedance is similar to that of a regular cascode current mirror. At the reference branch, the minimum voltage is \(2V_{t} + 2 V^*\), and the
output branch the minimum voltage is \(V_t + 2V^*\) - for all devices to be in saturation. This is the same as a regular
cascode.
</p>
   <h4 class='subsectionHead' id='widlar-current-source'><span class='titlemark'>5.3   </span> <a id='x1-550005.3'></a>Widlar Current Source</h4>
<!-- l. 1670 --><p class='noindent'>Widlar current sources are used to create low-currents for biasing and also provide a supply independent current
- all without large resistors that are noisy and occupy huge area. Note that - it is more a current source
than a current mirror since its output current does not depend a lot on the input current and the supply
voltage.
</p>
   <figure class='figure' id='x1-5500162'><span id='widlar-current-source1'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1676 --><p class='noindent'><img alt='PIC' height='150' src='images/widlar_cs.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 62: </span><span class='content'>Widlar current source</span></figcaption><!-- tex4ht:label?: x1-5500162  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1683 --><p class='indent'>   While the closed form expression might be too cumbersome to make any meaning out of, we can see that due to the
source degeneration, we have an increased output resistance. Another aspect is the negative feedback from the source
degeneration that lets \(I_{out}\) be well defined.
</p><!-- l. 1694 --><p class='indent'>   \begin {equation}  \label {eqn:widlar_fb} \begin {split} V_{GS1} - V_{GS2} - I_{out}R_2 &amp;= 0 \\ I_{out} &amp;= k_2(V_{GS2}-V_{th})^2 \\ \frac {V_{DD}-V_{GS1}}{R_1} &amp;= I_{in} \\ I_{in} &amp;= k_1(V_{GS1}-V_{th})^2 \end {split}  \end {equation}<a id='x1-55002r33'></a>
</p><!-- l. 1696 --><p class='indent'>   From system of eqns in eqn <a href='#x1-55002r33'>33<!-- tex4ht:ref: eqn:widlar_fb  --></a>, we see that the \(I_{out}\) strongly depends on M2 and R2, but does have some dependence on
overdrive voltage of M1 as well (which sets the input current). Wildar current sources are used in ckts where we need bias
curents of a few microamps [<a id='x1-55003'></a><a href='#cite.0_gray_analog_2009'>5</a>].
</p>
   <h4 class='subsectionHead' id='peaking-current-source'><span class='titlemark'>5.4   </span> <a id='x1-560005.4'></a>Peaking Current Source</h4>
<!-- l. 1702 --><p class='noindent'>To reach even lower values of bias currents - in the order of nanoamps, we use a ckt shown in figure <a href='#left-mos-peaking-current-source-right-output-if-both-transistors-are-in-strong-or-weak-inversion-together'>63<!-- tex4ht:ref: fig:peaking_cs  --></a>.
</p>
   <figure class='figure' id='x1-5600163'><span id='left-mos-peaking-current-source-right-output-if-both-transistors-are-in-strong-or-weak-inversion-together'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1707 --><p class='noindent'><img alt='PIC' height='150' src='images/mos_peaking_source.png' width='150' /><img alt='PIC' height='150' src='images/mos_peaking_source_output.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 63: </span><span class='content'>(Left) MOS peaking current source (Right) Output if both transistors are in strong or weak inversion
together</span></figcaption><!-- tex4ht:label?: x1-5600163  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1712 --><p class='indent'>   From KVL, we can write \[V_{GS1}-I_{in}R-V_{GS2}=0\]
</p><!-- l. 1715 --><p class='indent'>   since the sources of the transistors are tied together, and assuming the threshold voltages are the same, we can
write
</p><!-- l. 1723 --><p class='indent'>   \begin {equation}  \label {eqn:peaking_cs} \begin {split} V_{ov2} &amp;= V_{ov1} - I_{in}R \\ I_{out} &amp;= k_2(V_{ov2}-I_{in}R)^2 \end {split}  \end {equation}<a id='x1-56002r34'></a>
</p><!-- l. 1726 --><p class='indent'>   In eqn <a href='#x1-56002r34'>34<!-- tex4ht:ref: eqn:peaking_cs  --></a>, we assumed that both M1 and M2 are in strong inversion. But if the input current is very small, M1 and M2
are in weak inversion where the transistors have an exponential dependence on \(V_{GS}\) [<a id='x1-56003'></a><a href='#cite.0_gray_analog_2009'>5</a>]. In this region, we can rewrite the above
eqns as
</p><!-- l. 1729 --><p class='indent'>   \[I_{out} \approx I_{in} \exp \bigg (-\frac {I_{in}R}{nV_T}\bigg )\]
</p><!-- l. 1731 --><p class='indent'>   As seen on the plot on the right in figure <a href='#left-mos-peaking-current-source-right-output-if-both-transistors-are-in-strong-or-weak-inversion-together'>63<!-- tex4ht:ref: fig:peaking_cs  --></a>, when the input current is small, \(I_{out} \approx I_{in}\). We see a peaking behavior as the current
increases because the drop across the resistor is slower than the increase in \(V_{GS1}\) [<a href='#cite.0_gray_analog_2009'>5</a>]. The peak value depends on the value of the
resistor.
</p>
   <h4 class='subsectionHead' id='generating-bias-voltages'><span class='titlemark'>5.5   </span> <a id='x1-570005.5'></a>Generating Bias Voltages</h4>
<!-- l. 1750 --><p class='noindent'>We can generate two kinds of bias voltages - absolutely proportional to temperature (PTAT) or inversely proportional to
temperature (CTAT) - and we can combine them to form a temperature independent bias. Figure <a href='#widlar-current-source1'>62<!-- tex4ht:ref: fig:widlar_cs  --></a> shows a Widlar
current source that can achieve both these objectives.
</p><!-- l. 1759 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='ctat'><span class='titlemark'>5.5.1   </span> <a id='x1-580005.5.1'></a>CTAT</h5>
<!-- l. 1761 --><p class='noindent'>Take voltage across a diode as a function of current through it [<a id='x1-58001'></a><a href='#cite.0_prasad_bandgap_2018'>11</a>] -
</p><!-- l. 1769 --><p class='indent'>   \begin {equation}  \label {eqn:diode_ctat} \begin {split} V_D &amp;= V_T \ln \bigg (\frac {I_0}{I_S}\bigg ) \\ I_S &amp;= bT^{4+m}\exp \bigg (\frac {-E_g}{kT}\bigg ) \end {split}  \end {equation}<a id='x1-58002r35'></a>
</p><!-- l. 1772 --><p class='indent'>   where \(I_S\) is the reverse saturation current through the diode. On first glance, eqn <a href='#x1-58002r35'>35<!-- tex4ht:ref: eqn:diode_ctat  --></a> looks PTAT. However, turns out \(I_S\) is
strongly CTAT and we get eqn <a href='#x1-58003r36'>36<!-- tex4ht:ref: eqn:diode_ctat2  --></a> which proves that the drop across a diode is indeed CTAT.
</p><!-- l. 1782 --><p class='indent'>   \begin {equation}  \label {eqn:diode_ctat2} \begin {split} \frac {\partial V_D}{\partial T} &amp;= \frac {1}{T} (V_D-(4+m)V_T-\frac {E_g}{q}) &lt; 0 \end {split}  \end {equation}<a id='x1-58003r36'></a>
</p><!-- l. 1784 --><p class='indent'>   The same expressions (with slightly different values) are true for a BJT as well (basically any pn junction). The
base-emitter voltage (similar to \(V_{GS}\)) is also CTAT.
</p><!-- l. 1786 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='ptat'><span class='titlemark'>5.5.2   </span> <a id='x1-590005.5.2'></a>PTAT</h5>
<!-- l. 1788 --><p class='noindent'>Thermal voltage \(V_T\) is PTAT. How do we obtain this?
</p>
   <figure class='figure' id='x1-5900164'><span id='the-difference-between-vd-and-vd-is-ptat'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1792 --><p class='noindent'><img alt='PIC' height='150' src='images/ptat_basic.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 64: </span><span class='content'>The difference between \(V_D\) and \(V_{D1}\) is PTAT</span></figcaption><!-- tex4ht:label?: x1-5900164  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1797 --><p class='indent'>   If we force the same current \(I_0\) through the two branches, where each diode is of the same size, we see
that
</p><!-- l. 1808 --><p class='indent'>   \begin {equation}  \label {eqn:ptat_basic} \begin {split} I_0 &amp;= nI_S \exp \bigg (\frac {V_{D1}}{V_T}\bigg ) \\ V_D &amp;= V_T \ln \frac {I_0}{I_S} \\ V_{D1} &amp;= V_T \ln \frac {I_0}{nI_S} \\ V_D-V_{D1} &amp;= V_T \ln n \propto T \\ \end {split}  \end {equation}<a id='x1-59002r37'></a>
</p><!-- l. 1810 --><p class='indent'>   From eqn <a href='#x1-59002r37'>37<!-- tex4ht:ref: eqn:ptat_basic  --></a>, we see that the difference in the two voltages is PTAT. We can modify the ckt slightly to a make the
voltage drop across a resistor PTAT as shown in figure <a href='#left-modified-ptat-ckt-right-implementation-of-the-ckt-using-a-current-mirror'>65<!-- tex4ht:ref: fig:ptat_basics2  --></a>. Here we insist that two things - the currents through both
branches should be the same, and the voltages at \(V_D\) and \(V_2\) are the same. In this particular example we’re using a supply
independent current source to achieve these two criteria, but we could use a current source and an op-amp or any other ckt
to achieve the same.
</p>
   <figure class='figure' id='x1-5900365'><span id='left-modified-ptat-ckt-right-implementation-of-the-ckt-using-a-current-mirror'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1817 --><p class='noindent'><img alt='PIC' height='150' src='images/ptat_basic2.png' width='150' /><img alt='PIC' height='150' src='images/ptat_basic2_implementation1.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 65: </span><span class='content'>(Left) Modified PTAT ckt (Right) Implementation of the ckt using a current mirror</span></figcaption><!-- tex4ht:label?: x1-5900365  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1822 --><p class='indent'>   In figure <a href='#left-modified-ptat-ckt-right-implementation-of-the-ckt-using-a-current-mirror'>65<!-- tex4ht:ref: fig:ptat_basics2  --></a>, we can write that the voltage across the resistors is PTAT and is given by the same eqn as in eqn <a href='#x1-59002r37'>37<!-- tex4ht:ref: eqn:ptat_basic  --></a>. We
can also write
</p><!-- l. 1825 --><p class='indent'>   \[V_D-V_{D1} = I_0R_1=V_T \ln n\]
</p><!-- l. 1827 --><p class='indent'>   this means that if we can copy the current \(I_0\) onto another branch, we can make another PTAT source (\(I_0\) is a PTAT current
source and voltage drop across R2 is a PTAT voltage source).
</p>
   <figure class='figure' id='x1-5900466'><span id='left-voltage-across-r-is-ptat-right-implementing-the-ckt-using-diode-connected-bjts-base-and-collector-are-tied-together'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1831 --><p class='noindent'><img alt='PIC' height='150' src='images/ptat_basic3.png' width='150' /><img alt='PIC' height='150' src='images/ptat_basic2_implementation2.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 66: </span><span class='content'>(Left) Voltage across R2 is PTAT (Right) Implementing the ckt using diode connected BJTs (base and
collector are tied together)</span></figcaption><!-- tex4ht:label?: x1-5900466  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1836 --><p class='indent'>   \[V_{R2} = I_0R_2 = V_T \ln n \bigg (\frac {R_2}{R_1}\bigg )\]
</p>
   <div class='tcolorbox tcolorbox' id='tcolobox-8'>     
<div class='tcolorbox-title'>
   </div> 
<div class='tcolorbox-content'><!-- l. 1840 --><p class='noindent'>To summarize,
       </p><ol class='enumerate1'>
<li class='enumerate' id='x1-59006x1'>Voltage drop across a PN junction is CTAT.
       </li>
<li class='enumerate' id='x1-59008x2'>Voltage difference across two diodes of different sizes but carrying the same current is PTAT.
       </li>
<li class='enumerate' id='x1-59010x3'>With some modifications, we can get a PTAT current source as in figure <a href='#left-voltage-across-r-is-ptat-right-implementing-the-ckt-using-diode-connected-bjts-base-and-collector-are-tied-together'>66<!-- tex4ht:ref: fig:ptat_basics3  --></a>.</li></ol>
 
</div> 
</div>
   <h4 class='subsectionHead' id='supplyindependent-biasing'><span class='titlemark'>5.6   </span> <a id='x1-600005.6'></a>Supply-independent biasing</h4>
<!-- l. 1850 --><p class='noindent'>Let us look at how we implemented the cross-coupled current mirror in figures <a href='#left-modified-ptat-ckt-right-implementation-of-the-ckt-using-a-current-mirror'>65<!-- tex4ht:ref: fig:ptat_basics2  --></a> and <a href='#left-voltage-across-r-is-ptat-right-implementing-the-ckt-using-diode-connected-bjts-base-and-collector-are-tied-together'>66<!-- tex4ht:ref: fig:ptat_basics3  --></a>. We want a current that is
independent of \(V_{DD}\). In figure <a href='#supplyindependent-currents'>67<!-- tex4ht:ref: fig:supply-ind-bias  --></a>, we can set \(I_{OUT} = K I_{REF}\) with any arbitrarily set \(I_{REF}\). To add an extra, constraint to the system, we add a
resistor at the source of M2 to define a current level.
</p>
   <figure class='figure' id='x1-6000167'><span id='supplyindependent-currents'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1858 --><p class='noindent'><img alt='PIC' height='150' src='images/suppl_ind_bias.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 67: </span><span class='content'>Supply-independent currents</span></figcaption><!-- tex4ht:label?: x1-6000167  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1863 --><p class='indent'>   In figure <a href='#left-constant-gm-biasing-scheme-right-lesser-body-effect-since-the-pmos-source-and-bulk-can-be-tied-together-easily'>68<!-- tex4ht:ref: fig:constant-gm  --></a>, if we ignore channel length modulation and body effect, we can write the output current
as
</p><!-- l. 1868 --><p class='indent'>   \begin {equation}  \label {eqn:const_gm_current} I_{OUT} = \frac {2}{\mu C_{ox}(W/L)} \frac {1}{R^2_S} \bigg (1 - \frac {1}{\sqrt {K}}\bigg )^2  \end {equation}<a id='x1-60002r38'></a>
</p><!-- l. 1870 --><p class='indent'>   In [<a id='x1-60003'></a><a href='#cite.0_razavi_design_2017'>12</a>], example 12.1 solves for the output current sensitivity as a function of \(V_{DD}\) when there is channel length modulation
is not negligible. The surprising result is that, the sensitivity \(I_{OUT}/V_{DD}\) can be reduced if M4 has high output impedance (among
other factors). Therefore, for these ckts, we generally use long channel devices to make the dependence on supply voltage
minimal and to reduce flicker noise.
</p>
   <figure class='figure' id='x1-6000468'><span id='left-constant-gm-biasing-scheme-right-lesser-body-effect-since-the-pmos-source-and-bulk-can-be-tied-together-easily'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1876 --><p class='noindent'><img alt='PIC' height='200' src='images/const-gm-bias.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 68: </span><span class='content'>(Left) Constant \(g_m\) biasing scheme (Right) Lesser body effect since the PMOS source and bulk can be tied
together easily</span></figcaption><!-- tex4ht:label?: x1-6000468  -->
                                                                                               
                                                                                               
   </figure>
   <h5 class='subsubsectionHead' id='loop-gain'><span class='titlemark'>5.6.1   </span> <a id='x1-610005.6.1'></a>Loop gain</h5>
<!-- l. 1883 --><p class='noindent'>In figure <a href='#left-constant-gm-biasing-scheme-right-lesser-body-effect-since-the-pmos-source-and-bulk-can-be-tied-together-easily'>68<!-- tex4ht:ref: fig:constant-gm  --></a>, does it matter how the loop is closed? Can we have M2 as a diode connected device and switch the loop
direction? Turns out, no. As seen in figure <a href='#left-correct-loop-positive-feedback-t-right-positive-feedback-t-unstable'>69<!-- tex4ht:ref: fig:correct_loop  --></a>, only when M2 has a degeneration resistance does the loop gain remain below
1 despite positive feedback. In the opposite case, the feedback is still positive but the loop gain is greater than
1.
</p>
   <figure class='figure' id='x1-6100169'><span id='left-correct-loop-positive-feedback-t-right-positive-feedback-t-unstable'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1889 --><p class='noindent'><img alt='PIC' height='150' src='images/correct_loop.png' width='150' /><img alt='PIC' height='150' src='images/wrong_loop.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 69: </span><span class='content'>(Left) Correct loop - positive feedback \(|T| &lt; 1\) (Right) Positive feedback \(|T| &gt; 1\) - unstable</span></figcaption><!-- tex4ht:label?: x1-6100169  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1895 --><p class='indent'>   We can use \(I_{OUT}\) from figure <a href='#supplyindependent-currents'>67<!-- tex4ht:ref: fig:supply-ind-bias  --></a> to bias transistors to have a constant-\(g_m\) across PVT. If \(R_S\) has a known temperature flavor
(CTAT or PTAT), we can use previously seen techniques to create a temperature-independent current source. For devices
that match the size of M2, we get a fixed \(g_m\) across PVT
</p><!-- l. 1898 --><p class='indent'>   \[g_m = \frac {2}{R_S}\bigg (1 - \frac {1}{\sqrt {K}}\bigg )\]
</p><!-- l. 1900 --><p class='indent'>   This ckt is also known as constant-\(g_m\) biasing. An improved constant-\(g_m\) biasing ckt is shwon in figure <a href='#improved-constantgm-biasing-using-an-opamp'>70<!-- tex4ht:ref: fig:improved_constant_gm  --></a>.
</p>
   <figure class='figure' id='x1-6100270'><span id='improved-constantgm-biasing-using-an-opamp'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1904 --><p class='noindent'><img alt='PIC' height='150' src='images/improved_constant-gm.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 70: </span><span class='content'>Improved constant-\(g_m\) biasing using an op-amp</span></figcaption><!-- tex4ht:label?: x1-6100270  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='temperatureindependent-voltages'><span class='titlemark'>5.7   </span> <a id='x1-620005.7'></a>Temperature-independent voltages</h4>
<!-- l. 1913 --><p class='noindent'>Adding a PTAT and a CTAT voltage with the appropriate coefficients gives us a temperature-independent voltage source
(or current source if we pick a suitable resistor).
</p>
   <figure class='figure' id='x1-6200171'><span id='temperatureindependent-voltage-left-using-a-current-mirror-right-using-an-opamp'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1917 --><p class='noindent'><img alt='PIC' height='150' src='images/t-ind_voltage.png' width='150' /><img alt='PIC' height='150' src='images/op-amp-bgr.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 71: </span><span class='content'>Temperature-independent voltage - (Left) Using a current mirror (Right) Using an op-amp</span></figcaption><!-- tex4ht:label?: x1-6200171  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1923 --><p class='indent'>   As long as the current mirror (or equivalently an op-amp) maintains the \(V_D = V_2\), the dependence on supply voltage depends on
the PSRR of the constant-\(g_m\) or the op-amp ckt. The current in the outermost branch is PTAT - when deriving the \(V_{BE}\) drop
across a diode, we assumed a constant current source as seen in eqn <a href='#x1-58002r35'>35<!-- tex4ht:ref: eqn:diode_ctat  --></a>. Will the voltage drop still be CTAT if the current \(I_0\)
through the diode is PTAT? Turns out, yes - though a PTAT current is passed through a diode, voltage
across it is still a CTAT with slightly lower slope when compared to diode biased using constant current
[<a id='x1-62002'></a><a href='#cite.0_prasad_bandgap_2018'>11</a>].
</p><!-- l. 1928 --><p class='indent'>   In the case of the op-amp in figure <a href='#temperatureindependent-voltage-left-using-a-current-mirror-right-using-an-opamp'>71<!-- tex4ht:ref: fig:t-ind_voltage  --></a>, \(V_D=V_2\) is the CTAT voltage and the voltage drop across R1 is the PTAT voltage. If we
want to create lower voltages, we need to somehow diving the PTAT and CTAT voltages by some constant (temperature
independent). This is achieved by the ckt in figure <a href='#low-voltage-reference'>72<!-- tex4ht:ref: fig:low_voltage_ref  --></a>.
</p>
   <figure class='figure' id='x1-6200372'><span id='low-voltage-reference'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1934 --><p class='noindent'><img alt='PIC' height='200' src='images/low-voltage-bgr.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 72: </span><span class='content'>Low voltage reference</span></figcaption><!-- tex4ht:label?: x1-6200372  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1939 --><p class='indent'>   The CTAT and PTAT voltages are divided by the resistors places in the parallel branches, which yields a lower reference
voltage.
</p>
   <h4 class='subsectionHead' id='startup-ckt'><span class='titlemark'>5.8   </span> <a id='x1-630005.8'></a>Startup ckt</h4>
<!-- l. 1943 --><p class='noindent'>Since self biased circuits have two operating points namely zero current and normal operating point, it must have a startup
circuit [<a id='x1-63001'></a><a href='#cite.0_prasad_bandgap_2018'>11</a>].
</p>
   <figure class='figure' id='x1-6300273'><span id='two-different-startup-ckts'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1948 --><p class='noindent'><img alt='PIC' height='250' src='images/startup1.png' width='250' /><img alt='PIC' height='150' src='images/startup2.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 73: </span><span class='content'>Two different startup ckts</span></figcaption><!-- tex4ht:label?: x1-6300273  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1953 --><p class='indent'>   In figure <a href='#two-different-startup-ckts'>73<!-- tex4ht:ref: fig:startup_ckt  --></a> on the left, M6 is a small W/large L device which acts as a large resistor. It pulls the gate of M9 high,
turning it on. M9 tries to pull the gates of M3 and M4 low, which starts up a current in them and this sets the current
flowing through all branches. M5 is also now on (since its gate is tied to M3’s/M4’s) and turns on M7 which pulls M9 low
(large IR drop across M6) and shuts the startup ckt.
</p><!-- l. 1957 --><p class='indent'>   In the same figure on the right is a much simpler startup ckt. M5 is off initially, meaning the voltage at its drain is \(V_{DD}\).
Similarly, M1 is off and its drain is GNDed. M5 turns on and conducts current since it sees a potential on its gate and a
huge \(V_{DS}\). As the voltage on the gates of the current mirror devices increase, the diode-connected device eventually goes into
cut-off and is removed from the ckt.
                                                                                               
                                                                                               
</p>
   <h3 class='sectionHead' id='oscillators'><span class='titlemark'>6   </span> <a id='x1-640006'></a>Oscillators</h3>
<!-- l. 1968 --><p class='noindent'>There are different classes of oscillators but we only discuss RC/LC oscillators here.
</p><!-- l. 1970 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='schmitt-triggerbased-oscillator'><span class='titlemark'>6.1   </span> <a id='x1-650006.1'></a>Schmitt Trigger-based oscillator</h4>
<!-- l. 1972 --><p class='noindent'>In figure <a href='#schmitt-triggerbased-oscillator-computerelectronicscmosschmitt'>74<!-- tex4ht:ref: fig:schmitt_osc  --></a>, we see that the on and off times for a Schmitt trigger-based oscillator depends on the ratio of the high and low
switching thresholds and the external RC network. The output is a square wave with rise and fall times
dictated by the delays through the Schmitt trigger’s internal circuitry. The oscillation frequency is given by
\(f=1/(t_1+t_2)\).
</p>
   <figure class='figure' id='x1-6500174'><span id='schmitt-triggerbased-oscillator-computerelectronicscmosschmitt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1980 --><p class='noindent'><img alt='PIC' height='200' src='images/schmitt_osc1.png' width='200' /><img alt='PIC' height='200' src='images/schmitt_osc2.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 74: </span><span class='content'>Schmitt trigger-based oscillator [<a id='x1-65002'></a><a href='#cite.0_computer_electronics_cmos_schmitt_2024'>1</a>]</span></figcaption><!-- tex4ht:label?: x1-6500174  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 1985 --><p class='indent'>   In figure <a href='#schmitt-triggerbased-vco-computerelectronicscmosschmitt'>75<!-- tex4ht:ref: fig:schmitt_osc3  --></a>, we see a voltage-controlled oscillator (VCO) built out a current-starved inverter and a Schmitt-trigger. The
current mirrors M5 and M6 set the bias current in the inverter branch. When the input is 0, M3 and M4 charge the
capacitor C, whose voltage rises linearly. The Schmitt trigger is pulled high at \(V_{SPH}\) and the final inverter sets positive feedback
to turn off the PMOS devices and discharge the capacitor through the NMOS devices. The control voltage can change the
bias currents, thereby, controlling the oscillation frequency.
</p>
   <figure class='figure' id='x1-6500375'><span id='schmitt-triggerbased-vco-computerelectronicscmosschmitt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 1993 --><p class='noindent'><img alt='PIC' height='250' src='images/schmitt_osc3.png' width='250' />
</p>
<figcaption class='caption'><span class='id'>Figure 75: </span><span class='content'>Schmitt trigger-based VCO [<a id='x1-65004'></a><a href='#cite.0_computer_electronics_cmos_schmitt_2024'>1</a>]</span></figcaption><!-- tex4ht:label?: x1-6500375  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='rc-oscillators'><span class='titlemark'>6.2   </span> <a id='x1-660006.2'></a>RC Oscillators</h4>
<!-- l. 2003 --><p class='noindent'>We follow some examples from this blog [<a id='x1-66001'></a><a href='#cite.0_rc_oscillator_tutorial'>3</a>].
</p><!-- l. 2005 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='generic-phase-shift-network'><span class='titlemark'>6.2.1   </span> <a id='x1-670006.2.1'></a>Generic Phase shift network</h5>
<!-- l. 2007 --><p class='noindent'>A cascade of 3 RC stages can provide a phase shift of 180\(^\circ \) - where each stage is tuned to give a 60\(\circ \) shift by selecting the
appropriate value for the passive components.
</p><!-- l. 2009 --><p class='indent'>   \[\phi = \arctan \bigg (\frac {1}{sCR}\bigg )\]
</p>
   <figure class='figure' id='x1-6700176'><span id='phase-shift-network-and-a-possible-implementation-with-an-opamp'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2013 --><p class='noindent'><img alt='PIC' height='200' src='images/phase_shift_network.png' width='200' /><img alt='PIC' height='200' src='images/opamp_rc1.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 76: </span><span class='content'>Phase shift network and a possible implementation with an op-amp</span></figcaption><!-- tex4ht:label?: x1-6700176  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2019 --><p class='indent'>   An active component that can provide a gain of at least 1 at the required frequency while providing another 180\(\circ \) is used
to create the positive feedback loop. One such implementation is shown in figure <a href='#phase-shift-network-and-a-possible-implementation-with-an-opamp'>76<!-- tex4ht:ref: fig:phase_shift_network  --></a> with an op-amp. The oscillation
frequency is given by \(f=1/2\pi RC \sqrt {2N}\).
</p>
   <h5 class='subsubsectionHead' id='wien-bridge-oscillator'><span class='titlemark'>6.2.2   </span> <a id='x1-680006.2.2'></a>Wien Bridge Oscillator</h5>
<!-- l. 2024 --><p class='noindent'>Another topology of an RC phase shift network is implementing a high-pass filter followed by a low-pass filter to pick a
particular frequency and to be able to tune the \(Q\) of the oscillator. In figure <a href='#wien-bride-oscillator'>77<!-- tex4ht:ref: fig:wien_bridge_osc  --></a>, a series RC and a parallel-RC network act as
a phase shift network and the resistances R1 and R2 set the closed loop gain (non-inverting). The oscillation frequency is
given by \(f=1/2\pi RC\).
</p>
   <figure class='figure' id='x1-6800177'><span id='wien-bride-oscillator'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2030 --><p class='noindent'><img alt='PIC' height='150' src='images/wien_bridge_osc.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 77: </span><span class='content'>Wien bride oscillator</span></figcaption><!-- tex4ht:label?: x1-6800177  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2035 --><p class='indent'>   Another way to implement this filter is using a notch filter - low-pass in combination with a high-pass filter. This
replaces the filter in the previous example, giving us the ckt in figure <a href='#twint-oscillator'>78<!-- tex4ht:ref: fig:twint_osc  --></a>. This ckt is sometimes called the twin-T oscillator
and it has the same oscillation frequency as the Wien bridge oscillator.
</p>
   <figure class='figure' id='x1-6800278'><span id='twint-oscillator'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2043 --><p class='noindent'><img alt='PIC' height='175' src='images/notch_filter.png' width='175' /><img alt='PIC' height='175' src='images/twin-t.png' width='175' />
</p>
<figcaption class='caption'><span class='id'>Figure 78: </span><span class='content'>Twin-T oscillator</span></figcaption><!-- tex4ht:label?: x1-6800278  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='lc-oscillators'><span class='titlemark'>6.3   </span> <a id='x1-690006.3'></a>LC oscillators</h4>
<!-- l. 2050 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='rlc-network-basics'><span class='titlemark'>6.3.1   </span> <a id='x1-700006.3.1'></a>RLC network basics</h5>
<!-- l. 2052 --><p class='noindent'>An ideal LC tank, which is made of an inductor and a capacitor in parallel, has an impedance across its terminals given by
\[Z(s) = \frac {sL}{1+s^2LC}\]
</p><!-- l. 2055 --><p class='indent'>   At \(\omega = 1/\sqrt {LC}\), \(|Z(s)|\) blows up and when a zoltage is applied across the tank, the ckt draws no current from the source. In practice, there
is always a series resistance to the inductance and the impedance eqn changes to
</p><!-- l. 2058 --><p class='indent'>   \[Z(s) = \frac {R_s+sL}{1+sCR_{s}+s^2LC}\] \[|Z(s)| = \frac {R^2_s+\omega ^2 L^2}{(1-LC\omega ^2)+R^2_sC^2}\]
</p><!-- l. 2061 --><p class='indent'>   The impedance across the terminals doesn’t blow up to infinity but is still maximized at the same frequency as before.
We define the quality factor of the inductor as
</p><!-- l. 2063 --><p class='indent'>   \[Q = \frac {\omega L}{R}\]
</p><!-- l. 2065 --><p class='indent'>   We can use \(Q\) to model the series resistance as a parallel resistor and inductor combination as shown in figure
<a href='#left-lc-tank-right-expressing-series-lr-as-parallel-components'>79<!-- tex4ht:ref: fig:lc_tank  --></a>.
</p><!-- l. 2074 --><p class='indent'>   \begin {equation}  \label {eqn:inductance_z} \begin {split} L_p &amp;= L (1+\frac {1}{Q^2} \approx L \hspace {2mm }(Q &gt;&gt; 1)) \\ R_p &amp;\approx Q^2R_s \end {split}  \end {equation}<a id='x1-70001r39'></a>
</p>
   <figure class='figure' id='x1-7000279'><span id='left-lc-tank-right-expressing-series-lr-as-parallel-components'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2078 --><p class='noindent'><img alt='PIC' height='175' src='images/lc_tank.png' width='175' /><img alt='PIC' height='175' src='images/lc_tank_par.png' width='175' />
</p>
<figcaption class='caption'><span class='id'>Figure 79: </span><span class='content'>(Left) LC tank (Right) Expressing series LR as parallel components</span></figcaption><!-- tex4ht:label?: x1-7000279  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2083 --><p class='indent'>   As seen in figure <a href='#lc-tanks-impedance-magnitude-and-phase-response'>80<!-- tex4ht:ref: fig:lc_tank_response  --></a>, the phase starts at +90\(^\circ \) at DC, becomes zero at the resonant frequency, and then becomes
-90\(^\circ \).
</p>
   <figure class='figure' id='x1-7000380'><span id='lc-tanks-impedance-magnitude-and-phase-response'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2088 --><p class='noindent'><img alt='PIC' height='150' src='images/lc_tank_response.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 80: </span><span class='content'>LC tank’s impedance - magnitude and phase response</span></figcaption><!-- tex4ht:label?: x1-7000380  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='tuned-gain-stage'><span class='titlemark'>6.4   </span> <a id='x1-710006.4'></a>Tuned gain stage</h4>
<!-- l. 2095 --><p class='noindent'>A tuned gain stage is shown in figure <a href='#left-tuned-gain-stage-right-two-tuned-stages-in-feedback-can-oscillate-at-the-resonant-frequency'>81<!-- tex4ht:ref: fig:tuned_gain_stage  --></a>. It is a common source stage with an RLC tank as the input. At \(\omega = 1/\sqrt {LC}\), the ckt has a
gain of \(-g_mR_p\) and the gain is close to zero at high and low frequencies. Two such stages can act as an oscillator if the loop gain is
greater than 1.
</p>
   <figure class='figure' id='x1-7100181'><span id='left-tuned-gain-stage-right-two-tuned-stages-in-feedback-can-oscillate-at-the-resonant-frequency'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2100 --><p class='noindent'><img alt='PIC' height='150' src='images/tuned_gain_stage.png' width='150' /><img alt='PIC' height='150' src='images/tuned_gain_stage2.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 81: </span><span class='content'>(Left) Tuned gain stage (Right) Two tuned stages in feedback can oscillate at the resonant frequency</span></figcaption><!-- tex4ht:label?: x1-7100181  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2105 --><p class='indent'>   In fact, this two-stage tuned gain oscillator can be made fully differential and redrawn as a cross-coupled oscillator as
shown in figure <a href='#crosscoupled-pair'>82<!-- tex4ht:ref: fig:xcoupled_pair  --></a>.
</p>
   <figure class='figure' id='x1-7100282'><span id='crosscoupled-pair'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2112 --><p class='noindent'><img alt='PIC' height='150' src='images/cross_coupled_osc.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 82: </span><span class='content'>Cross-coupled pair</span></figcaption><!-- tex4ht:label?: x1-7100282  -->
                                                                                               
                                                                                               
   </figure>
   <h5 class='subsubsectionHead' id='colpitts-oscillator'><span class='titlemark'>6.4.1   </span> <a id='x1-720006.4.1'></a>Colpitts Oscillator</h5>
<!-- l. 2120 --><p class='noindent'>We can realize an LC oscillator even with a single stage. Let us first consider the following points - the single stage ckt in
figure <a href='#left-tuned-gain-stage-right-two-tuned-stages-in-feedback-can-oscillate-at-the-resonant-frequency'>81<!-- tex4ht:ref: fig:tuned_gain_stage  --></a> has a phase shift of 180\(^\circ \) rather than 360\(^\circ \), second, a common-gate stage introduces zero phase shift. We can use the
following points to build a ckt which could oscillate if the output is returned to the source instead of the gate! Figure <a href='#this-ckt-wont-oscillate-due-to-loop-gain-less-than-'>83<!-- tex4ht:ref: fig:colpitts_osc  --></a>
shows such a ckt. The only issue is that the closed loop gain is never infinity (at any frequency), the ckt fails to oscillate.
Another issue is that the source degeneration in figure <a href='#this-ckt-wont-oscillate-due-to-loop-gain-less-than-'>83<!-- tex4ht:ref: fig:colpitts_osc  --></a> is infinite - meaning no voltage gain from input to
output.
</p>
   <figure class='figure' id='x1-7200183'><span id='this-ckt-wont-oscillate-due-to-loop-gain-less-than-'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2127 --><p class='noindent'><img alt='PIC' height='150' src='images/colpitts_osc.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 83: </span><span class='content'>This ckt won’t oscillate due to loop gain less than 1</span></figcaption><!-- tex4ht:label?: x1-7200183  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2132 --><p class='indent'>   We solve these issues by making the changes shown in the ckt as shown in figure <a href='#colpitts-oscillator1'>84<!-- tex4ht:ref: fig:colpitts_osc_actual  --></a>. Without the parallel capacitance in
the LC tank, the oscillation frequency is given by
</p><!-- l. 2138 --><p class='indent'>   \begin {equation}  \label {eqn:colpitts1} \omega ^2_R = \frac {1}{L\frac {C_1C_2}{C_1+C_2}}  \end {equation}<a id='x1-72002r40'></a>
</p><!-- l. 2141 --><p class='indent'>   If there is a parallel capacitor in the LC tank, \(C_p\), then the eqn <a href='#x1-72002r40'>40<!-- tex4ht:ref: eqn:colpitts1  --></a> changes slightly with \(C_p\) in parallel to the series
combination of C1 and C2.
</p>
   <figure class='figure' id='x1-7200384'><span id='colpitts-oscillator1'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2145 --><p class='noindent'><img alt='PIC' height='150' src='images/actual_colpitts_osc.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 84: </span><span class='content'>Colpitts oscillator</span></figcaption><!-- tex4ht:label?: x1-7200384  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='negative-impedance'><span class='titlemark'>6.5   </span> <a id='x1-730006.5'></a>Negative impedance</h4>
<!-- l. 2152 --><p class='noindent'>Before we see how do we get negative resistance, let’s see why it could be helpful to have such a tool. In the LC tank in
figure <a href='#left-lc-tank-right-expressing-series-lr-as-parallel-components'>79<!-- tex4ht:ref: fig:lc_tank  --></a>, we see that having a series resistance (or equivalently a parallel resistance) prevents the impedance from blowing
up. Ideally, we would like to have infinite \(Q\) and this can happen only when resistance vanishes. If we had a negative
resistance in parallel to the equivalent parallel resistance, we can achieve this!
</p><!-- l. 2156 --><p class='indent'>   How do we get a negative impedance? In feedback, the loopgain is positive for a negative feedback scenario. However, for
a system in positive feedback, the loop gain is negative and if this is sufficiently negative, the impedance can be negative
[<a id='x1-73001'></a><a href='#cite.0_razavi_design_2017'>12</a>]. How do we get positive feeback? By making sure there are no signal inversions but still making a 180\(\circ \) phase shift
around the loop.
</p><!-- l. 2160 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='source-follower-negative-input-impedance'><span class='titlemark'>6.5.1   </span> <a id='x1-740006.5.1'></a>Source follower - negative input impedance</h5>
<!-- l. 2162 --><p class='noindent'>In figure <a href='#left-source-follower-negative-input-impedance-with-positive-feedback-center-oscillator-with-this-ckt-right-fully-differential-version-of-the-same-ckt'>85<!-- tex4ht:ref: fig:sf_neg_rin  --></a>, a source follower is used (M1) in positive feedback with a common gate stage (M2). Both of these stages do not
produce a sign inversion in gain. Negative resistance comes from the fact that if input at gate of M1 increases, so does the
voltage at source, which decreases the drain of M2 (since \(V_{GS}\) decreases). In fact, the input impedance of this ckt is \(-2/g_m\). We
can build an oscillator as shown on the right in figure <a href='#left-source-follower-negative-input-impedance-with-positive-feedback-center-oscillator-with-this-ckt-right-fully-differential-version-of-the-same-ckt'>85<!-- tex4ht:ref: fig:sf_neg_rin  --></a> to cancel out the parallel resistance in the LC
tank.
</p>
   <figure class='figure' id='x1-7400185'><span id='left-source-follower-negative-input-impedance-with-positive-feedback-center-oscillator-with-this-ckt-right-fully-differential-version-of-the-same-ckt'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2168 --><p class='noindent'><img alt='PIC' height='150' src='images/sf_neg_rin.png' width='150' /><img alt='PIC' height='150' src='images/sf_neg_rin_osc.png' width='150' /><img alt='PIC' height='150' src='images/sf_neg_rin_osc_fd.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 85: </span><span class='content'>(Left) Source Follower Negative Input Impedance with positive feedback (Center) Oscillator with this
ckt (Right) Fully differential version of the same ckt</span></figcaption><!-- tex4ht:label?: x1-7400185  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2173 --><p class='indent'>   A fully differential version is shown in figure <a href='#left-source-follower-negative-input-impedance-with-positive-feedback-center-oscillator-with-this-ckt-right-fully-differential-version-of-the-same-ckt'>85<!-- tex4ht:ref: fig:sf_neg_rin  --></a>. We get a differential output at X and Y nodes that can used to
alternatively turn on and off two different outputs (like LEDs).
                                                                                               
                                                                                               
</p>
   <h3 class='sectionHead' id='noise1'><span class='titlemark'>7   </span> <a id='x1-750007'></a>Noise</h3>
<!-- l. 2186 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='noise-psd'><span class='titlemark'>7.1   </span> <a id='x1-760007.1'></a>Noise PSD</h4>
<!-- l. 2188 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='noise-models'><span class='titlemark'>7.2   </span> <a id='x1-770007.2'></a>Noise Models</h4>
<!-- l. 2190 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='noise-calculations'><span class='titlemark'>7.3   </span> <a id='x1-780007.3'></a>Noise calculations</h4>
<!-- l. 2192 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='noise-in-differential-ckts'><span class='titlemark'>7.4   </span> <a id='x1-790007.4'></a>Noise in differential ckts</h4>
<!-- l. 2194 --><p class='noindent'>In a fully differential diff pair, the tail current’s noise splits into the two branches equally and doesn’t show up in the
differential output. The input pair and the current source - each one of them - contributes to the output differential
noise.
</p>
   <figure class='figure' id='x1-7900186'><span id='noise-in-a-diff-pair'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2199 --><p class='noindent'><img alt='PIC' height='200' src='images/5t_ota_noise1.png' width='200' /><img alt='PIC' height='200' src='images/5t_ota_noise2.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 86: </span><span class='content'>Noise in a diff pair</span></figcaption><!-- tex4ht:label?: x1-7900186  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2206 --><p class='indent'>   Similarly, the bias noise shows up in common-mode (mirrored from bias branch to both branches of the diff pair) and
does not show up in a fully differential output. However, if the output is single ended, this noise shows up and is multiplied
by the current mirror ratio. In this case, we can add an RC-filter to the bias node and set the low-pass corner as per spec.
</p><figure class='figure' id='x1-7900287'><span id='filtering-out-bias-noise-in-a-singleended-output-case'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2210 --><p class='noindent'><img alt='PIC' height='150' src='images/5t_ota_noise-bias.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 87: </span><span class='content'>Filtering out bias noise in a single-ended output case</span></figcaption><!-- tex4ht:label?: x1-7900287  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2216 --><p class='indent'>   From figure <a href='#noise-in-a-diff-pair'>86<!-- tex4ht:ref: fig:5t_ota_noise  --></a>, we can rewrite the total output noise in the diff pair as
</p><!-- l. 2224 --><p class='indent'>   \begin {equation}  \label {eqn:5t_ota_noise_eqn} \begin {split} \overline {i^2_{n_out}} &amp;= 8k_bT (\gamma _p g_{mp} + \gamma _n g_{mn}) \\ \overline {i^2_{n_out}} &amp;= 8k_bT\gamma _n g_{mn} \bigg ( 1+ \frac {\gamma _p V^*_n}{\gamma _n V^*_p} \bigg ) \end {split}  \end {equation}<a id='x1-79003r41'></a>
</p><!-- l. 2226 --><p class='indent'>   From eqn <a href='#x1-79003r41'>41<!-- tex4ht:ref: eqn:5t_ota_noise_eqn  --></a>, we see that for a given input pair size, we need to increase the \(V^*_p\) of the current source to decrease the
output noise - leading to a tradeoff between output swing and noise.
</p>
   <h5 class='subsubsectionHead' id='cascode-devices'><span class='titlemark'>7.4.1   </span> <a id='x1-800007.4.1'></a>Cascode devices</h5>
<!-- l. 2232 --><p class='noindent'>In a cascode ckt, the cascode device does not contribute to noise when sized properly. This is summarized in figure <a href='#cascode-device-noise-circulates-within-itself-when-the-device-parasitcs-are-not-too-big'>88<!-- tex4ht:ref: fig:cascode_noise  --></a>. The
noise circulates within the cascode device when parasitcs at the source of M2 are not big enough to shunt any small signal
current to GND.
</p>
   <figure class='figure' id='x1-8000188'><span id='cascode-device-noise-circulates-within-itself-when-the-device-parasitcs-are-not-too-big'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2237 --><p class='noindent'><img alt='PIC' height='150' src='images/cascode_device_noise.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 88: </span><span class='content'>Cascode device noise circulates within itself when the device parasitcs are not too big</span></figcaption><!-- tex4ht:label?: x1-8000188  -->
                                                                                               
                                                                                               
   </figure>
   <h5 class='subsubsectionHead' id='how-to-find-output-noise'><span class='titlemark'>7.4.2   </span> <a id='x1-810007.4.2'></a>How to find output noise</h5>
<!-- l. 2245 --><p class='noindent'>Do we need to split the ckt into common-mode and differential ckts and then analyze both individually? Not quite, this is
because the tail node is no longer at virtual GND when analysing impact of noise from one input device (the other input
device is considered noiseless then), there is an inherent asymmetry in the ckt now and the half ckt concepts might not work
always.
</p><!-- l. 2249 --><p class='indent'>   How do common-mode feedback ckts impact noise?
</p><!-- l. 2259 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='input-referred-noise-'><span class='titlemark'>7.5   </span> <a id='x1-820007.5'></a>Input Referred Noise </h4>
<!-- l. 2260 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead' id='voltage-and-current-noise-sources-at-the-input'><span class='titlemark'>7.5.1   </span> <a id='x1-830007.5.1'></a>Voltage and Current Noise Sources at the input</h5>
<!-- l. 2263 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='reducing-noise-design-parameters'><span class='titlemark'>7.6   </span> <a id='x1-840007.6'></a>Reducing noise - design parameters</h4>
<!-- l. 2265 --><p class='noindent'>Flicker noise corner frequency is where the thermal noise from the channel equals the flicker noise in the
channel.
</p><!-- l. 2275 --><p class='indent'>   \begin {equation}  \label {eqn:flicker_noise} \begin {split} \frac {K_f I_D}{L^2C_{ox}}\frac {\Delta f}{f_{co}} &amp; = 4k_BT\gamma g_m \Delta f \implies f_{co} = \frac {K_f}{8k_BT\gamma C_{ox}} \frac {V^*}{L^2}\\ \frac {K_f g^2_m}{WLC_{ox}}\frac {\Delta f}{f_{co}} &amp; = 4k_BT\gamma g_m \Delta f \implies f_{co} = \frac {K_f}{4k_BT\gamma C_{ox}} \frac {1}{L} \frac {g_m}{I_D} \frac {I_D}{W} \end {split}  \end {equation}<a id='x1-84001r42'></a>
</p><!-- l. 2278 --><p class='indent'>   From the two eqns in figure <a href='#x1-84001r42'>42<!-- tex4ht:ref: eqn:flicker_noise  --></a>, we see that we can optimize the corner frequency in different ways. Increasing
channel length improved flicker noise in any case. For a given \(V^*\), \(f_{co}\) goes down by \(1/L^2\). On the other hand, lower \(g_m/I_D\)
(or higher \(V^*\)) can improve flicker noise corner for a given \(I_D\) (the discrepancy in the two eqns is from the fact
that different parameters are being held constant). Flicker noise increases with increased current density (\(I_D/W\)).
Overall, larger devices and higher \(V^*\) help flicker noise at the cost of decrease power efficiency and increased area.
Depending on the proces, PMOS devices can show lower 1/f noise compared to NMOS ones due to the buried
channel.
                                                                                               
                                                                                               
</p><!-- l. 2288 --><p class='noindent'>
</p>
   <h3 class='sectionHead' id='transimpedance-amplifiers'><span class='titlemark'>8   </span> <a id='x1-850008'></a>Transimpedance Amplifiers</h3>
<!-- l. 2290 --><p class='noindent'>Photodetectors convert optical power to current [<a id='x1-85001'></a><a href='#cite.0_palermo2024ecen620'>10</a>]. A Transimpedance Amplifier (TIA) converts this current
into a voltage that can be later digitized. A simple passive resistor can do the job as shown in figure <a href='#left-basic-tia-issccmagazine-right-analysis-of-a-simple-resistive-fe-palermoecen'>89<!-- tex4ht:ref: fig:basic_tia  --></a>. A
higher resistance gives a higher conversion gain and reduces noise current (which is 4kT/R, voltage noise
PSD is 4kTR) [<a id='x1-85002'></a><a href='#cite.0_isscc2025magazine'>6</a>]. However, the accuracy of the current sensed is impacted by the output impedance of the
sensor. Increasing resistance also decreases the bandwidth as shown in figure <a href='#left-basic-tia-issccmagazine-right-analysis-of-a-simple-resistive-fe-palermoecen'>89<!-- tex4ht:ref: fig:basic_tia  --></a>. This motivates a different
topology.
</p>
   <figure class='figure' id='x1-8500389'><span id='left-basic-tia-issccmagazine-right-analysis-of-a-simple-resistive-fe-palermoecen'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2296 --><p class='noindent'><img alt='PIC' height='250' src='images/basic_tia.png' width='250' /><img alt='PIC' height='200' src='images/resistive_fe_tia.png' width='200' />
</p>
<figcaption class='caption'><span class='id'>Figure 89: </span><span class='content'>(Left) Basic TIA [<a id='x1-85004'></a><a href='#cite.0_isscc2025magazine'>6</a>] (Right) Analysis of a simple resistive FE [<a id='x1-85005'></a><a href='#cite.0_palermo2024ecen620'>10</a>]</span></figcaption><!-- tex4ht:label?: x1-8500389  -->
                                                                                               
                                                                                               
   </figure>
   <h4 class='subsectionHead' id='commongate-tias'><span class='titlemark'>8.1   </span> <a id='x1-860008.1'></a>Common-gate TIAs</h4>
<!-- l. 2303 --><p class='noindent'>
</p>
   <h4 class='subsectionHead' id='feedback-tias'><span class='titlemark'>8.2   </span> <a id='x1-870008.2'></a>Feedback TIAs</h4>
<!-- l. 2305 --><p class='noindent'>Let’s consider the an ideal op-amp with a resistor in feedback . This is called an R-TIA. The input impedance (with an
ideal op-amp) is zero due to the virtual GND at the amplifier’s input and all the current flows through the feedback resistor.
Therefore, ideally,
</p><!-- l. 2308 --><p class='indent'>   \[\frac {V_{out}}{i_{in}} = R_F \]
</p>
   <figure class='figure' id='x1-8700190'><span id='resistive-tia-palermoecen'></span> 

                                                                                               
                                                                                               

                                                                                               
                                                                                               
<!-- l. 2313 --><p class='noindent'><img alt='PIC' height='150' src='images/rtia.png' width='150' />
</p>
<figcaption class='caption'><span class='id'>Figure 90: </span><span class='content'>Resistive TIA [<a id='x1-87002'></a><a href='#cite.0_palermo2024ecen620'>10</a>]</span></figcaption><!-- tex4ht:label?: x1-8700190  -->
                                                                                               
                                                                                               
   </figure>
<!-- l. 2318 --><p class='indent'>   Let’s relax the ideal op-amp assumption to gain more insights into the behavior of the R-TIA.
                                                                                               
                                                                                               
</p>
   <h3 class='sectionHead' id='references'><a id='x1-88000'></a>References</h3>
<!-- l. 2327 --><p class='noindent'>
     </p><dl class='thebibliography'><dt class='thebibliography' id='X0-computer_electronics_cmos_schmitt_2024'>
 [1]  </dt><dd class='thebibliography' id='bib-1'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_computer_electronics_cmos_schmitt_2024'></a>Computer&amp;Electronics.           <span class='cmti-10'>CMOS         Schmitt         trigger         and         its         application</span>.
     <a class='url' href='https://www.youtube.com/watch?v=0WSm7NBRnao'><span class='cmtt-10'>https://www.youtube.com/watch?v=0WSm7NBRnao</span></a>. YouTube video, published February 15, 2024. Accessed:
     August 22, 2025. Feb. 2024.
     </p></dd><dt class='thebibliography' id='X0-iitmadras_poles_zeros_2024'>
 [2]  </dt><dd class='thebibliography' id='bib-2'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_iitmadras_poles_zeros_2024'></a>IIT Madras - BS in Electronic Systems. <span class='cmti-10'>Lecture 12(1): Poles &amp; zeros in a cascode and telescopic cascode
     OTA</span>. <a class='url' href='https://www.youtube.com/watch?v=j_QmOO_C0Ns'><span class='cmtt-10'>https://www.youtube.com/watch?v=j_QmOO_C0Ns</span></a>. YouTube video, published April 8, 2024. Accessed:
     August 19, 2025. Apr. 2024.
     </p></dd><dt class='thebibliography' id='X0-rc_oscillator_tutorial'>
 [3]  </dt><dd class='thebibliography' id='bib-3'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_rc_oscillator_tutorial'></a>Electronics Tutorials. <span class='cmti-10'>RC Oscillator Circuit - The RC Oscillator Tutorial</span>. Accessed: August 23, 2025. 2024.
     <span class='cmcsc-10'><span class='small-caps'>url</span></span>: <a class='url' href='https://www.electronics-tutorials.ws/oscillator/rc_oscillator.html'><span class='cmtt-10'>https://www.electronics-tutorials.ws/oscillator/rc_oscillator.html</span></a>.
     </p></dd><dt class='thebibliography' id='X0-garde_lcmfb_2017'>
 [4]  </dt><dd class='thebibliography' id='bib-4'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_garde_lcmfb_2017'></a>M. Pilar Garde, Antonio Lopez-Martin, and Jaime Ramirez-Angulo. “Improved Common-Mode Feedback
     based on LCMFB Techniques”. In: <span class='cmti-10'>2017 13th International Conference on PRIME</span>. IEEE. Taormina, Italy,
     2017, pp. 97–100. <span class='cmcsc-10'><span class='small-caps'>doi</span></span>: <a href='https://doi.org/10.1109/prime.2017.7974161'>10.1109/prime.2017.7974161</a>.
     </p></dd><dt class='thebibliography' id='X0-gray_analog_2009'>
 [5]  </dt><dd class='thebibliography' id='bib-5'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_gray_analog_2009'></a>Paul R. Gray et al. <span class='cmti-10'>Analysis and Design of Analog Integrated Circuits</span>. 5th. John Wiley &amp; Sons, 2009. <span class='cmcsc-10'><span class='small-caps'>isbn</span></span>:
     978-0470245996.
     </p></dd><dt class='thebibliography' id='X0-isscc2025magazine'>
 [6]  </dt><dd class='thebibliography' id='bib-6'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_isscc2025magazine'></a>“ISSCC  Magazine,  Summer  2025,  Volume  17,  Number  3”.  In:  <span class='cmti-10'>IEEE Solid-State Circuits Magazine  </span>17.3
     (Summer 2025). ISSCC Magazine, Volume 17, Number 3.
     </p></dd><dt class='thebibliography' id='X0-ketkar_wilson_output_2024'>
 [7]  </dt><dd class='thebibliography' id='bib-7'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_ketkar_wilson_output_2024'></a>Tejas                          Ketkar.                          <span class='cmti-10'>Output                       Impedance                       of
     Wilson Current Mirror</span>. <a class='url' href='https://www.youtube.com/watch?v=bAzbIq8D8Bc'><span class='cmtt-10'>https://www.youtube.com/watch?v=bAzbIq8D8Bc</span></a>. YouTube video, published June
     23, 2024. Accessed: August 25, 2025. June 2024.
     </p></dd><dt class='thebibliography' id='X0-krishnapura_replica_biasing_2024'>
 [8]  </dt><dd class='thebibliography' id='bib-8'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_krishnapura_replica_biasing_2024'></a>Nagendra            Krishnapura.            <span class='cmti-10'>lecture23          -          Replica          biasing,          optimizing
     transmitter swing - 1</span>. <a class='url' href='https://www.youtube.com/watch?v=6W80WVgB5WM'><span class='cmtt-10'>https://www.youtube.com/watch?v=6W80WVgB5WM</span></a>. YouTube video, VLSI Broadband
     Communication Circuits. Accessed: August 24, 2025. Feb. 2024.
     </p></dd><dt class='thebibliography' id='X0-krishnapura_replica_biasing_lecture24_2012'>
 [9]  </dt><dd class='thebibliography' id='bib-9'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_krishnapura_replica_biasing_lecture24_2012'></a>Nagendra                                  Krishnapura.                                  <span class='cmti-10'>lecture24                             -
     Replica biasing, optimizing transmitter swing</span>. <a class='url' href='https://www.youtube.com/watch?v=52y54rFNiho'><span class='cmtt-10'>https://www.youtube.com/watch?v=52y54rFNiho</span></a>. YouTube
     video, VLSI Broadband Communication Circuits. Accessed: August 24, 2025. Mar. 2012.
     </p></dd><dt class='thebibliography' id='X0-palermo2024ecen620'>
[10]  </dt><dd class='thebibliography' id='bib-10'>
                                                                                               
                                                                                               
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_palermo2024ecen620'></a>Salvatore           Palermo.           <span class='cmti-10'>Lecture         13:         Transimpedance         Amplifiers         (TIAs)</span>.
     Tech. rep. Available at <a class='url' href='https://people.engr.tamu.edu/spalermo/ecen620/lecture13_ee620_tias.pdf'><span class='cmtt-10'>https://people.engr.tamu.edu/spalermo/ecen620/lecture13_ee620_tias.pdf</span></a>.
     Texas A&amp;M University, Analog &amp; Mixed-Signal Center, Fall 2024.
     </p></dd><dt class='thebibliography' id='X0-prasad_bandgap_2018'>
[11]  </dt><dd class='thebibliography' id='bib-11'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_prasad_bandgap_2018'></a>Guru  Prasad.  <span class='cmti-10'>Band-Gap Reference</span>.  Tech.  rep.  Accessed:  August  24,  2025.  Manipal  Academy  of  Higher
     Education, 2018. <span class='cmcsc-10'><span class='small-caps'>url</span></span>: <a class='url' href='https://www.researchgate.net/profile/Guru-Prasad-4/publication/328364212_Band-Gap_Reference/links/5bc88c97299bf17a1c5c8e7c/Band-Gap-Reference.pdf'><span class='cmtt-10'>https://www.researchgate.net/profile/Guru-Prasad-4/publication/328364212_Band-Gap_Reference/links/5bc88c97299bf17a1c5c8e7c/Band-Gap-Reference.pdf</span></a>.
     </p></dd><dt class='thebibliography' id='X0-razavi_design_2017'>
[12]  </dt><dd class='thebibliography' id='bib-12'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_razavi_design_2017'></a>Behzad              Razavi.              <span class='cmti-10'>Design            of            Analog            CMOS            Integrated
     Circuits</span>. 2nd. Available at <a class='url' href='https://picture.iczhiku.com/resource/eetop/whIFtRPGfZzldcNC.pdf'><span class='cmtt-10'>https://picture.iczhiku.com/resource/eetop/whIFtRPGfZzldcNC.pdf</span></a>. New
     York, NY: McGraw-Hill Education, 2017.
     </p></dd><dt class='thebibliography' id='X0-9805648'>
[13]  </dt><dd class='thebibliography' id='bib-13'>
     <!-- l. 2327 --><p class='noindent'><a id='cite.0_9805648'></a>Behzad  Razavi.  “The  Design  of  An  LDO  Regulator  [The  Analog  Mind]”.  In:  <span class='cmti-10'>IEEE Solid-State Circuits
     Magazine </span>14.2 (2022), pp. 7–17. <span class='cmcsc-10'><span class='small-caps'>doi</span></span>: <a href='https://doi.org/10.1109/MSSC.2022.3167308'>10.1109/MSSC.2022.3167308</a>.</p></dd></dl>
    
</body> 
</html>